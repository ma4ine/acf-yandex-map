!function(p){"use strict";acf_yandex_locale.blog_url;var t=acf_yandex_locale.template_url,o=(acf_yandex_locale.post_type,acf_yandex_locale.term_id,acf_yandex_locale.term_slug);console.log(o);var L={fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2,opacity:.75};function n(M){var c,s,d,r,w=null,l=[];if(c=p(M).find(".map"),s=M.find(".map-input"),null==c||null==s)return console.error(acf_yandex_locale.map_init_fail),!1;if(d=p.parseJSON(p(s).val()),"no-project"!=o&&null!=o){console.log("Import start");var e=t+"/map/data-project-"+o+".json";p.when(p.get(e,function(e){0<e.features.length?p.each(e.features,function(e,t){l[e]={id:t.id,content:t.id,type:t.geometry.type,term:t.term,coords:t.geometry.coordinates}}):console.error("Data import error!")})).done(function(){console.log("Import success & map start"),console.log(l),ymaps.ready(function(){u()})}).fail(function(){console.error("Data import error!")})}else console.log("Just map start"),ymaps.ready(function(){u()});function u(){c.empty(),null!=w&&(w.destroy(),w=null,s.val("")),(w=new ymaps.Map(c[0],{zoom:d.zoom,center:[d.center_lat,d.center_lng],type:"yandex#"+d.type},{minZoom:10})).controls.remove("trafficControl"),w.controls.remove("fullscreenControl"),w.behaviors.disable("scrollZoom"),w.copyrights.add("&copy; Const Lab. "),w.events.add("click",function(e){y(e.get("coords")),j()}),w.events.add("typechange",function(e){j()}),w.events.add("boundschange",function(){j()});var e=w.controls.get("searchControl");e.options.set({noPlacemark:!0,useMapBounds:!1,noSelect:!0,kind:"locality",width:250}),e.events.add("resultselect",function(){w.geoObjects.removeAll(),j()}),w.controls.get("geolocationControl").events.add("locationchange",function(){w.geoObjects.removeAll(),j()});var t=new ymaps.control.ZoomControl;t.events.add("zoomchange",function(e){j()}),w.controls.add(t,{top:75,left:5});var o=new ymaps.control.Button({data:{content:acf_yandex_locale.btn_clear_all,title:acf_yandex_locale.btn_clear_all_hint},options:{selectOnClick:!1}});o.events.add("click",function(){w.balloon.close(),w.geoObjects.removeAll(),j()}),w.controls.add(o,{top:5,right:5}),r=new ymaps.GeoObjectCollection(null,{preset:"islands#yellowIcon"}),p(l).each(function(e,t){!function(e,t,o,n,a){var i=null,c=null!=t?t.toLowerCase():p(M).find(".marker-type").val(),s=n;s=null==n&&0==d.marks.length?1:null==n?d.marks[d.marks.length-1].id+1:n;var l=null==a?"":a;"point"==c?i=new ymaps.Placemark(e,{iconContent:s,hintContent:acf_yandex_locale.mark_hint},{}):"polygon"==c?i=new ymaps.Polygon(e,{hintContent:acf_yandex_locale.mark_hint},L):console.error("Mark import error!");i.properties.set("id",s),i.properties.set("content",l),r.add(i)}(t.coords,t.type,t.term,t.id,t.content)}),w.geoObjects.add(r),p(d.marks).each(function(e,t){y(t.coords,t.type,t.circle_size,t.id,t.content)});var n=w.getCenter();w.balloon.events.add("autopanbegin",function(){n=w.getCenter()}),w.balloon.events.add("close",function(){w.setCenter(n,w.getZoom(),{duration:500})}),w.balloon.events.add("open",function(){p(M).find(".ya-import form").submit(function(){return function(e){if(0==e.length)return;if("import"!=e[0].name)return;try{var t=p.parseJSON(e[0].value)}catch(e){return console.error(e,"Import map error"),alert("Import map error")}d=t,u()}(p(this).serializeArray()),!1}),p(M).find(".ya-import textarea, .ya-export textarea").focus().select()});var a=new ymaps.control.Button({data:{image:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik0xMi42LDRoLTEuMDIxYy0wLjI3NiwwLTAuNSwwLjIyNC0wLjUsMC41czAuMjI0LDAuNSwwLjUsMC41SDEyLjZDMTMuMzk4LDUsMTQsNS42NDUsMTQsNi41djZjMCwwLjg1NS0wLjYwMiwxLjUtMS40LDEuNWgtMTBDMS43NDgsMTQsMSwxMy4yOTksMSwxMi41di02QzEsNS43MDEsMS43NDgsNSwyLjYsNWgwLjc2OGMwLjI3NiwwLDAuNS0wLjIyNCwwLjUtMC41UzMuNjQ1LDQsMy4zNjgsNEgyLjZDMS4xOTEsNCwwLDUuMTQ1LDAsNi41djZDMCwxMy44NTUsMS4xOTEsMTUsMi42LDE1aDEwYzEuMzQ2LDAsMi40LTEuMDk4LDIuNC0yLjV2LTZDMTUsNS4wOTgsMTMuOTQ1LDQsMTIuNiw0eiIvPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik03LjEzMywxMC4wMzRjMC4xMzcsMC4zMTUsMC41NjgsMC40MTMsMC43MDMsMC4xMDFjMC4wMTItMC4wMjksMS4xNzctMi40MTksMS45MjktMy4zNzNjMC4yNjQtMC4zMzUtMC4wOTUtMC42NC0wLjQ2My0wLjUzQzguOTgsNi4zMjgsNy45NjYsNy4wNTIsNy45NjYsNy4xMDFWMC41NzZjMC0wLjI3Ni0wLjE4OC0wLjU5MS0wLjQ2NS0wLjU5MWMtMC4wMDIsMC0wLjAwMywwLjAwMS0wLjAwNSwwLjAwMXMwLjAwMS0wLjAwMS0wLjAwMS0wLjAwMWMtMC4yNzYsMC0wLjQ5NSwwLjIyNC0wLjQ5NSwwLjVWNy4wMWMwLTAuMDQ5LTEuMDE4LTAuNzc0LTEuMzM5LTAuODY5Yy0wLjM2OC0wLjExLTAuNzE4LDAuMTg3LTAuNDY2LDAuNTNDNS44Nyw3LjU4Nyw2LjY1OSw4Ljk0Myw3LjEzMywxMC4wMzR6Ii8+PC9nPjwvc3ZnPg==",title:acf_yandex_locale.btn_import},options:{selectOnClick:!1}});a.events.add("click",function(){w.balloon.close(),w.balloon.open(w.getBounds()[0],'<div class="ya-import" style="margin: 5px"><p class="description">'+acf_yandex_locale.import_desc+'</p><form><textarea name="import" cols="40" rows="5" autofocus></textarea><br><input type="submit" class="button" name="submit" value="'+acf_yandex_locale.import_go+'"/></form></div>')});var i=new ymaps.control.Button({data:{image:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik0xMi42LDRoLTEuMDIxYy0wLjI3NiwwLTAuNSwwLjIyNC0wLjUsMC41czAuMjI0LDAuNSwwLjUsMC41SDEyLjZDMTMuMzk4LDUsMTQsNS42NDUsMTQsNi41djZjMCwwLjg1NS0wLjYwMiwxLjUtMS40LDEuNWgtMTBDMS43NDgsMTQsMSwxMy4yOTksMSwxMi41di02QzEsNS43MDEsMS43NDgsNSwyLjYsNWgwLjc2OGMwLjI3NiwwLDAuNS0wLjIyNCwwLjUtMC41UzMuNjQ1LDQsMy4zNjgsNEgyLjZDMS4xOTEsNCwwLDUuMTQ1LDAsNi41djZDMCwxMy44NTUsMS4xOTEsMTUsMi42LDE1aDEwYzEuMzQ2LDAsMi40LTEuMDk4LDIuNC0yLjV2LTZDMTUsNS4wOTgsMTMuOTQ1LDQsMTIuNiw0eiIvPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik03Ljg2OCwwLjIyNWMtMC4xMzctMC4zMTUtMC42MDItMC4zMjItMC43MzctMC4wMUM3LjExOCwwLjI0NCw1Ljk1NCwyLjYzNCw1LjIwMiwzLjU4OGMtMC4yNjQsMC4zMzUsMC4wOTUsMC42NCwwLjQ2MywwLjUzQzUuOTg2LDQuMDIyLDcsMy4yOTgsNywzLjI0OXY2LjUyNmMwLDAuMjc2LDAuMjIzLDAuNSwwLjQ5OSwwLjVjMC4wMDIsMCwwLjAwMy0wLjAwMSwwLjAwNS0wLjAwMXMtMC4wMDEsMC4wMDEsMC4wMDEsMC4wMDFjMC4yNzYsMCwwLjQ5NS0wLjIyNCwwLjQ5NS0wLjVWMy4yNDljMCwwLjA0OSwxLjAxOCwwLjc3NCwxLjMzOSwwLjg2OWMwLjM2OCwwLjExLDAuNzE4LTAuMTg3LDAuNDY2LTAuNTNDOS4xMzEsMi42NzEsOC4zNDEsMS4zMTUsNy44NjgsMC4yMjV6Ii8+PC9nPjwvc3ZnPg==",title:acf_yandex_locale.btn_export},options:{selectOnClick:!1}});i.events.add("click",function(){w.balloon.close(),w.balloon.open(w.getBounds()[0],'<div class="ya-export" style="margin: 5px"><p class="description">'+acf_yandex_locale.export_desc+'</p><textarea cols="40" rows="5" readonly>'+JSON.stringify(d)+"</textarea></div>")}),w.events.add("balloonopen",function(){p(".ya-editor textarea").focus(),p(".ya-editor .remove").click(function(e){var t=p(e.currentTarget).parent("form").children('input[type="hidden"]').val();return null==t||(w.balloon.close(),w.geoObjects.each(function(e){e.properties.get("id")==t&&w.geoObjects.remove(e)})),!1}),p(".ya-editor form").submit(function(){var e=p(this).serializeArray(),o={};return p.map(e,function(e,t){o[e.name]=e.value}),w.geoObjects.each(function(e){e.properties.get("id")==o.id&&(e.properties.set("content",o.content),j())}),w.balloon.close(),!1})}),w.controls.add(i,{top:5,right:5}),w.controls.add(a,{top:5,right:5})}function y(e,t,o,n,a){var i=null,c=null!=t?t.toLowerCase():p(M).find(".marker-type").val(),s=n;s=null==n&&0==d.marks.length?1:null==n?d.marks[d.marks.length-1].id+1:n;var l=null==a?"":a;if("point"==c)i=new ymaps.Placemark(e,{hintContent:acf_yandex_locale.mark_hint},{draggable:!0});else{var r=null!=o?o:parseInt(p(M).find(".circle-size").val())/2;i=new ymaps.Circle([e,r],{hintContent:acf_yandex_locale.mark_hint},{draggable:!0,opacity:.5,fillOpacity:.1,fillColor:"#DB709377",strokeColor:"#990066",strokeOpacity:.7,strokeWidth:5})}i.events.add("contextmenu",function(){w.geoObjects.remove(this),j()},i),i.events.add("dragend",function(){j()}),i.events.add("click",function(){this.balloon.isOpen()||function(e){var t='<div class="ya-editor" style="margin: 5px"><form name="mark"><input type="hidden" name="id" value="'+e.properties.get("id")+'"><textarea name="content" rows="5" cols="40">'+e.properties.get("content")+'</textarea><input type="submit" class="button button-primary" value="'+acf_yandex_locale.mark_save+'"/>&nbsp;<button class="button remove">'+acf_yandex_locale.mark_remove+"</button></form></div>";w.balloon.open(e.geometry.getCoordinates(),t)}(this)},i),i.properties.set("id",s),i.properties.set("content",l),w.geoObjects.add(i)}function j(){d.zoom=w.getZoom();var e=w.getCenter();d.center_lat=e[0],d.center_lng=e[1];var t=w.getType().split("#");d.type=t[1]?t[1]:"map";var o=[];w.geoObjects.each(function(e){var t=e.geometry.getType();o.push({id:e.properties.get("id"),content:e.properties.get("content"),type:t,coords:e.geometry.getCoordinates(),circle_size:"Circle"==t?e.geometry.getRadius():0})}),d.marks=o,p(s).val(JSON.stringify(d))}p(".marker-type").on("change",function(){var e=p(this).parent().next("th").children(0),t=p(this).parent().next("th").next("td").children(0);"circle"==this.value?(e.removeClass("hidden"),t.removeClass("hidden")):(e.addClass("hidden"),t.addClass("hidden"))})}void 0!==acf.add_action?acf.add_action("ready append",function(e){acf.get_fields({type:"yandex-map"},e).each(function(){n(p(this))})}):p(document).on("acf/setup_fields",function(e,t){p(t).find('.field[data-field_type="yandex-map"]').each(function(){n(p(this))})})}(jQuery);
//# sourceMappingURL=acf-yandex-map.min.js.map