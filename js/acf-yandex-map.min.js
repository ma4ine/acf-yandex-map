!function(g){acf_yandex_locale.blog_url;var r=acf_yandex_locale.template_url,l=(acf_yandex_locale.post_type,acf_yandex_locale.term_id,acf_yandex_locale.term_slug);function n(s){var n,o,p,f=null,u=!1;if(n=g(s).find(".map"),o=s.find(".map-input"),null==n||null==o)return console.error(acf_yandex_locale.map_init_fail),!1;function t(){n.empty(),null!=f&&(f.destroy(),f=null,o.val("")),(f=new ymaps.Map(n[0],{zoom:p.zoom,center:[p.center_lat,p.center_lng],type:"yandex#"+p.type},{minZoom:10})).controls.remove("trafficControl"),f.controls.remove("fullscreenControl"),f.behaviors.disable("scrollZoom"),f.events.add("click",function(e){!0===u&&(a(e.get("coords")),m())}),f.events.add("typechange",function(e){m()}),f.events.add("boundschange",function(){m()});var e=new ymaps.control.ZoomControl;e.events.add("zoomchange",function(e){m()}),f.controls.add(e,{top:75,left:5});var t=new ymaps.control.Button({data:{content:acf_yandex_locale.btn_clear_all,title:acf_yandex_locale.btn_clear_all_hint},options:{selectOnClick:!1}});t.events.add("click",function(){f.geoObjects.removeAll(),m(),u=!0}),f.controls.add(t,{top:5,right:5});new ymaps.GeoObjectCollection({},{preset:"islands#redCircleIcon",strokeWidth:4,geodesic:!0});g(p.marks).each(function(e,t,n){console.log(n),a(t.coords,t.type,t.id,t.content,n)})}function a(e,t,n,o,a,r){var l=null,c=null!=t?t.toLowerCase():g(s).find(".marker-type").val(),d=o;d=null==o&&0==p.marks.length?1:null==o?p.marks[p.marks.length-1].id+1:o;var i=null==a?"":a;"point"==c?(l=new ymaps.Placemark(e,{hintContent:acf_yandex_locale.mark_hint},{preset:"islands#orangeDotIcon",draggable:!0})).events.add("contextmenu",function(){f.geoObjects.remove(this),m(),u=!0},l):(2===e.length&&(e=[]),l=new ymaps.Polygon(e,{},{draggable:!0,editorDrawingCursor:"crosshair",editorMaxPoints:5,fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2}),!0===u&&l.editor.startDrawing()),l.properties.set("id",d),l.properties.set("content",i),console.log(r),null!=r?(r.add(l),f.geoObjects.add(r)):(f.geoObjects.add(l),l.events.add("dragend",function(){m()}),l.events.add("editorstatechange",function(){m()}),l.events.add("geometrychange",function(){m()}))}function m(){p.zoom=f.getZoom();var e=f.getCenter();p.center_lat=e[0],p.center_lng=e[1];var t=f.getType().split("#");p.type=t[1]?t[1]:"map";var n=[];f.geoObjects.each(function(e){var t=e.geometry.getType();n.push({id:e.properties.get("id"),content:e.properties.get("content"),type:t,coords:e.geometry.getCoordinates()})}),p.marks=n,g(o).val(JSON.stringify(p)),u=!1}p=g.parseJSON(g(o).val()),ymaps.ready(function(){if("no-project"!=l){console.log("Import start");var e=r+"/ajax/data-project-"+l+".json";g.when(g.get(e,function(e){0<e.features.length&&(p.zoom=13,p.center_lat=59.99914531368303,p.center_lng=30.72482104954271,p.type="map",g.each(e.features,function(e,t){p.marks[e]={id:t.id,content:t.id,type:t.geometry.type,coords:t.geometry.coordinates}}))})).done(function(){t()}).fail(function(){console.log("Project import error")})}else console.log("Just map start"),t()}),g(".marker-type").on("change",function(){var e=g(this).parent().next("th").children(0),t=g(this).parent().next("th").next("td").children(0);"circle"==this.value?(e.removeClass("hidden"),t.removeClass("hidden")):(e.addClass("hidden"),t.addClass("hidden"))})}void 0!==acf.add_action?acf.add_action("ready append",function(e){acf.get_fields({type:"yandex-map"},e).each(function(){n(g(this))})}):g(document).on("acf/setup_fields",function(e,t){g(t).find('.field[data-field_type="yandex-map"]').each(function(){n(g(this))})})}(jQuery);
//# sourceMappingURL=acf-yandex-map.min.js.map