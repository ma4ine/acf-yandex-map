!function(f){"use strict";var e=acf_yandex_locale.plugin_url,m={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-green.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},p={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-orange.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},y={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-yellow.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},v={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-red.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},_={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-gray.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},h={fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2,opacity:.7},k={fillColor:"#E3D5B1",strokeColor:"#EC6B23",strokeWidth:2,opacity:.7},b={fillColor:"#FFEE8B",strokeColor:"#FFDE17",strokeWidth:2,opacity:.7},C={fillColor:"#F7A09A",strokeColor:"#ED1C25",strokeWidth:2,opacity:.7},w={fillColor:"#A3ACB2",strokeColor:"#88959E",strokeWidth:2,opacity:.7},O=(acf_yandex_locale.blog_url,acf_yandex_locale.template_url,acf_yandex_locale.post_id),o=(acf_yandex_locale.post_type,acf_yandex_locale.term_id,acf_yandex_locale.term_slug),j=!!acf_yandex_locale.is_project;function t(c){var a,n,l,g,s,i=null,r=[];if(a=f(c).find(".map"),n=c.find(".map-input"),null==a||null==n)return console.error(acf_yandex_locale.map_init_fail),!1;function d(e,o,t,a){var n=null,r=null!=o?o.toLowerCase():f(c).find(".marker-type").val();console.log(r);null==t&&0==l.marks.length||null==t&&l.marks[l.marks.length-1].id;if("point"==r)m.draggable=!0,n=new ymaps.Placemark(e,{},m),i.geoObjects.add(n),s=!1;else{if("polygon"!=r)return console.error("Marker type error!"),!1;2===e.length&&(e=[]),h.editorDrawingCursor="crosshair",h.editorMaxPoints=5;n=new ymaps.Polygon(e,{},h);i.geoObjects.add(n),n.editor.startDrawing(),new ymaps.Monitor(n.editor.state).add("drawing",function(e){s=!1})}n.events.add("dragend",function(){u()}),n.events.add("editorstatechange",function(){u()}),n.events.add("geometrychange",function(){u()}),f(".marker-type").val(r).attr("disabled","true")}function u(){l.zoom=i.getZoom();var e=i.getCenter();l.center_lat=e[0],l.center_lng=e[1];var o=i.getType().split("#");l.type=o[1]?o[1]:"map";var t=[];i.geoObjects.each(function(e){if(null!=e.geometry){var o=e.geometry.getType();t.push({id:O,content:content,type:o,coords:e.geometry.getCoordinates()})}}),l.marks=t,f(n).val(JSON.stringify(l))}l=f.parseJSON(f(n).val()),"no-project"!=o&&null!=o||j?(console.log("Import start"),console.log(o),f.post({url:ajaxurl,data:{action:"ymaps_json_post",data:{type:"project",name:o}}}).done(function(e){var o=f.parseJSON(e);0<o.features.length?(f.each(o.features,function(e,o){r[e]={id:o.id,content:o.id,type:o.geometry.type,coords:o.geometry.coordinates,status:!!o.status&&o.status.slug}}),console.log("Map data loaded")):console.error("Map data error")}),console.log("Import success & map start")):console.log("Just map start"),ymaps.ready(function(){!function(){a.empty(),null!=i&&(i.destroy(),i=null,n.val(""));(i=new ymaps.Map(a[0],{zoom:l.zoom,center:[l.center_lat,l.center_lng],type:"yandex#"+l.type},{minZoom:10})).controls.remove("trafficControl"),i.controls.remove("fullscreenControl"),i.controls.remove("searchControl"),i.controls.remove("geolocationControl"),i.behaviors.disable("scrollZoom"),i.copyrights.add("&copy; DKI "),j||i.events.add("click",function(e){s&&(d(e.get("coords")),u())});i.events.add("typechange",function(e){u()}),i.events.add("boundschange",function(){u()});var e=new ymaps.control.ZoomControl;e.events.add("zoomchange",function(e){u()}),i.controls.add(e,{top:75,left:5});var o=new ymaps.control.Button({data:{content:acf_yandex_locale.btn_clear_all,title:acf_yandex_locale.btn_clear_all_hint},options:{selectOnClick:!1}});o.events.add("click",function(){i.geoObjects.each(function(e){null!=e.geometry&&i.geoObjects.remove(e)}),s=!0,f(".marker-type").removeAttr("disabled"),u()}),j||i.controls.add(o,{top:5,right:5});var t=new ymaps.control.Button("Найти");t.events.add("click",function(){i.geoObjects.each(function(e){null!=e.geometry&&i.geoObjects.remove(e)});var a="";f(".js-location").each(function(e,o){function t(e){null!=e&&NaN!=e&&null!=e&&e&&(a+=e)}t(f(o).find("textarea").val()),t(f(o).find("input").val()),t(f(o).find('select option[selected="selected"]').text())}),a?function(r){ymaps.geocode(r,{results:1}).then(function(e){var o=e.geoObjects.get(0),t=o.geometry.getCoordinates(),a=o.properties.get("boundedBy"),n=r;d(t,"point",O,n),i.setBounds(a,{checkZoomRange:!0}),u()})}(a):alert("Объект не найден")}),j||i.controls.add(t);g=new ymaps.GeoObjectCollection(null,{}),f(r).each(function(e,o){o.id!=O&&function(e,o,t,a){var n=null,r=o.toLowerCase(),c=t,l=window.location.origin+"/wp-admin/post.php?post="+c+"&action=edit",s={balloonContentBody:"<span>Объект №"+c+'</span><br><a href="'+l+'">Редактировать</a>',hintContent:c};if("point"==r){var i;if(j)switch(a){case"vacant":i=m;break;case"reserved":i=y;break;case"booked":i=v;break;default:i=_}else i=p;n=new ymaps.Placemark(e,s,i),g.add(n)}else if("polygon"==r){var d;if(j)switch(a){case"vacant":d=h;break;case"reserved":d=b;break;case"booked":d=C;break;default:d=w}else d=k;n=new ymaps.Polygon(e,s,d),g.add(n)}else console.log("Object "+t+" without coordinates")}(o.coords,o.type,o.id,o.status)}),i.geoObjects.add(g),f(l.marks).each(function(e,o){d(o.coords,o.type,o.id,o.content)}),j&&i.setBounds(i.geoObjects.getBounds(),{checkZoomRange:!0})}()})}void 0!==acf.add_action?acf.add_action("ready append",function(e){acf.get_fields({type:"yandex-map"},e).each(function(){t(f(this))})}):f(document).on("acf/setup_fields",function(e,o){f(o).find('.field[data-field_type="yandex-map"]').each(function(){t(f(this))})})}(jQuery);
//# sourceMappingURL=acf-yandex-map.min.js.map