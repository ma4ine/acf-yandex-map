!function(f){"use strict";var e=acf_yandex_locale.plugin_url,g={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-2.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},m={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-1.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},y={fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2,opacity:.7},_={fillColor:"rgba(0,0,0,0.00)",strokeColor:"#EC6B23",strokeWidth:2,opacity:.7},v=(acf_yandex_locale.blog_url,acf_yandex_locale.template_url,acf_yandex_locale.post_id),o=(acf_yandex_locale.post_type,acf_yandex_locale.term_id,acf_yandex_locale.term_slug),h=!!acf_yandex_locale.is_project;function t(l){var n,a,c,i,r,s=null,d=[];if(n=f(l).find(".map"),a=l.find(".map-input"),null==n||null==a)return console.error(acf_yandex_locale.map_init_fail),!1;function e(){n.empty(),null!=s&&(s.destroy(),s=null,a.val("")),(s=new ymaps.Map(n[0],{zoom:c.zoom,center:[c.center_lat,c.center_lng],type:"yandex#"+c.type},{minZoom:10})).controls.remove("trafficControl"),s.controls.remove("fullscreenControl"),s.controls.remove("searchControl"),s.controls.remove("geolocationControl"),s.behaviors.disable("scrollZoom"),s.copyrights.add("&copy; DKI "),h||s.events.add("click",function(e){r&&(u(e.get("coords")),p())}),s.events.add("typechange",function(e){p()}),s.events.add("boundschange",function(){p()});var e=new ymaps.control.ZoomControl;e.events.add("zoomchange",function(e){p()}),s.controls.add(e,{top:75,left:5});var o=new ymaps.control.Button({data:{content:acf_yandex_locale.btn_clear_all,title:acf_yandex_locale.btn_clear_all_hint},options:{selectOnClick:!1}});o.events.add("click",function(){s.geoObjects.each(function(e){null!=e.geometry&&s.geoObjects.remove(e)}),r=!0,f(".marker-type").removeAttr("disabled"),p()}),h||s.controls.add(o,{top:5,right:5});var t=new ymaps.control.Button("Найти");t.events.add("click",function(){s.geoObjects.each(function(e){null!=e.geometry&&s.geoObjects.remove(e)});var n="";f(".js-location").each(function(e,o){function t(e){null!=e&&NaN!=e&&null!=e&&e&&(n+=e)}t(f(o).find("textarea").val()),t(f(o).find("input").val()),t(f(o).find('select option[selected="selected"]').text())}),n?function(a){ymaps.geocode(a,{results:1}).then(function(e){var o=e.geoObjects.get(0),t=o.geometry.getCoordinates(),n=o.properties.get("boundedBy");u(t,"point",v,a),s.setBounds(n,{checkZoomRange:!0}),p()})}(n):alert("Объект не найден")}),h||s.controls.add(t),i=new ymaps.GeoObjectCollection(null,{preset:"islands#yellowIcon"}),f(d).each(function(e,o){o.id!=v&&function(e,o,t){var n=null,a=o.toLowerCase(),l=t,c=window.location.origin+"/wp-admin/post.php?post="+l+"&action=edit",r={balloonContentBody:"<span>Объект №"+l+'</span><br><a href="'+c+'">Редактировать</a>',hintContent:l};"point"==a?(n=new ymaps.Placemark(e,r,m),i.add(n)):"polygon"==a?(n=new ymaps.Polygon(e,r,_),i.add(n)):console.log("Object "+t+" without coordinates")}(o.coords,o.type,o.id)}),s.geoObjects.add(i),f(c.marks).each(function(e,o){u(o.coords,o.type,o.id,o.content)})}function u(e,o,t){var n=null,a=null!=o?o.toLowerCase():f(l).find(".marker-type").val();console.log(a);null==t&&0==c.marks.length||null==t&&c.marks[c.marks.length-1].id;if("point"==a)g.draggable=!0,n=new ymaps.Placemark(e,{},g),s.geoObjects.add(n),r=!1;else{if("polygon"!=a)return console.error("Marker type error!"),!1;2===e.length&&(e=[]),y.editorDrawingCursor="crosshair",y.editorMaxPoints=5;n=new ymaps.Polygon(e,{},y);s.geoObjects.add(n),n.editor.startDrawing(),new ymaps.Monitor(n.editor.state).add("drawing",function(e){r=!1})}n.events.add("dragend",function(){p()}),n.events.add("editorstatechange",function(){p()}),n.events.add("geometrychange",function(){p()}),f(".marker-type").val(a).attr("disabled","true")}function p(){c.zoom=s.getZoom();var e=s.getCenter();c.center_lat=e[0],c.center_lng=e[1];var o=s.getType().split("#");c.type=o[1]?o[1]:"map";var t=[];s.geoObjects.each(function(e){if(null!=e.geometry){var o=e.geometry.getType();t.push({id:v,content:content,type:o,coords:e.geometry.getCoordinates()})}}),c.marks=t,f(a).val(JSON.stringify(c))}c=f.parseJSON(f(a).val()),"no-project"!=o&&null!=o||h?(console.log("Import start"),console.log(o),f.when(f.post({url:ajaxurl,data:{action:"ymaps_json_post",data:"test"}}).done(function(e){console.log(e),console.log("Map data loaded")}).fail(function(){console.error("Map data error")})).done(function(){console.log("Import success & map start"),ymaps.ready(function(){e()})}).fail(function(){console.error("Data import error!"),console.log("Just map start"),ymaps.ready(function(){e()})})):(console.log("Just map start"),ymaps.ready(function(){e()}))}void 0!==acf.add_action?acf.add_action("ready append",function(e){acf.get_fields({type:"yandex-map"},e).each(function(){t(f(this))})}):f(document).on("acf/setup_fields",function(e,o){f(o).find('.field[data-field_type="yandex-map"]').each(function(){t(f(this))})})}(jQuery);
//# sourceMappingURL=acf-yandex-map.min.js.map