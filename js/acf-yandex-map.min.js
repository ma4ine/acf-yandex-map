!function(p){"use strict";acf_yandex_locale.blog_url;var m=acf_yandex_locale.template_url,u=acf_yandex_locale.post_id,g=(acf_yandex_locale.post_type,acf_yandex_locale.term_id,acf_yandex_locale.term_slug),y={iconLayout:"default#image",iconImageHref:m+"/svg/map/mark-house-2.svg",iconImageSize:[36,36],iconImageOffset:[-6,-18]},_={iconLayout:"default#image",iconImageHref:m+"/svg/map/mark-house-1.svg",iconImageSize:[36,36],iconImageOffset:[-6,-18]},v={fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2,opacity:.7},h={fillColor:"rgba(0,0,0,0.00)",strokeColor:"#EC6B23",strokeWidth:2,opacity:.7};function n(l){var n,t,c,i,s,d=null,a=[];if(n=p(l).find(".map"),t=l.find(".map-input"),null==n||null==t)return console.error(acf_yandex_locale.map_init_fail),!1;if(c=p.parseJSON(p(t).val()),"no-project"!=g&&null!=g){console.log("Import start");var e=m+"/map/data-land-"+g+".json";p.when(p.get(e,function(e){0<e.features.length?p.each(e.features,function(e,o){a[e]={id:o.id,content:o.id,type:o.geometry.type,coords:o.geometry.coordinates}}):console.error("Data import error!")})).done(function(){console.log("Import success & map start"),ymaps.ready(function(){o()})}).fail(function(){console.error("Data import error!")})}else console.log("Just map start"),ymaps.ready(function(){o()});function o(){n.empty(),null!=d&&(d.destroy(),d=null,t.val("")),(d=new ymaps.Map(n[0],{zoom:c.zoom,center:[c.center_lat,c.center_lng],type:"yandex#"+c.type},{minZoom:10})).controls.remove("trafficControl"),d.controls.remove("fullscreenControl"),d.controls.remove("searchControl"),d.behaviors.disable("scrollZoom"),d.copyrights.add("&copy; DKI "),d.events.add("click",function(e){s&&(r(e.get("coords")),f())}),d.events.add("typechange",function(e){f()}),d.events.add("boundschange",function(){f()}),d.controls.get("geolocationControl").events.add("locationchange",function(){f()});var e=new ymaps.control.ZoomControl;e.events.add("zoomchange",function(e){f()}),d.controls.add(e,{top:75,left:5});var o=new ymaps.control.Button({data:{content:acf_yandex_locale.btn_clear_all,title:acf_yandex_locale.btn_clear_all_hint},options:{selectOnClick:!1}});o.events.add("click",function(){d.geoObjects.each(function(e){null!=e.geometry&&d.geoObjects.remove(e)}),s=!0,p(".marker-type").removeAttr("disabled"),f()}),d.controls.add(o,{top:5,right:5}),i=new ymaps.GeoObjectCollection(null,{preset:"islands#yellowIcon"}),p(a).each(function(e,o){o.id!=u&&function(e,o,n){var t=null,a=o.toLowerCase(),r=n,l=window.location.origin+"/wp-admin/post.php?post="+r+"&action=edit",c={balloonContentBody:"<span>Объект №"+r+'</span><br><a href="'+l+'">Редактировать</a>',hintContent:r};if("point"==a)t=new ymaps.Placemark(e,c,_);else{if("polygon"!=a)return console.error("Mark import error!");t=new ymaps.Polygon([e],c,h)}i.add(t)}(o.coords,o.type,o.id)}),d.geoObjects.add(i),p(c.marks).each(function(e,o){r(o.coords,o.type,o.id,o.content)})}function r(e,o,n,t){var a=null,r=null!=o?o.toLowerCase():p(l).find(".marker-type").val();console.log(r);null==n&&0==c.marks.length||null==n&&c.marks[c.marks.length-1].id;if("point"==r)y.draggable=!0,a=new ymaps.Placemark(e,{},y),d.geoObjects.add(a),s=!1;else{if("polygon"!=r)return console.error("Marker type error!"),!1;2===e.length&&(e=[]),v.editorDrawingCursor="crosshair",v.editorMaxPoints=5;a=new ymaps.Polygon(e,{},v);d.geoObjects.add(a),a.editor.startDrawing(),new ymaps.Monitor(a.editor.state).add("drawing",function(e){s=!1})}a.events.add("dragend",function(){f()}),a.events.add("editorstatechange",function(){f()}),a.events.add("geometrychange",function(){f()}),p(".marker-type").val(r).attr("disabled","true")}function f(){c.zoom=d.getZoom();var e=d.getCenter();c.center_lat=e[0],c.center_lng=e[1];var o=d.getType().split("#");c.type=o[1]?o[1]:"map";var n=[];d.geoObjects.each(function(e){if(null!=e.geometry){var o=e.geometry.getType();n.push({id:u,content:u,type:o,coords:e.geometry.getCoordinates()})}}),c.marks=n,p(t).val(JSON.stringify(c))}}void 0!==acf.add_action?acf.add_action("ready append",function(e){acf.get_fields({type:"yandex-map"},e).each(function(){n(p(this))})}):p(document).on("acf/setup_fields",function(e,o){p(o).find('.field[data-field_type="yandex-map"]').each(function(){n(p(this))})})}(jQuery);
//# sourceMappingURL=acf-yandex-map.min.js.map