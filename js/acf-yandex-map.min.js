!function(g){acf_yandex_locale.blog_url;var r=acf_yandex_locale.template_url,l=(acf_yandex_locale.post_type,acf_yandex_locale.term_id,acf_yandex_locale.term_slug);function n(i){var n,o,s,p,f=null,m=!1;if(n=g(i).find(".map"),o=i.find(".map-input"),null==n||null==o)return console.error(acf_yandex_locale.map_init_fail),!1;function t(){n.empty(),null!=f&&(f.destroy(),f=null,o.val("")),(f=new ymaps.Map(n[0],{zoom:s.zoom,center:[s.center_lat,s.center_lng],type:"yandex#"+s.type},{minZoom:10})).controls.remove("trafficControl"),f.controls.remove("fullscreenControl"),f.behaviors.disable("scrollZoom"),f.events.add("click",function(e){!0===m&&(a(e.get("coords")),u())}),f.events.add("typechange",function(e){u()}),f.events.add("boundschange",function(){u()});var e=new ymaps.control.ZoomControl;e.events.add("zoomchange",function(e){u()}),f.controls.add(e,{top:75,left:5});var t=new ymaps.control.Button({data:{content:acf_yandex_locale.btn_clear_all,title:acf_yandex_locale.btn_clear_all_hint},options:{selectOnClick:!1}});t.events.add("click",function(){f.geoObjects.removeAll(),u(),m=!0}),f.controls.add(t,{top:5,right:5}),p=new ymaps.GeoObjectCollection({},{preset:"islands#redCircleIcon",strokeWidth:4,geodesic:!0}),console.log(s),g(s.marks).each(function(e,t){a(t.coords,t.type,t.id,t.content,t.term)}),f.geoObjects.add(p)}function a(e,t,n,o,a){var r=null,l=null!=t?t.toLowerCase():g(i).find(".marker-type").val(),c=n;c=null==n&&0==s.marks.length?1:null==n?s.marks[s.marks.length-1].id+1:n;var d=null==o?"":o;"point"==l?(r=new ymaps.Placemark(e,{iconContent:c,hintContent:d},{preset:"islands#orangeDotIcon"})).events.add("contextmenu",function(){f.geoObjects.remove(this),u(),m=!0},r):(2===e.length&&(e=[]),r=new ymaps.Polygon(e,{},{draggable:!0,editorDrawingCursor:"crosshair",editorMaxPoints:5,fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2}),!0===m&&r.editor.startDrawing()),r.properties.set("id",c),r.properties.set("content",d),console.log(a),null!=a?p.add(r):(r.options.set("draggable","true"),f.geoObjects.add(r),r.events.add("dragend",function(){u()}),r.events.add("editorstatechange",function(){u()}),r.events.add("geometrychange",function(){u()}))}function u(){s.zoom=f.getZoom();var e=f.getCenter();s.center_lat=e[0],s.center_lng=e[1];var t=f.getType().split("#");s.type=t[1]?t[1]:"map";var n=[];f.geoObjects.each(function(e){var t=e.geometry.getType();n.push({id:e.properties.get("id"),content:e.properties.get("content"),type:t,coords:e.geometry.getCoordinates()})}),s.marks=n,g(o).val(JSON.stringify(s)),m=!1}s=g.parseJSON(g(o).val()),ymaps.ready(function(){if("no-project"!=l){console.log("Import start");var e=r+"/map/data-project-"+l+".json";g.when(g.get(e,function(e){0<e.features.length&&(s.zoom=13,s.center_lat=59.99914531368303,s.center_lng=30.72482104954271,s.type="map",g.each(e.features,function(e,t){s.marks[e]={id:t.id,content:t.id,type:t.geometry.type,term:t.term,coords:t.geometry.coordinates}}))})).done(function(){t()}).fail(function(){console.log("Project import error")})}else console.log("Just map start"),t()}),g(".marker-type").on("change",function(){var e=g(this).parent().next("th").children(0),t=g(this).parent().next("th").next("td").children(0);"circle"==this.value?(e.removeClass("hidden"),t.removeClass("hidden")):(e.addClass("hidden"),t.addClass("hidden"))})}void 0!==acf.add_action?acf.add_action("ready append",function(e){acf.get_fields({type:"yandex-map"},e).each(function(){n(g(this))})}):g(document).on("acf/setup_fields",function(e,t){g(t).find('.field[data-field_type="yandex-map"]').each(function(){n(g(this))})})}(jQuery);
//# sourceMappingURL=acf-yandex-map.min.js.map