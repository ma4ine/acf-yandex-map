!function(u){"use strict";acf_yandex_locale.blog_url;var l=acf_yandex_locale.template_url,m=(acf_yandex_locale.post_type,acf_yandex_locale.term_id,acf_yandex_locale.term_slug);console.log(m);var y={fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2,opacity:.5};function t(c){var t,n,i,s,d,p=null,a=[];if(t=u(c).find(".map"),n=c.find(".map-input"),null==t||null==n)return console.error(acf_yandex_locale.map_init_fail),!1;if(i=u.parseJSON(u(n).val()),"no-project"!=m&&null!=m){console.log("Import start");var e=l+"/map/data-land-"+m+".json";u.when(u.get(e,function(e){0<e.features.length?u.each(e.features,function(e,o){a[e]={id:o.id,content:o.id,type:o.geometry.type,term:o.term,coords:o.geometry.coordinates}}):console.error("Data import error!")})).done(function(){console.log("Import success & map start"),console.log(a),ymaps.ready(function(){o()})}).fail(function(){console.error("Data import error!")})}else console.log("Just map start"),ymaps.ready(function(){o()});function o(){t.empty(),null!=p&&(p.destroy(),p=null,n.val("")),(p=new ymaps.Map(t[0],{zoom:i.zoom,center:[i.center_lat,i.center_lng],type:"yandex#"+i.type},{minZoom:10})).controls.remove("trafficControl"),p.controls.remove("fullscreenControl"),p.controls.remove("searchControl"),p.behaviors.disable("scrollZoom"),p.copyrights.add("&copy; DKI "),p.events.add("click",function(e){d&&(r(e.get("coords")),f())}),p.events.add("typechange",function(e){f()}),p.events.add("boundschange",function(){f()}),p.controls.get("geolocationControl").events.add("locationchange",function(){f()});var e=new ymaps.control.ZoomControl;e.events.add("zoomchange",function(e){f()}),p.controls.add(e,{top:75,left:5});var o=new ymaps.control.Button({data:{content:acf_yandex_locale.btn_clear_all,title:acf_yandex_locale.btn_clear_all_hint},options:{selectOnClick:!1}});o.events.add("click",function(){p.geoObjects.each(function(e){null!=e.geometry&&p.geoObjects.remove(e)}),d=!0,f()}),p.controls.add(o,{top:5,right:5}),s=new ymaps.GeoObjectCollection(null,{preset:"islands#yellowIcon"}),u(a).each(function(e,o){!function(e,o,t,n){var a=null,r=o.toLowerCase(),l=n;if("point"==r)a=new ymaps.Placemark(e,{hintContent:l},{});else{if("polygon"!=r)return console.error("Mark import error!");a=new ymaps.Polygon(e,{hintContent:l},y)}s.add(a)}(o.coords,o.type,o.term,o.id)}),p.geoObjects.add(s),u(i.marks).each(function(e,o){r(o.coords,o.type,o.circle_size,o.id,o.content)})}function r(e,o,t,n,a){var r=null,l=null!=o?o.toLowerCase():u(c).find(".marker-type").val();console.log(l);null==n&&0==i.marks.length||null==n&&i.marks[i.marks.length-1].id;if("point"==l)r=new ymaps.Placemark(e,{},{draggable:!0}),p.geoObjects.add(r),d=!1;else{if("polygon"!=l)return console.error("Marker type error!"),!1;2===e.length&&(e=[]);r=new ymaps.Polygon(e,{},{editorDrawingCursor:"crosshair",editorMaxPoints:5,fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2,opacity:1});p.geoObjects.add(r),r.editor.startDrawing(),new ymaps.Monitor(r.editor.state).add("drawing",function(e){d=!1})}r.events.add("dragend",function(){f()}),r.events.add("editorstatechange",function(){f()}),r.events.add("geometrychange",function(){f()})}function f(){i.zoom=p.getZoom();var e=p.getCenter();i.center_lat=e[0],i.center_lng=e[1];var o=p.getType().split("#");i.type=o[1]?o[1]:"map";var t=[];p.geoObjects.each(function(e){if(null!=e.geometry){var o=e.geometry.getType();t.push({id:e.properties.get("id"),content:e.properties.get("content"),type:o,coords:e.geometry.getCoordinates(),circle_size:"Circle"==o?e.geometry.getRadius():0})}}),i.marks=t,u(n).val(JSON.stringify(i))}}void 0!==acf.add_action?acf.add_action("ready append",function(e){acf.get_fields({type:"yandex-map"},e).each(function(){t(u(this))})}):u(document).on("acf/setup_fields",function(e,o){u(o).find('.field[data-field_type="yandex-map"]').each(function(){t(u(this))})})}(jQuery);
//# sourceMappingURL=acf-yandex-map.min.js.map