!function(w){var y=w('[data-name="location-district"] input').val()+", "+w('[data-name="location-city"] select option[selected="selected"]').text()+", "+w('[data-name="location-address"] input').val(),e=acf_yandex_locale.template_url,t=acf_yandex_locale.term_slug;function o(c){var a,l,r,M=null;if(a=w(c).find(".map"),l=c.find(".map-input"),null==a||null==l)return console.error(acf_yandex_locale.map_init_fail),!1;function d(e,t,o,n,s){var i=null,a=null!=t?t.toLowerCase():w(c).find(".marker-type").val(),l=n;l=null==n&&0==r.marks.length?1:null==n?r.marks[r.marks.length-1].id+1:n;var d=null==s?"":s;"point"==a?((i=new ymaps.Placemark(e,{hintContent:acf_yandex_locale.mark_hint},{preset:"islands#orangeDotIcon",draggable:!0})).events.add("contextmenu",function(){M.geoObjects.remove(this),u()},i),i.properties.set("id",l),i.properties.set("content",d),M.geoObjects.add(i)):(2===e.length&&(e=[]),(i=new ymaps.Polygon(e,{},{draggable:!0,editorDrawingCursor:"crosshair",editorMaxPoints:5,fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2})).properties.set("id",l),i.properties.set("content",d),M.geoObjects.add(i),i.editor.startDrawing()),i.events.add("dragend",function(){u()}),i.events.add("editorstatechange",function(){u()}),i.events.add("geometrychange",function(){u()})}function u(){r.zoom=M.getZoom();var e=M.getCenter();r.center_lat=e[0],r.center_lng=e[1];var t=M.getType().split("#");r.type=t[1]?t[1]:"map";var o=[];M.geoObjects.each(function(e){var t=e.geometry.getType();o.push({id:e.properties.get("id"),content:e.properties.get("content"),type:t,coords:e.geometry.getCoordinates()})}),r.marks=o,w(l).val(JSON.stringify(r))}r=w.parseJSON(w(l).val()),ymaps.ready(function(){!function(){a.empty(),null!=M&&(M.destroy(),M=null,l.val(""));(M=new ymaps.Map(a[0],{zoom:r.zoom,center:[r.center_lat,r.center_lng],type:"yandex#"+r.type},{minZoom:10})).controls.remove("trafficControl"),M.controls.remove("fullscreenControl"),M.behaviors.disable("scrollZoom"),M.events.add("click",function(e){d(e.get("coords")),u()}),M.events.add("typechange",function(e){u()}),M.events.add("boundschange",function(){u()}),0===r.marks.length&&(console.log("Geocoder works here"),ymaps.geocode(y).then(function(e){var t=e.geoObjects.get(0),o=t.geometry.getCoordinates(),n=t.properties.get("boundedBy");d(o,"Point",0,1,""),M.setBounds(n,{checkZoomRange:!0}),u()},function(e){console.log("Yandex.Maps Geocoder Error")}));var e=M.controls.get("searchControl");e.options.set({noPlacemark:!0,useMapBounds:!0,noSelect:!0,kind:"locality",width:250}),e.events.add("resultselect",function(){u()}),M.controls.get("geolocationControl").events.add("locationchange",function(){u()});var t=new ymaps.control.ZoomControl;t.events.add("zoomchange",function(e){u()}),M.controls.add(t,{top:75,left:5});var o=new ymaps.control.Button({data:{content:acf_yandex_locale.btn_clear_all,title:acf_yandex_locale.btn_clear_all_hint},options:{selectOnClick:!1}});o.events.add("click",function(){M.balloon.close(),M.geoObjects.removeAll(),u()}),M.controls.add(o,{top:5,right:5}),w(r.marks).each(function(e,t){d(t.coords,t.type,t.id,t.content)});var n=M.getCenter();M.balloon.events.add("autopanbegin",function(){n=M.getCenter()}),M.balloon.events.add("close",function(){M.setCenter(n,M.getZoom(),{duration:500})}),M.balloon.events.add("open",function(){w(c).find(".ya-import form").submit(function(){return m(w(this).serializeArray()),!1}),w(c).find(".ya-import textarea, .ya-export textarea").focus().select()});var s=new ymaps.control.Button({data:{image:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik0xMi42LDRoLTEuMDIxYy0wLjI3NiwwLTAuNSwwLjIyNC0wLjUsMC41czAuMjI0LDAuNSwwLjUsMC41SDEyLjZDMTMuMzk4LDUsMTQsNS42NDUsMTQsNi41djZjMCwwLjg1NS0wLjYwMiwxLjUtMS40LDEuNWgtMTBDMS43NDgsMTQsMSwxMy4yOTksMSwxMi41di02QzEsNS43MDEsMS43NDgsNSwyLjYsNWgwLjc2OGMwLjI3NiwwLDAuNS0wLjIyNCwwLjUtMC41UzMuNjQ1LDQsMy4zNjgsNEgyLjZDMS4xOTEsNCwwLDUuMTQ1LDAsNi41djZDMCwxMy44NTUsMS4xOTEsMTUsMi42LDE1aDEwYzEuMzQ2LDAsMi40LTEuMDk4LDIuNC0yLjV2LTZDMTUsNS4wOTgsMTMuOTQ1LDQsMTIuNiw0eiIvPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik03LjEzMywxMC4wMzRjMC4xMzcsMC4zMTUsMC41NjgsMC40MTMsMC43MDMsMC4xMDFjMC4wMTItMC4wMjksMS4xNzctMi40MTksMS45MjktMy4zNzNjMC4yNjQtMC4zMzUtMC4wOTUtMC42NC0wLjQ2My0wLjUzQzguOTgsNi4zMjgsNy45NjYsNy4wNTIsNy45NjYsNy4xMDFWMC41NzZjMC0wLjI3Ni0wLjE4OC0wLjU5MS0wLjQ2NS0wLjU5MWMtMC4wMDIsMC0wLjAwMywwLjAwMS0wLjAwNSwwLjAwMXMwLjAwMS0wLjAwMS0wLjAwMS0wLjAwMWMtMC4yNzYsMC0wLjQ5NSwwLjIyNC0wLjQ5NSwwLjVWNy4wMWMwLTAuMDQ5LTEuMDE4LTAuNzc0LTEuMzM5LTAuODY5Yy0wLjM2OC0wLjExLTAuNzE4LDAuMTg3LTAuNDY2LDAuNTNDNS44Nyw3LjU4Nyw2LjY1OSw4Ljk0Myw3LjEzMywxMC4wMzR6Ii8+PC9nPjwvc3ZnPg==",title:acf_yandex_locale.btn_import},options:{selectOnClick:!1}});s.events.add("click",function(){M.balloon.close(),M.balloon.open(M.getBounds()[0],'<div class="ya-import" style="margin: 5px"><p class="description">'+acf_yandex_locale.import_desc+'</p><form><textarea name="import" cols="40" rows="5" autofocus></textarea><br><input type="submit" class="button" name="submit" value="'+acf_yandex_locale.import_go+'"/></form></div>')});var i=new ymaps.control.Button({data:{image:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik0xMi42LDRoLTEuMDIxYy0wLjI3NiwwLTAuNSwwLjIyNC0wLjUsMC41czAuMjI0LDAuNSwwLjUsMC41SDEyLjZDMTMuMzk4LDUsMTQsNS42NDUsMTQsNi41djZjMCwwLjg1NS0wLjYwMiwxLjUtMS40LDEuNWgtMTBDMS43NDgsMTQsMSwxMy4yOTksMSwxMi41di02QzEsNS43MDEsMS43NDgsNSwyLjYsNWgwLjc2OGMwLjI3NiwwLDAuNS0wLjIyNCwwLjUtMC41UzMuNjQ1LDQsMy4zNjgsNEgyLjZDMS4xOTEsNCwwLDUuMTQ1LDAsNi41djZDMCwxMy44NTUsMS4xOTEsMTUsMi42LDE1aDEwYzEuMzQ2LDAsMi40LTEuMDk4LDIuNC0yLjV2LTZDMTUsNS4wOTgsMTMuOTQ1LDQsMTIuNiw0eiIvPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik03Ljg2OCwwLjIyNWMtMC4xMzctMC4zMTUtMC42MDItMC4zMjItMC43MzctMC4wMUM3LjExOCwwLjI0NCw1Ljk1NCwyLjYzNCw1LjIwMiwzLjU4OGMtMC4yNjQsMC4zMzUsMC4wOTUsMC42NCwwLjQ2MywwLjUzQzUuOTg2LDQuMDIyLDcsMy4yOTgsNywzLjI0OXY2LjUyNmMwLDAuMjc2LDAuMjIzLDAuNSwwLjQ5OSwwLjVjMC4wMDIsMCwwLjAwMy0wLjAwMSwwLjAwNS0wLjAwMXMtMC4wMDEsMC4wMDEsMC4wMDEsMC4wMDFjMC4yNzYsMCwwLjQ5NS0wLjIyNCwwLjQ5NS0wLjVWMy4yNDljMCwwLjA0OSwxLjAxOCwwLjc3NCwxLjMzOSwwLjg2OWMwLjM2OCwwLjExLDAuNzE4LTAuMTg3LDAuNDY2LTAuNTNDOS4xMzEsMi42NzEsOC4zNDEsMS4zMTUsNy44NjgsMC4yMjV6Ii8+PC9nPjwvc3ZnPg==",title:acf_yandex_locale.btn_export},options:{selectOnClick:!1}});i.events.add("click",function(){M.balloon.close(),M.balloon.open(M.getBounds()[0],'<div class="ya-export" style="margin: 5px"><p class="description">'+acf_yandex_locale.export_desc+'</p><textarea cols="40" rows="5" readonly>'+JSON.stringify(r)+"</textarea></div>")}),M.events.add("balloonopen",function(){w(".ya-editor textarea").focus(),w(".ya-editor .remove").click(function(e){var t=w(e.currentTarget).parent("form").children('input[type="hidden"]').val();return null==t||(M.balloon.close(),M.geoObjects.each(function(e){e.properties.get("id")==t&&M.geoObjects.remove(e)})),!1}),w(".ya-editor form").submit(function(){var e=w(this).serializeArray(),o={};return w.map(e,function(e,t){o[e.name]=e.value}),M.geoObjects.each(function(e){e.properties.get("id")==o.id&&(e.properties.set("content",o.content),u())}),M.balloon.close(),!1})}),M.controls.add(i,{top:5,right:5}),M.controls.add(s,{top:5,right:5})}()}),console.log(e),console.log(t);function m(e){if(0==e.length)return!1;try{var t=e.features}catch(e){return console.error(e,"Import map error"),alert("Import map error"),!1}r.zoom=13,r.center_lat=59.99914531368303,r.center_lng=30.72482104954271,r.type="map",w.each(t,function(e,t){r.marks[e]={id:t.id,content:t.id,type:t.geometry.type,coords:t.geometry.coordinates}}),console.log(r)}m({type:"FeatureCollection",features:[{type:"Feature",postType:"land",id:261,link:"http://vsevreestr.localhost/land/uchastok-10-2-sotki-tajtsy-leningradskaya-oblast/",options:{fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2,opacity:.75},geometry:{type:"Point",coordinates:[59.664626,30.123961]},properties:{balloonContentHeader:'<div class="module--header"><div class="module--title module--title-available">Участок №312</div><div class="module--status status status-nopadding js-status">Свободен</div></div>',balloonContentBody:'<div class="module--body"><div class="module--item module--item-50 common_item"><div class="common_item--title"><em>Площадь участка</em></div><div class="common_item--value">10,2 сот.</div></div><div class="module--item module--item-50 common_item"><div class="common_item--title"><em>Стоимость</em></div><div class="common_item--value"><span class="js-money">900000</span> ₽</div></div><div class="module--item icb d-none d-lg-block"><i class="icb--icon icon icon-mountain"></i><div class="icb--title"></div></div><div class="module--item slope slope-hor d-none d-lg-flex"><div class="slope--title slope--title-hor">Уклон участка</div><div class="slope--subtitle slope--subtitle-hor js-typo"></div></div></div>',balloonContentFooter:'<div class="module--footer"><a href="http://vsevreestr.localhost/land/uchastok-10-2-sotki-tajtsy-leningradskaya-oblast/" class="module--more">Подробнее об участке</a><button type="button" class="module--but but but-green" data-toggle="modal" data-target="#orderModal">Забронировать</button></div>',hintContent:"Ленинградская область, пос. Тайцы, ул. Вокзальная, дом 34, корп. 1"}},{type:"Feature",postType:"land",id:196,link:"http://vsevreestr.localhost/land/uchastok-860/",options:{fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2,opacity:.75},geometry:{type:"Point",coordinates:[59.681866995826574,30.111483041779966]},properties:{balloonContentHeader:'<div class="module--header"><div class="module--title module--title-available">Участок №</div><div class="module--status status status-nopadding js-status">Свободен</div></div>',balloonContentBody:'<div class="module--body"><div class="module--item module--item-50 common_item"><div class="common_item--title"><em>Площадь участка</em></div><div class="common_item--value">10 сот.</div></div><div class="module--item module--item-50 common_item"><div class="common_item--title"><em>Стоимость</em></div><div class="common_item--value"><span class="js-money">650000</span> ₽</div></div><div class="module--item icb d-none d-lg-block"><i class="icb--icon icon icon-mountain"></i><div class="icb--title"></div></div><div class="module--item slope slope-hor d-none d-lg-flex"><div class="slope--title slope--title-hor">Уклон участка</div><img src="http://10.0.0.38:3000/wp-content/themes/vsevreestr/svg/landscape/rovn_SN.svg" alt="Ландшафт" class="slope--img slope--img-hor"><div class="slope--subtitle slope--subtitle-hor js-typo"></div></div></div>',balloonContentFooter:'<div class="module--footer"><a href="http://vsevreestr.localhost/land/uchastok-860/" class="module--more">Подробнее об участке</a><button type="button" class="module--but but but-green" data-toggle="modal" data-target="#orderModal">Забронировать</button></div>',hintContent:"Ленинградская область, пос. Тайцы, пгт Тайцы, ул. Балтийская"}}]}),w(".marker-type").on("change",function(){var e=w(this).parent().next("th").children(0),t=w(this).parent().next("th").next("td").children(0);"circle"==this.value?(e.removeClass("hidden"),t.removeClass("hidden")):(e.addClass("hidden"),t.addClass("hidden"))})}void 0!==acf.add_action?acf.add_action("ready append",function(e){acf.get_fields({type:"yandex-map"},e).each(function(){o(w(this))})}):w(document).on("acf/setup_fields",function(e,t){w(t).find('.field[data-field_type="yandex-map"]').each(function(){o(w(this))})})}(jQuery);
//# sourceMappingURL=acf-yandex-map.min.js.map