!function(u){acf_yandex_locale.blog_url;var r=acf_yandex_locale.template_url,l=(acf_yandex_locale.post_type,acf_yandex_locale.term_id,acf_yandex_locale.term_slug);function n(s){var n,o,d,p,f=null;if(n=u(s).find(".map"),o=s.find(".map-input"),null==n||null==o)return console.error(acf_yandex_locale.map_init_fail),!1;function t(){n.empty(),null!=f&&(f.destroy(),f=null,o.val("")),(f=new ymaps.Map(n[0],{zoom:d.zoom,center:[d.center_lat,d.center_lng],type:"yandex#"+d.type},{minZoom:10})).controls.remove("trafficControl"),f.controls.remove("fullscreenControl"),f.behaviors.disable("scrollZoom"),f.events.add("click",function(e){a(e.get("coords")),m()}),f.events.add("typechange",function(e){m()}),f.events.add("boundschange",function(){m()});var e=new ymaps.control.ZoomControl;e.events.add("zoomchange",function(e){m()}),f.controls.add(e,{top:75,left:5});var t=new ymaps.control.Button({data:{content:acf_yandex_locale.btn_clear_all,title:acf_yandex_locale.btn_clear_all_hint},options:{selectOnClick:!1}});t.events.add("click",function(){f.geoObjects.removeAll(),m()}),f.controls.add(t,{top:5,right:5}),p=new ymaps.GeoObjectCollection({},{preset:"islands#redCircleIcon",strokeWidth:4,geodesic:!0}),console.log(d),u(d.marks).each(function(e,t){a(t.coords,t.type,t.id,t.content,t.term)}),f.geoObjects.add(p)}function a(e,t,n,o,a){var r=null,l=null!=t?t.toLowerCase():u(s).find(".marker-type").val(),c=n;c=null==n&&0==d.marks.length?1:null==n?d.marks[d.marks.length-1].id+1:n;var i=null==o?"":o;console.log(l),"point"==l?(r=new ymaps.Placemark(e,{iconContent:c,hintContent:i},{preset:"islands#orangeDotIcon"})).events.add("contextmenu",function(){f.geoObjects.remove(this),m()},r):(2===e.length&&(e=[]),(r=new ymaps.Polygon(e,{},{draggable:!0,editorDrawingCursor:"crosshair",editorMaxPoints:5,fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2})).editor.startDrawing()),r.properties.set("id",c),r.properties.set("content",i),console.log(a),null!=a?p.add(r):(r.options.set("draggable","true"),f.geoObjects.add(r),r.events.add("dragend",function(){m()}),r.events.add("editorstatechange",function(){m()}),r.events.add("geometrychange",function(){m()}))}function m(){d.zoom=f.getZoom();var e=f.getCenter();d.center_lat=e[0],d.center_lng=e[1];var t=f.getType().split("#");d.type=t[1]?t[1]:"map";var n=[];f.geoObjects.each(function(e){if(null!=e.geometry){var t=e.geometry.getType();n.push({id:e.properties.get("id"),content:e.properties.get("content"),type:t,coords:e.geometry.getCoordinates()})}}),d.marks=n,console.log(d),u(o).val(JSON.stringify(d))}d=u.parseJSON(u(o).val()),ymaps.ready(function(){if("no-project"!=l){console.log("Import start");var e=r+"/map/data-project-"+l+".json";u.when(u.get(e,function(e){0<e.features.length&&(d.zoom=13,d.center_lat=59.99914531368303,d.center_lng=30.72482104954271,d.type="map",u.each(e.features,function(e,t){d.marks[e]={id:t.id,content:t.id,type:t.geometry.type,term:t.term,coords:t.geometry.coordinates}}))})).done(function(){t()}).fail(function(){console.log("Project import error")})}else console.log("Just map start"),t()}),u(".marker-type").on("change",function(){var e=u(this).parent().next("th").children(0),t=u(this).parent().next("th").next("td").children(0);"circle"==this.value?(e.removeClass("hidden"),t.removeClass("hidden")):(e.addClass("hidden"),t.addClass("hidden"))})}void 0!==acf.add_action?acf.add_action("ready append",function(e){acf.get_fields({type:"yandex-map"},e).each(function(){n(u(this))})}):u(document).on("acf/setup_fields",function(e,t){u(t).find('.field[data-field_type="yandex-map"]').each(function(){n(u(this))})})}(jQuery);
//# sourceMappingURL=acf-yandex-map.min.js.map