!function(m){var p=m('[data-name="location-district"] input').val()+", "+m('[data-name="location-city"] select option[selected="selected"]').text()+", "+m('[data-name="location-address"] input').val(),e=acf_yandex_locale.blog_url,y=acf_yandex_locale.template_url,t=acf_yandex_locale.term_slug,o=(acf_yandex_locale.post_type,acf_yandex_locale.term_id),M={fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2,opacity:.75};function n(d){var s,c,r,M=null;if(s=m(d).find(".map"),c=d.find(".map-input"),null==s||null==c)return console.error(acf_yandex_locale.map_init_fail),!1;function l(e,t,o,n,a){var i=null,s=null!=t?t.toLowerCase():m(d).find(".marker-type").val(),c=n;c=null==n&&0==r.marks.length?1:null==n?r.marks[r.marks.length-1].id+1:n;var l=null==a?"":a;"point"==s?((i=new ymaps.Placemark(e,{hintContent:acf_yandex_locale.mark_hint},{preset:"islands#orangeDotIcon",draggable:!0})).events.add("contextmenu",function(){M.geoObjects.remove(this),u()},i),i.properties.set("id",c),i.properties.set("content",l),M.geoObjects.add(i)):(2===e.length&&(e=[]),(i=new ymaps.Polygon(e,{},{draggable:!0,editorDrawingCursor:"crosshair",editorMaxPoints:5,fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2})).properties.set("id",c),i.properties.set("content",l),M.geoObjects.add(i),i.editor.startDrawing()),i.events.add("dragend",function(){u()}),i.events.add("editorstatechange",function(){u()}),i.events.add("geometrychange",function(){u()})}function u(){r.zoom=M.getZoom();var e=M.getCenter();r.center_lat=e[0],r.center_lng=e[1];var t=M.getType().split("#");r.type=t[1]?t[1]:"map";var o=[];M.geoObjects.each(function(e){var t=e.geometry.getType();o.push({id:e.properties.get("id"),content:e.properties.get("content"),type:t,coords:e.geometry.getCoordinates()})}),r.marks=o,m(c).val(JSON.stringify(r))}r=m.parseJSON(m(c).val()),ymaps.ready(function(){!function(){s.empty(),null!=M&&(M.destroy(),M=null,c.val(""));(M=new ymaps.Map(s[0],{zoom:r.zoom,center:[r.center_lat,r.center_lng],type:"yandex#"+r.type},{minZoom:10})).controls.remove("trafficControl"),M.controls.remove("fullscreenControl"),M.behaviors.disable("scrollZoom"),M.events.add("click",function(e){l(e.get("coords")),u()}),M.events.add("typechange",function(e){u()}),M.events.add("boundschange",function(){u()}),0===r.marks.length&&(console.log("Geocoder works here"),ymaps.geocode(p).then(function(e){var t=e.geoObjects.get(0),o=t.geometry.getCoordinates(),n=t.properties.get("boundedBy");l(o,"Point",0,1,""),M.setBounds(n,{checkZoomRange:!0}),u()},function(e){console.log("Yandex.Maps Geocoder Error")}));var e=M.controls.get("searchControl");e.options.set({noPlacemark:!0,useMapBounds:!0,noSelect:!0,kind:"locality",width:250}),e.events.add("resultselect",function(){u()}),M.controls.get("geolocationControl").events.add("locationchange",function(){u()});var t=new ymaps.control.ZoomControl;t.events.add("zoomchange",function(e){u()}),M.controls.add(t,{top:75,left:5});var o=new ymaps.control.Button({data:{content:acf_yandex_locale.btn_clear_all,title:acf_yandex_locale.btn_clear_all_hint},options:{selectOnClick:!1}});o.events.add("click",function(){M.balloon.close(),M.geoObjects.removeAll(),u()}),M.controls.add(o,{top:5,right:5}),m(r.marks).each(function(e,t){l(t.coords,t.type,t.id,t.content)});var n=M.getCenter();M.balloon.events.add("autopanbegin",function(){n=M.getCenter()}),M.balloon.events.add("close",function(){M.setCenter(n,M.getZoom(),{duration:500})}),M.balloon.events.add("open",function(){m(d).find(".ya-import form").submit(function(){return w(m(this).serializeArray()),!1}),m(d).find(".ya-import textarea, .ya-export textarea").focus().select()});var a=new ymaps.control.Button({data:{image:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik0xMi42LDRoLTEuMDIxYy0wLjI3NiwwLTAuNSwwLjIyNC0wLjUsMC41czAuMjI0LDAuNSwwLjUsMC41SDEyLjZDMTMuMzk4LDUsMTQsNS42NDUsMTQsNi41djZjMCwwLjg1NS0wLjYwMiwxLjUtMS40LDEuNWgtMTBDMS43NDgsMTQsMSwxMy4yOTksMSwxMi41di02QzEsNS43MDEsMS43NDgsNSwyLjYsNWgwLjc2OGMwLjI3NiwwLDAuNS0wLjIyNCwwLjUtMC41UzMuNjQ1LDQsMy4zNjgsNEgyLjZDMS4xOTEsNCwwLDUuMTQ1LDAsNi41djZDMCwxMy44NTUsMS4xOTEsMTUsMi42LDE1aDEwYzEuMzQ2LDAsMi40LTEuMDk4LDIuNC0yLjV2LTZDMTUsNS4wOTgsMTMuOTQ1LDQsMTIuNiw0eiIvPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik03LjEzMywxMC4wMzRjMC4xMzcsMC4zMTUsMC41NjgsMC40MTMsMC43MDMsMC4xMDFjMC4wMTItMC4wMjksMS4xNzctMi40MTksMS45MjktMy4zNzNjMC4yNjQtMC4zMzUtMC4wOTUtMC42NC0wLjQ2My0wLjUzQzguOTgsNi4zMjgsNy45NjYsNy4wNTIsNy45NjYsNy4xMDFWMC41NzZjMC0wLjI3Ni0wLjE4OC0wLjU5MS0wLjQ2NS0wLjU5MWMtMC4wMDIsMC0wLjAwMywwLjAwMS0wLjAwNSwwLjAwMXMwLjAwMS0wLjAwMS0wLjAwMS0wLjAwMWMtMC4yNzYsMC0wLjQ5NSwwLjIyNC0wLjQ5NSwwLjVWNy4wMWMwLTAuMDQ5LTEuMDE4LTAuNzc0LTEuMzM5LTAuODY5Yy0wLjM2OC0wLjExLTAuNzE4LDAuMTg3LTAuNDY2LDAuNTNDNS44Nyw3LjU4Nyw2LjY1OSw4Ljk0Myw3LjEzMywxMC4wMzR6Ii8+PC9nPjwvc3ZnPg==",title:acf_yandex_locale.btn_import},options:{selectOnClick:!1}});a.events.add("click",function(){M.balloon.close(),M.balloon.open(M.getBounds()[0],'<div class="ya-import" style="margin: 5px"><p class="description">'+acf_yandex_locale.import_desc+'</p><form><textarea name="import" cols="40" rows="5" autofocus></textarea><br><input type="submit" class="button" name="submit" value="'+acf_yandex_locale.import_go+'"/></form></div>')});var i=new ymaps.control.Button({data:{image:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik0xMi42LDRoLTEuMDIxYy0wLjI3NiwwLTAuNSwwLjIyNC0wLjUsMC41czAuMjI0LDAuNSwwLjUsMC41SDEyLjZDMTMuMzk4LDUsMTQsNS42NDUsMTQsNi41djZjMCwwLjg1NS0wLjYwMiwxLjUtMS40LDEuNWgtMTBDMS43NDgsMTQsMSwxMy4yOTksMSwxMi41di02QzEsNS43MDEsMS43NDgsNSwyLjYsNWgwLjc2OGMwLjI3NiwwLDAuNS0wLjIyNCwwLjUtMC41UzMuNjQ1LDQsMy4zNjgsNEgyLjZDMS4xOTEsNCwwLDUuMTQ1LDAsNi41djZDMCwxMy44NTUsMS4xOTEsMTUsMi42LDE1aDEwYzEuMzQ2LDAsMi40LTEuMDk4LDIuNC0yLjV2LTZDMTUsNS4wOTgsMTMuOTQ1LDQsMTIuNiw0eiIvPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik03Ljg2OCwwLjIyNWMtMC4xMzctMC4zMTUtMC42MDItMC4zMjItMC43MzctMC4wMUM3LjExOCwwLjI0NCw1Ljk1NCwyLjYzNCw1LjIwMiwzLjU4OGMtMC4yNjQsMC4zMzUsMC4wOTUsMC42NCwwLjQ2MywwLjUzQzUuOTg2LDQuMDIyLDcsMy4yOTgsNywzLjI0OXY2LjUyNmMwLDAuMjc2LDAuMjIzLDAuNSwwLjQ5OSwwLjVjMC4wMDIsMCwwLjAwMy0wLjAwMSwwLjAwNS0wLjAwMXMtMC4wMDEsMC4wMDEsMC4wMDEsMC4wMDFjMC4yNzYsMCwwLjQ5NS0wLjIyNCwwLjQ5NS0wLjVWMy4yNDljMCwwLjA0OSwxLjAxOCwwLjc3NCwxLjMzOSwwLjg2OWMwLjM2OCwwLjExLDAuNzE4LTAuMTg3LDAuNDY2LTAuNTNDOS4xMzEsMi42NzEsOC4zNDEsMS4zMTUsNy44NjgsMC4yMjV6Ii8+PC9nPjwvc3ZnPg==",title:acf_yandex_locale.btn_export},options:{selectOnClick:!1}});i.events.add("click",function(){M.balloon.close(),M.balloon.open(M.getBounds()[0],'<div class="ya-export" style="margin: 5px"><p class="description">'+acf_yandex_locale.export_desc+'</p><textarea cols="40" rows="5" readonly>'+JSON.stringify(r)+"</textarea></div>")}),M.events.add("balloonopen",function(){m(".ya-editor textarea").focus(),m(".ya-editor .remove").click(function(e){var t=m(e.currentTarget).parent("form").children('input[type="hidden"]').val();return null==t||(M.balloon.close(),M.geoObjects.each(function(e){e.properties.get("id")==t&&M.geoObjects.remove(e)})),!1}),m(".ya-editor form").submit(function(){var e=m(this).serializeArray(),o={};return m.map(e,function(e,t){o[e.name]=e.value}),M.geoObjects.each(function(e){e.properties.get("id")==o.id&&(e.properties.set("content",o.content),u())}),M.balloon.close(),!1})}),M.controls.add(i,{top:5,right:5}),M.controls.add(a,{top:5,right:5})}()});function w(e){m.get(e,function(e){if(0<e.features.length)return r.zoom=13,r.center_lat=59.99914531368303,r.center_lng=30.72482104954271,r.type="map",m.each(e.features,function(e,t){r.marks[e]={id:t.id,content:t.id,type:t.geometry.type,coords:t.geometry.coordinates}}),console.log(r),!1})}w(y+"/ajax/data-project-"+t+".json"),m(".marker-type").on("change",function(){var e=m(this).parent().next("th").children(0),t=m(this).parent().next("th").next("td").children(0);"circle"==this.value?(e.removeClass("hidden"),t.removeClass("hidden")):(e.addClass("hidden"),t.addClass("hidden"))})}console.log(e+"/wp-json/wp/v2/land?project="+o),m.get({dataType:"json",url:e+"/wp-json/wp/v2/land?project="+o,success:function(e){var r={type:"FeatureCollection",features:[]};m.each(e,function(e,t){var o=t.acf["location-district"]+", "+t.acf["location-city"].name+", "+t.acf["location-address"],n=t.acf["land-square"]+" сот.";if(0<t.acf["landscape-pic"].length)var a='<img src="'+y+"/svg/landscape/"+t.acf["landscape-pic"]+'.svg" alt="Ландшафт" class="slope--img slope--img-hor">';else a="";if(null!=t.acf.status)var i=t.acf.status.name;if(null!=t.acf.ymap)var s=m.parseJSON(t.acf.ymap);if(null!=t.acf.ymap&&0<s.marks.length)var c=s.marks[0].coords,l=1===c.length?"Polygon":"Point";var d={type:"Feature",postType:t.type,id:t.id,link:t.link,options:M,geometry:{type:l,coordinates:c},properties:{balloonContentHeader:'<div class="module--header"><div class="module--title module--title-available">Участок №'+t.acf["land-id"]+'</div><div class="module--status status status-nopadding js-status">'+i+"</div></div>",balloonContentBody:'<div class="module--body"><div class="module--item module--item-50 common_item"><div class="common_item--title"><em>Площадь участка</em></div><div class="common_item--value">'+n+'</div></div><div class="module--item module--item-50 common_item"><div class="common_item--title"><em>Стоимость</em></div><div class="common_item--value"><span class="js-money">'+t.acf.price+'</span> ₽</div></div><div class="module--item icb d-none d-lg-block"><i class="icb--icon icon icon-mountain"></i><div class="icb--title">'+t.acf["spec-land"].mountain+'</div></div><div class="module--item slope slope-hor d-none d-lg-flex"><div class="slope--title slope--title-hor">Уклон участка</div>'+a+'<div class="slope--subtitle slope--subtitle-hor js-typo">'+t.acf["landscape-descr"]+"</div></div></div>",balloonContentFooter:'<div class="module--footer"><a href="'+t.link+'" class="module--more">Подробнее об участке</a><button type="button" class="module--but but but-green" data-toggle="modal" data-target="#orderModal">Забронировать</button></div>',hintContent:o}};r.features.push(d)}),function(e,t,o){"project"===t&&m.when(m.post({url:y+"/ajax/ajax-map.php",data:{postType:t,name:o,json:JSON.stringify(e,"",2)},success:function(e){console.log("AJAX POST "+t.toUpperCase())}})).then(function(){})}(r,"project",t)},error:function(e){console.log("JSON Error")}}),void 0!==acf.add_action?acf.add_action("ready append",function(e){acf.get_fields({type:"yandex-map"},e).each(function(){n(m(this))})}):m(document).on("acf/setup_fields",function(e,t){m(t).find('.field[data-field_type="yandex-map"]').each(function(){n(m(this))})})}(jQuery);
//# sourceMappingURL=acf-yandex-map.min.js.map