{"version":3,"sources":["yandex-map.js"],"names":["$","plugin_url","yandex_locale","mark_style_house_orange","iconLayout","iconImageHref","iconImageSize","iconImageOffset","polygon_style_green","fillColor","strokeColor","strokeWidth","opacity","ymaps","ready","each","index","value","id","attr","undefined","window","$params","parseJSON","$map","Map","zoom","center","center_lat","center_lng","controls","remove","marks","mark","place_mark","type","Placemark","coords","balloonContent","content","Circle","circle_size","fillOpacity","strokeOpacity","geoObjects","add","$object_manager","ObjectManager","geoObjectOpenBalloonOnClick","object_style","Object","assign","load_objects","data_type","ajax","url","done","data","console","log","setBounds","getBounds","checkZoomRange","fail","error","objects","options","set","events","e","objectId","get","obj","getById","properties","hasBalloonData","balloon","open","dataDeferred","vow","defer","setTimeout","resolve","promise","loadBalloonData","then","setData","on","removeAll","jQuery"],"mappings":"CAAA,SAAWA,GAOP,IAAIC,EAAaC,cAAcD,WAc3BE,EAA0B,CAC1BC,WAAY,gBACZC,cAAeJ,EAAa,uBAC5BK,cAAe,CAAC,GAAI,IACpBC,gBAAiB,EAAE,IAAK,KAGxBC,EAAsB,CACtBC,UAAW,UACXC,YAAa,UACbC,YAAa,EACbC,QAAS,IAUbC,MAAMC,MAAM,WAEId,EAAE,eACRe,KAAK,SAAUC,EAAOC,GACxB,IACIC,EADclB,EAAEiB,GACCE,KAAK,MAE1B,QAAWC,IAAPF,QAAmCE,IAAfC,OAAOH,GAAmB,CAE9C,IAAII,EAAUtB,EAAEuB,UAAUF,OAAOH,GAAY,QAEzCM,EAAO,IAAIX,MAAMY,IAAIP,EAAI,CACzBQ,KAAMJ,EAAQI,KACdC,OAAQ,CAACL,EAAQM,WAAYN,EAAQO,aAGtC,IA4CH,GAxCAL,EAAKM,SAASC,OAAO,kBACrBP,EAAKM,SAASC,OAAO,iBACrBP,EAAKM,SAASC,OAAO,sBAGAX,MAAjBE,EAAQU,OAERhC,EAAEsB,EAAQU,OAAOjB,KAAK,SAAUC,EAAOiB,GACnC,IAAIC,EAAa,KAIbA,EAFa,SAAbD,EAAKE,KAEQ,IAAItB,MAAMuB,UAAUH,EAAKI,OAAQ,CAC1CC,eAAgBL,EAAKM,UAKZ,IAAI1B,MAAM2B,OAAO,CAC1BP,EAAKI,OACLJ,EAAKQ,aACN,CACCH,eAAgBL,EAAKM,SACtB,CACC3B,QAAS,GACT8B,YAAa,GACbjC,UAAW,YACXC,YAAa,UACbiC,cAAe,GACfhC,YAAa,IAKrBa,EAAKoB,WAAWC,IAAIX,KAMjB,cAAPhB,EAAoB,CAEpB4B,gBAAkB,IAAIjC,MAAMkC,cAAc,CAMtCC,6BAA6B,IAIjC,IAAIC,EAAeC,OAAOC,OAAQ,GAAIhD,EAAyBK,GAgD/D,SAAS4C,EAAaC,GAElB7B,EAAKoB,WAAWC,IAAIC,iBAEpB,IAAI7C,EAAaoB,OAAOH,GAAgB,WAExClB,EAAEsD,KAAK,CACHC,IAAKtD,EAAa,QAAUoD,EAAY,UAE3CG,KAAK,SAASC,GACXX,gBAAgBD,IAAIY,GACpBC,QAAQC,IAAI,mBACZnC,EAAKoC,UAAUpC,EAAKoB,WAAWiB,YAAa,CACxCC,gBAAgB,MAGvBC,KAAK,WACFL,QAAQM,MAAM,oBAhEtBlB,gBAAgBmB,QAAQC,QAAQC,IAAIlB,GAiBpCH,gBAAgBmB,QAAQG,OAAOvB,IAAI,QAAS,SAAUwB,GAClD,IAAIC,EAAWD,EAAEE,IAAI,YACjBC,EAAM1B,gBAAgBmB,QAAQQ,QAAQH,IAN9C,SAAwBA,GACpB,OAAOxB,gBAAgBmB,QAAQQ,QAAQH,GAAUI,WAAWpC,eAMxDqC,CAAeL,IAGfE,EAAIE,WAAWpC,eAAiB,0BAChCQ,gBAAgBmB,QAAQW,QAAQC,KAAKP,GApB7C,SAA0BA,GACtB,IAAIQ,EAAejE,MAAMkE,IAAIC,QAK7B,OADA3D,OAAO4D,WAHP,WACIH,EAAaI,QAAQ,kBAEM,KACxBJ,EAAaK,UAehBC,GAA0BC,KAAK,SAAU5B,GACrCe,EAAIE,WAAWpC,eAAiBmB,EAChCX,gBAAgBmB,QAAQW,QAAQU,QAAQd,MAN5C1B,gBAAgBmB,QAAQW,QAAQC,KAAKP,KA+C7CtE,EAAE,iBAAiBuF,GAAG,QAAS,WAC3BzC,gBAAgB0C,YAChBpC,EAAa,sBAIjBpD,EAAE,sBAAsBuF,GAAG,QAAS,WAChCzC,gBAAgB0C,YAChBpC,EAAa,uBA/LrC,CAyMGqC","file":"yandex-map.min.js","sourcesContent":["(function ($) {\n\n    // 'use strict';\n\n    /**\n     * Plugin url\n     */\n    var plugin_url = yandex_locale.plugin_url;\n\n    /**\n     * Include common vars\n     */\n    // Common vars\n    \n    var mark_style_house_green = {\n        iconLayout: 'default#image',\n        iconImageHref: plugin_url + 'svg/mark-house-2.svg',\n        iconImageSize: [36, 36],\n        iconImageOffset: [-18, -36]\n    };\n    \n    var mark_style_house_orange = {\n        iconLayout: 'default#image',\n        iconImageHref: plugin_url + 'svg/mark-house-1.svg',\n        iconImageSize: [36, 36],\n        iconImageOffset: [-18, -36]\n    };\n    \n    var polygon_style_green = {\n        fillColor: '#44A147',\n        strokeColor: '#18803F',\n        strokeWidth: 2,\n        opacity: 0.7\n    };\n    \n    var polygon_style_orange = {\n        fillColor: 'rgba(0,0,0,0.00)',\n        strokeColor: '#EC6B23',\n        strokeWidth: 2,\n        opacity: 0.7\n    };\n\n    ymaps.ready(function () {\n\n        var $maps = $('.yandex-map');\n        $maps.each(function (index, value) {\n            var $mapElement = $(value),\n                id = $mapElement.attr('id');\n\n            if (id !== undefined && window[id] !== undefined) {\n\n                var $params = $.parseJSON(window[id]['params']);\n\n                var $map = new ymaps.Map(id, {\n                    zoom: $params.zoom,\n                    center: [$params.center_lat, $params.center_lng],\n                    // type: 'yandex#' + $params.type,\n                    // behaviors: ['dblClickZoom', 'multiTouch', 'drag']\n                }, {\n                    // minZoom: 10\n                });\n\n                $map.controls.remove('trafficControl');\n                $map.controls.remove('searchControl');\n                $map.controls.remove('geolocationControl');\n\n                // Object map (need test)!\n                if ($params.marks != undefined) {\n                   \n                    $($params.marks).each(function (index, mark) {\n                        var place_mark = null;\n\n                        if (mark.type == 'Point') { // create placemark\n\n                            place_mark = new ymaps.Placemark(mark.coords, {\n                                balloonContent: mark.content\n                            });\n\n                        } else { // if mark is circle\n\n                            place_mark = new ymaps.Circle([\n                                mark.coords,\n                                mark.circle_size\n                            ], {\n                                balloonContent: mark.content\n                            }, {\n                                opacity: 0.5,\n                                fillOpacity: 0.1,\n                                fillColor: \"#DB709377\",\n                                strokeColor: \"#990066\",\n                                strokeOpacity: 0.7,\n                                strokeWidth: 5\n                            });\n\n                        }\n\n                        $map.geoObjects.add(place_mark);\n                    });\n\n                }\n\n                // Main map\n                if (id === 'ymap_full') {\n\n                    $object_manager = new ymaps.ObjectManager({\n                        // doesn't works with polygon\n                        // clusterize: true,\n                        // gridSize: 32\n\n                        // disable default baloon\n                        geoObjectOpenBalloonOnClick: false\n                    });\n\n                    // set common style\n                    var object_style = Object.assign( {}, mark_style_house_orange, polygon_style_green );\n                    $object_manager.objects.options.set(object_style);\n\n                    // load baloon data\n                    // Функция, эмулирующая запрос за данными на сервер.\n                    function loadBalloonData (objectId) {\n                        var dataDeferred = ymaps.vow.defer();\n                        function resolveData () {\n                            dataDeferred.resolve('Данные балуна');\n                        }\n                        window.setTimeout(resolveData, 1000);\n                        return dataDeferred.promise();\n                    }\n\n                    function hasBalloonData(objectId) {\n                        return $object_manager.objects.getById(objectId).properties.balloonContent;\n                    }\n\n                    $object_manager.objects.events.add('click', function (e) {\n                        var objectId = e.get('objectId'),\n                            obj = $object_manager.objects.getById(objectId);\n                        if (hasBalloonData(objectId)) {\n                            $object_manager.objects.balloon.open(objectId);\n                        } else {\n                            obj.properties.balloonContent = \"Идет загрузка данных...\";\n                            $object_manager.objects.balloon.open(objectId);\n                            loadBalloonData(objectId).then(function (data) {\n                                obj.properties.balloonContent = data;\n                                $object_manager.objects.balloon.setData(obj);\n                            });\n                        }\n                    });\n                    //\n\n                        /// js sample\n                      // \"properties\": {\n                      //   \"balloonContentHeader\": \"<div class=\\\"module--header\\\"><div class=\\\"module--title module--title-available\\\">Участок №</div><div class=\\\"module--status status status-nopadding js-status\\\">Свободен</div></div>\\\"\",\n                      //   \"balloonContentBody\": \"<div class=\\\"module--body\\\"><div class=\\\"module--item module--item-50 common_item\\\"><div class=\\\"common_item--title\\\"><em>Площадь участка</em></div><div class=\\\"common_item--value\\\">12 сот.</div></div><div class=\\\"module--item module--item-50 common_item\\\"><div class=\\\"common_item--title\\\"><em>Стоимость</em></div><div class=\\\"common_item--value\\\"><span class=\\\"js-money\\\">1800000</span> ₽</div></div><div class=\\\"module--item icb d-none d-lg-block\\\"><i class=\\\"icb--icon icon icon-mountain\\\"></i><div class=\\\"icb--title\\\"></div></div><div class=\\\"module--item slope slope-hor d-none d-lg-flex\\\"><div class=\\\"slope--title slope--title-hor\\\">Уклон участка</div><img src=\\\"http://vsevreestr.localhost/wp-content/themes/vsevreestr/svg/landscape/rovn_NS.svg\\\" alt=\\\"Ландшафт\\\" class=\\\"slope--img slope--img-hor\\\"><div class=\\\"slope--subtitle slope--subtitle-hor js-typo\\\"></div></div></div>\\\"\",\n                      //   \"balloonContentFooter\": \"<div class=\\\"module--footer\\\"><a href=\\\"#\\\" class=\\\"module--more\\\">Подробнее об участке</a><button type=\\\"button\\\" class=\\\"module--but but but-green\\\" data-toggle=\\\"modal\\\" data-target=\\\"#orderModal\\\">Забронировать</button></div>\\\"\",\n                      //   \"hintContent\": \"Ленинградская область, г. Всеволожск, шоссе Южное\"\n                      // }\n\n                    /// php sample\n                    // 'balloonContentHeader' => '<div class=\"module--header\"><div class=\"module--title module--title-available\">Участок №</div><div class=\"module--status status status-nopadding js-status\">Свободен</div></div>\"',\n                    // 'balloonContentBody' => '<div class=\"module--body\"><div class=\"module--item module--item-50 common_item\"><div class=\"common_item--title\"><em>Площадь участка</em></div><div class=\"common_item--value\">12 сот.</div></div><div class=\"module--item module--item-50 common_item\"><div class=\"common_item--title\"><em>Стоимость</em></div><div class=\"common_item--value\"><span class=\"js-money\">1800000</span> ₽</div></div><div class=\"module--item icb d-none d-lg-block\"><i class=\"icb--icon icon icon-mountain\"></i><div class=\"icb--title\"></div></div><div class=\"module--item slope slope-hor d-none d-lg-flex\"><div class=\"slope--title slope--title-hor\">Уклон участка</div><img src=\"http://vsevreestr.localhost/wp-content/themes/vsevreestr/svg/landscape/rovn_NS.svg\" alt=\"Ландшафт\" class=\"slope--img slope--img-hor\"><div class=\"slope--subtitle slope--subtitle-hor js-typo\"></div></div></div>\"',\n                    // 'balloonContentFooter' => '<div class=\"module--footer\"><a href=\"#\" class=\"module--more\">Подробнее об участке</a><button type=\"button\" class=\"module--but but but-green\" data-toggle=\"modal\" data-target=\"#orderModal\">Забронировать</button></div>\"',\n\n                    // load objects\n                    function load_objects(data_type) {\n\n                        $map.geoObjects.add($object_manager);\n\n                        var plugin_url = window[id]['plugin_url'];\n\n                        $.ajax({\n                            url: plugin_url + 'json/' + data_type + '.json'\n                        })\n                        .done(function(data) {\n                            $object_manager.add(data);\n                            console.log('Map data loaded');\n                            $map.setBounds($map.geoObjects.getBounds(), {\n                                checkZoomRange: true\n                            });\n                        })\n                        .fail(function() {\n                            console.error(\"Map data error\");\n                        });\n                    }\n\n                    $('a.js-map-link').on('click', function() {\n                        $object_manager.removeAll()\n                        load_objects('land-vsevolozhsk');\n                    });\n\n\n                    $('button.js-map-link').on('click', function() {\n                        $object_manager.removeAll()\n                        load_objects('land-tajtsy');\n                    });\n\n                }\n\n            }\n        });\n\n    });\n\n})(jQuery);"]}