{"version":3,"sources":["yandex-map.js"],"names":["$","plugin_url","yandex_locale","mark_style_house_green","iconLayout","iconImageHref","iconImageSize","iconImageOffset","mark_style_house_yellow","mark_style_house_red","polygon_style_green","fillColor","strokeColor","strokeWidth","opacity","polygon_style_yellow","polygon_style_red","ymaps","ready","each","index","value","id","attr","undefined","window","$params","parseJSON","$map","Map","zoom","center","center_lat","center_lng","controls","remove","options","set","marks","mark","place_mark","type","Placemark","coords","Polygon","geoObjects","add","load_objects","filter","cat","post","url","ajax_url","data","action","nonce_code","nonce","done","response","features","length","objects","val","status","slug","object","geometry","coordinates","push","$object_manager","console","log","setBounds","getBounds","checkZoomRange","error","toggle_map","toggleClass","toggle","container","fitToViewport","ObjectManager","geoObjectOpenBalloonOnClick","events","e","object_id","get","obj","getById","postId","properties","balloonContent","has_balloon_data","balloon","open","post_id","deferred","vow","defer","baloon_data","object_json","offer_type","status_slug","status_name","title","location","thumb_url","square","price","edit_link","link","compile_baloon_data","resolve","fail","promise","load_balloon_data","then","setData","removeAll","removeAttr","on","form","this","parents","serializeArray","name","cur_cat","text","pricefrom","price_slider","noUiSlider","priceup","load_prices","current","find","current_label","current_value","select","select_label","select_value","document","getElementById","price_min","price_max","min","max","moneyMaskRefresh","create","start","connect","range","format","wNumb","decimals","values","special","prop","jQuery"],"mappings":"CAAA,SAAWA,GAKP,IAAIC,EAAaC,cAAcD,WAO3BE,EAAyB,CACzBC,WAAY,gBACZC,cAAeJ,EAAa,2BAC5BK,cAAe,CAAC,GAAI,IACpBC,gBAAiB,EAAE,IAAK,KAUxBC,EAA0B,CAC1BJ,WAAY,gBACZC,cAAeJ,EAAa,4BAC5BK,cAAe,CAAC,GAAI,IACpBC,gBAAiB,EAAE,IAAK,KAGxBE,EAAuB,CACvBL,WAAY,gBACZC,cAAeJ,EAAa,yBAC5BK,cAAe,CAAC,GAAI,IACpBC,gBAAiB,EAAE,IAAK,KAUxBG,EAAsB,CACtBC,UAAW,UACXC,YAAa,UACbC,YAAa,EACbC,QAAS,IAWTC,EAAuB,CACvBJ,UAAW,UACXC,YAAa,UACbC,YAAa,EACbC,QAAS,IAGTE,EAAoB,CACpBL,UAAW,UACXC,YAAa,UACbC,YAAa,EACbC,QAAS,IAUbG,MAAMC,MAAM,WAEIlB,EAAE,eAERmB,KAAK,SAAUC,EAAOC,GACxB,IACIC,EADctB,EAAEqB,GACCE,KAAK,MAE1B,QAAWC,IAAPF,QAAmCE,IAAfC,OAAOH,GAAmB,CAE9C,IAAII,EAAU1B,EAAE2B,UAAUF,OAAOH,GAAY,QAEzCM,EAAO,IAAIX,MAAMY,IAAIP,EAAI,CACzBQ,KAAMJ,EAAQI,KACdC,OAAQ,CAACL,EAAQM,WAAYN,EAAQO,aAGtC,IA+BH,GA3BAL,EAAKM,SAASC,OAAO,kBACrBP,EAAKM,SAASC,OAAO,iBACrBP,EAAKM,SAASC,OAAO,sBACrBP,EAAKQ,QAAQC,IAAI,kBAAmB,KAGfb,MAAjBE,EAAQY,OACRtC,EAAE0B,EAAQY,OAAOnB,KAAK,SAAUC,EAAOmB,GACnC,IAAIC,EAAa,KACA,SAAbD,EAAKE,KACLD,EAAa,IAAIvB,MAAMyB,UACnBH,EAAKI,OACL,GACAxC,GAEgB,WAAboC,EAAKE,OACZD,EAAa,IAAIvB,MAAM2B,QACnBL,EAAKI,OACL,GACAjC,IAGRkB,EAAKiB,WAAWC,IAAIN,KAKjB,cAAPlB,GAA6B,iBAAPA,EAAwB,CAgC9C,SAASyB,EAAaC,GACHA,EAATA,GAAkB,CACpBC,IAAK,OAETjD,EAAEkD,KAAK,CACHC,IAAKjD,cAAckD,SACnBC,KAAM,CACFC,OAAQ,kBACRC,WAAYrD,cAAcsD,MAC1BH,KAAML,KAGbS,KAAK,SAASC,GACX,IAAIL,EAAOrD,EAAE2B,UAAU+B,GACvB,GAA4B,EAAvBL,EAAKM,SAASC,OAAa,CAC5B,IAAIC,EAAU,GACd7D,EAAEmB,KAAKkC,EAAKM,SAAU,SAASvC,EAAO0C,GAClC,IAAIC,IAAUD,EAAU,QAAIA,EAAIC,OAAOC,KACnCC,EAAS,GACb,GAA0B,UAAtBH,EAAII,SAASzB,KAAkB,CAC3BwB,EAAS,CACTxB,KAAM,UACNnB,GAAIwC,EAAIxC,GACR4C,SAAU,CACNzB,KAAM,QACN0B,YAAaL,EAAII,SAASC,cAGlC,OAAOJ,GACH,IAAK,SACDE,EAAO7B,QAAUjC,EACjB,MACJ,IAAK,WACD8D,EAAO7B,QAAU5B,EACjB,MACJ,IAAK,SACDyD,EAAO7B,QAAU3B,EACjB,MACJ,QACIwD,EAAO7B,QAAUjC,QAGtB,GAA0B,YAAtB2D,EAAII,SAASzB,KAAoB,CACpCwB,EAAS,CACTxB,KAAM,UACNnB,GAAIwC,EAAIxC,GACR4C,SAAU,CACNzB,KAAM,UACN0B,YAAaL,EAAII,SAASC,cAGlC,OAAOJ,GACH,IAAK,SACDE,EAAO7B,QAAU1B,EACjB,MACJ,IAAK,WACDuD,EAAO7B,QAAUrB,EACjB,MACJ,IAAK,SACDkD,EAAO7B,QAAUpB,EACjB,MACJ,QACIiD,EAAO7B,QAAU1B,GAI7BmD,EAAQO,KAAKH,KAGjBI,gBAAgBvB,IAAIe,GACpBjC,EAAKiB,WAAWC,IAAIuB,iBACpBC,QAAQC,IAAI,mBACZ3C,EAAK4C,UAAU5C,EAAKiB,WAAW4B,YAAa,CACxCC,gBAAgB,SAGpBJ,QAAQK,MAAM,oBAM1B,SAASC,IACL5E,EAAE,eAAe6E,YAAY,oBAC7B7E,EAAE,iBAAiB6E,YAAY,oBAC/B7E,EAAE,cAAc6E,YAAY,mBAC5B7E,EAAE,eAAe6E,YAAY,kBAC7B7E,EAAE,cAAc6E,YAAY,iBAE5B7E,EAAE,eAAe8E,SACjB9E,EAAE,eAAe8E,SAEjBlD,EAAKmD,UAAUC,gBAzHnBX,gBAAkB,IAAIpD,MAAMgE,cAAc,CAMtCC,6BAA6B,IAIjCb,gBAAgBR,QAAQsB,OAAOrC,IAAI,QAAS,SAAUsC,GAClD,IAAIC,EAAYD,EAAEE,IAAI,YAClBC,EAAMlB,gBAAgBR,QAAQ2B,QAAQH,GACtCI,EAASF,EAAIjE,IAuVrB,SAA0B+D,GACtB,OAAOhB,gBAAgBR,QAAQ2B,QAAQH,GAAWK,WAAWC,eAvVzDC,CAAiBP,IAGjBE,EAAIG,WAAWC,eAAiB,0BAChCtB,gBAAgBR,QAAQgC,QAAQC,KAAKT,GAyT7C,SAA2BA,EAAWU,GAElC,IAAIC,EAAW/E,MAAMgF,IAAIC,QAoBzB,OAlBAlG,EAAEsF,IAAI,CACFnC,IAAKjD,cAAckD,SACnBC,KAAM,CACFC,OAAQ,mBACRC,WAAYrD,cAAcsD,MAC1BuC,QAASA,KAGhBtC,KAAK,SAASJ,GACXiB,QAAQC,IAAI,sBACZ,IAAI4B,EAlEZ,SAA6BC,GAEzB,IAAKA,EAAa,MAAO,UAEzB,IAAInC,EAASjE,EAAE2B,UAAUyE,GAErBD,EACA,mHAG+ClC,EAAOoC,WAAa,kDACTpC,EAAOqC,YAAc,KAC/DrC,EAAOsC,YACX,eAEJtC,EAAOuC,MACX,2IAKiCvC,EAAOwC,SAAW,mEAGhCxC,EAAOyC,UAAY,2MAKOzC,EAAO0C,OAAS,gIAIhB1C,EAAO2C,MAAQ,6BAKhE3C,EAAO4C,UACPV,GAAe,wCACGlC,EAAO4C,UAAY,4DACnB5C,EAAO6C,KAAO,0DAGhCX,GAAe,8DACGlC,EAAO6C,KAAO,0DAIpC,OAAOX,EAiBeY,CAAoB1D,GACtC2C,EAASgB,QAAQb,KAEpBc,KAAK,WACF3C,QAAQK,MAAM,qBACdqB,EAASgB,QAAQ,aAGdhB,EAASkB,UA7UZC,CAAkB9B,EAAWI,GAAQ2B,KAAK,SAAU/D,GAChDkC,EAAIG,WAAWC,eAAiBtC,EAChCgB,gBAAgBR,QAAQgC,QAAQwB,QAAQ9B,MAP5ClB,gBAAgBR,QAAQgC,QAAQC,KAAKT,KA8G7C,IAAIrC,EAAS9C,cAAc8C,OACvBA,IACAqB,gBAAgBiD,YAChBvE,EAAaC,IAIjBhD,EAAE,kBAAkBuH,WAAW,YAG/BvH,EAAE,kBAAkBwH,GAAG,QAAS,WAC5B,IAAIxE,EAAS,GAETyE,EAAOzH,EAAE0H,MAAMC,QAAQ,mBAAmBC,iBAC9C5H,EAAEyH,GAAMtG,KAAK,SAASC,EAAO0C,GACzBd,EAAOc,EAAI+D,MAAQ/D,EAAIzC,QAG3BgD,gBAAgBiD,YAChBvE,EAAaC,GACb4B,IAEA,IAAIkD,EAAU9H,EAAE,iCAAmCgD,EAAOC,IAAM,MAC3C,EAAjB6E,EAAQlE,SACR5D,EAAE,qBAAqB+H,KAAKD,EAAQC,QACpC/H,EAAE,qBAAqBqD,KAAK,QAASyE,EAAQzE,KAAK,WAGlDL,EAAOgF,WACPC,EAAaC,WAAW7F,IAAI,CAACW,EAAOgF,UAAW,OAE/ChF,EAAOmF,SACPF,EAAaC,WAAW7F,IAAI,CAAC,KAAMW,EAAOmF,YAKlDnI,EAAE,gBAAgBwH,GAAG,QAAS,WAC1BnD,gBAAgBiD,YAChB1C,IACA7B,IACAqF,MAIJpI,EAAE,iBAAiBwH,GAAG,QAAS,WAC3BnD,gBAAgBiD,YAChB1C,MAIJ5E,EAAE,qBAAqBwH,GAAG,QAAS,WAE/B,IACIa,EADOrI,EAAE0H,MAAMC,QAAQ,iBACRW,KAAK,qBACpBC,EAAgBF,EAAQN,OACxBS,EAAgBH,EAAQhF,KAAK,SAC7BoF,EAAUzI,EAAE0H,MACZgB,EAAgBD,EAAOV,OACvBY,EAAgBF,EAAOpF,KAAK,SAEhCgF,EAAQN,KAAKW,GACbL,EAAQhF,KAAK,QAASsF,GACtBF,EAAOV,KAAKQ,GACZE,EAAOpF,KAAK,QAASmF,GAGrBnE,gBAAgBiD,YAIhBvE,EAHa,CACTE,IAAK0F,IAGTP,EAAYO,KAIhB,IAAIV,EAAeW,SAASC,eAAe,gBACvCC,EAAY9I,EAAEiI,GAAc5E,KAAK,OACjC0F,EAAY/I,EAAEiI,GAAc5E,KAAK,OAsCrC,SAAS+E,EAAYnF,GACPA,EAALA,GAAW,GAChBjD,EAAEsF,IAAI,CACFnC,IAAKjD,cAAckD,SACnBC,KAAM,CACFC,OAAQ,kBACRC,WAAYrD,cAAcsD,MAC1BH,KAAM,CACFJ,IAAKA,MAIhBQ,KAAK,SAASC,GACX,IAAIkD,EAAQ5G,EAAE2B,UAAU+B,GACxBuE,EAAaC,WAAW7F,IAAI,CAACuE,EAAMoC,IAAKpC,EAAMqC,MAC9CjJ,EAAE,wBAAwB+H,KAAKnB,EAAMoC,KACrChJ,EAAE,wBAAwB+H,KAAKnB,EAAMqC,KACrCC,iBAAiBlJ,EAAE,yBACnBkJ,iBAAiBlJ,EAAE,2BAtD3BkI,WAAWiB,OAAOlB,EAAc,CAC5BmB,MAAO,CAACN,EAAWC,GACnBM,SAAS,EACTC,MAAO,CACHN,IAAOF,EACPG,IAAOF,GAEXQ,OAAQC,MAAM,CACVC,SAAU,MAIlBxB,EAAaC,WAAWV,GAAG,QAAS,WAChC,IAAIkC,EAASzB,EAAaC,WAAW5C,MAErCtF,EAAE,wBAAwB+H,KAAK2B,EAAO,IACtC1J,EAAE,wBAAwB+H,KAAK2B,EAAO,IAEtCR,iBAAiBlJ,EAAE,yBACnBkJ,iBAAiBlJ,EAAE,2BAIvBiI,EAAaC,WAAWV,GAAG,SAAU,WACjC,IAAIkC,EAASzB,EAAaC,WAAW5C,MACjCrC,EAAOjD,EAAE,qBAAqBqD,KAAK,SACvCgB,gBAAgBiD,YAMhBvE,EALa,CACTE,IAAKA,EACL+E,UAAW0B,EAAO,GAClBvB,QAASuB,EAAO,OA6BxB1J,EAAE,qBAAqBwH,GAAG,SAAU,WAChC,IAAIvE,EAAMjD,EAAE,qBAAqBqD,KAAK,SAElCL,EAAS,CACTC,IAFMA,EAALA,GAAW,MAGZ0G,QAAS,IAET3J,EAAE0H,MAAMkC,KAAK,aACb5G,EAAO2G,QAAU,UAErBtF,gBAAgBiD,YAChBvE,EAAaC,WAzZrC,CAifG6G","file":"yandex-map.min.js","sourcesContent":["(function ($) {\n\n    /**\n     * Plugin url\n     */\n    var plugin_url = yandex_locale.plugin_url;\n\n    /**\n     * Include common vars\n     */\n    // Common vars\n    \n    var mark_style_house_green = {\n        iconLayout: 'default#image',\n        iconImageHref: plugin_url + 'svg/mark-house-green.svg',\n        iconImageSize: [36, 36],\n        iconImageOffset: [-18, -36]\n    };\n    \n    var mark_style_house_orange = {\n        iconLayout: 'default#image',\n        iconImageHref: plugin_url + 'svg/mark-house-orange.svg',\n        iconImageSize: [36, 36],\n        iconImageOffset: [-18, -36]\n    };\n    \n    var mark_style_house_yellow = {\n        iconLayout: 'default#image',\n        iconImageHref: plugin_url + 'svg/mark-house-yellow.svg',\n        iconImageSize: [36, 36],\n        iconImageOffset: [-18, -36]\n    };\n    \n    var mark_style_house_red = {\n        iconLayout: 'default#image',\n        iconImageHref: plugin_url + 'svg/mark-house-red.svg',\n        iconImageSize: [36, 36],\n        iconImageOffset: [-18, -36]\n    };\n    \n    var mark_style_house_gray = {\n        iconLayout: 'default#image',\n        iconImageHref: plugin_url + 'svg/mark-house-gray.svg',\n        iconImageSize: [36, 36],\n        iconImageOffset: [-18, -36]\n    };\n    \n    var polygon_style_green = {\n        fillColor: '#44A147',\n        strokeColor: '#18803F',\n        strokeWidth: 2,\n        opacity: 0.7\n    };\n    \n    var polygon_style_orange = {\n        // fillColor: 'rgba(0,0,0,0.00)',\n        fillColor: '#E3D5B1',\n        strokeColor: '#EC6B23',\n        strokeWidth: 2,\n        opacity: 0.7\n    };\n    \n    var polygon_style_yellow = {\n        fillColor: '#FFEE8B',\n        strokeColor: '#FFDE17',\n        strokeWidth: 2,\n        opacity: 0.7\n    };\n    \n    var polygon_style_red = {\n        fillColor: '#F7A09A',\n        strokeColor: '#ED1C25',\n        strokeWidth: 2,\n        opacity: 0.7\n    };\n    \n    var polygon_style_gray = {\n        fillColor: '#A3ACB2',\n        strokeColor: '#88959E',\n        strokeWidth: 2,\n        opacity: 0.7\n    };\n\n    ymaps.ready(function () {\n\n        var $maps = $('.yandex-map');\n\n        $maps.each(function (index, value) {\n            var $mapElement = $(value),\n                id = $mapElement.attr('id');\n\n            if (id !== undefined && window[id] !== undefined) {\n\n                var $params = $.parseJSON(window[id]['params']);\n\n                var $map = new ymaps.Map(id, {\n                    zoom: $params.zoom,\n                    center: [$params.center_lat, $params.center_lng],\n                    // type: 'yandex#' + $params.type,\n                    // behaviors: ['dblClickZoom', 'multiTouch', 'drag']\n                }, {\n                    // minZoom: 10\n                });\n\n                $map.controls.remove('trafficControl');\n                $map.controls.remove('searchControl');\n                $map.controls.remove('geolocationControl');\n                $map.options.set('balloonMaxWidth', 290);\n\n                // Object map\n                if ($params.marks != undefined) {\n                    $($params.marks).each(function (index, mark) {\n                        var place_mark = null;\n                        if (mark.type == 'Point') { // create placemark\n                            place_mark = new ymaps.Placemark(\n                                mark.coords,\n                                {},\n                                mark_style_house_green\n                            );\n                        } else if (mark.type == 'Polygon') { // if mark is polygon\n                            place_mark = new ymaps.Polygon(\n                                mark.coords, \n                                {}, \n                                polygon_style_green \n                            );\n                        }\n                        $map.geoObjects.add(place_mark);\n                    });\n                };\n\n                // Main map\n                if (id === 'ymap_full' || id === 'ymap_project' ) {\n\n                    // object manager instance\n                    $object_manager = new ymaps.ObjectManager({\n                        // doesn't works with polygon\n                        // clusterize: true,\n                        // gridSize: 32,\n\n                        // disable default baloon\n                        geoObjectOpenBalloonOnClick: false,\n                    });\n\n                    // object manager event\n                    $object_manager.objects.events.add('click', function (e) {\n                        var object_id = e.get('objectId'),\n                            obj = $object_manager.objects.getById(object_id),\n                            postId = obj.id;\n                        if (has_balloon_data(object_id)) {\n                            $object_manager.objects.balloon.open(object_id);\n                        } else {\n                            obj.properties.balloonContent = \"Идет загрузка данных...\";\n                            $object_manager.objects.balloon.open(object_id);\n\n                            load_balloon_data(object_id, postId).then(function (data) {\n                                obj.properties.balloonContent = data;\n                                $object_manager.objects.balloon.setData(obj);\n                            });\n\n                        }\n                    });\n                    \n                    // load objects method\n                    function load_objects(filter) {\n                        if ( !filter ) filter = {\n                            cat: 'all' // load all objects\n                        };\n                        $.post({\n                            url: yandex_locale.ajax_url,\n                            data: {\n                                action: 'ymaps_json_post',\n                                nonce_code: yandex_locale.nonce,\n                                data: filter\n                            }\n                        })\n                        .done(function(response) {\n                            var data = $.parseJSON(response);\n                            if ( data.features.length > 0 ) {\n                                var objects = [];\n                                $.each(data.features, function(index, val) {\n                                    var status = (val.status) ? val.status.slug : false;\n                                    var object = {};\n                                    if (val.geometry.type === 'Point') {\n                                        var object = {\n                                            type: 'Feature',\n                                            id: val.id,\n                                            geometry: {\n                                                type: 'Point',\n                                                coordinates: val.geometry.coordinates\n                                            }\n                                        }\n                                        switch(status) {\n                                            case 'vacant':\n                                                object.options = mark_style_house_green;\n                                                break;\n                                            case 'reserved':\n                                                object.options = mark_style_house_yellow;\n                                                break;\n                                            case 'booked':\n                                                object.options = mark_style_house_red;\n                                                break;\n                                            default :\n                                                object.options = mark_style_house_green;\n                                                break;\n                                        }\n                                    } else if (val.geometry.type === 'Polygon') {\n                                        var object = {\n                                            type: 'Feature',\n                                            id: val.id,\n                                            geometry: {\n                                                type: 'Polygon',\n                                                coordinates: val.geometry.coordinates\n                                            }\n                                        }\n                                        switch(status) {\n                                            case 'vacant':\n                                                object.options = polygon_style_green;\n                                                break;\n                                            case 'reserved':\n                                                object.options = polygon_style_yellow;\n                                                break;\n                                            case 'booked':\n                                                object.options = polygon_style_red;\n                                                break;\n                                            default :\n                                                object.options = polygon_style_green;\n                                                break;\n                                        }\n                                    }\n                                    objects.push(object);\n                                });\n\n                                $object_manager.add(objects);\n                                $map.geoObjects.add($object_manager);\n                                console.log('Map data loaded');\n                                $map.setBounds($map.geoObjects.getBounds(), {\n                                    checkZoomRange: true\n                                });\n                            } else {\n                                console.error(\"Map data error\");\n                            };\n                        });\n                    }\n\n                    // toggle map method\n                    function toggle_map() {\n                        $('.js-wrapper').toggleClass('wrapper-map_show');\n                        $('.js-supheader').toggleClass('supheader-hidden');\n                        $('.js-header').toggleClass('header-map_show');\n                        $('.js-content').toggleClass('content-hidden');\n                        $('.js-footer').toggleClass('footer-hidden');\n\n                        $('.js-big-map').toggle();\n                        $('.yandex-map').toggle();\n\n                        $map.container.fitToViewport();\n                    };\n\n                    // project objects action\n                    var filter = yandex_locale.filter;\n                    if (filter) {\n                        $object_manager.removeAll()\n                        load_objects(filter);\n                    };\n\n                    // filter active\n                    $('.js-filter-map').removeAttr('disabled');\n\n                    // filter objects action\n                    $('.js-filter-map').on('click', function() {\n                        var filter = {};\n                        // get form params\n                        var form = $(this).parents('.js-filter-form').serializeArray();\n                        $(form).each(function(index, val){\n                            filter[val.name] = val.value;\n                        });\n                        // apply\n                        $object_manager.removeAll();\n                        load_objects(filter);\n                        toggle_map();\n                        // cat data filter fill\n                        var cur_cat = $('.js-onmap-cat-var[data-value=\"' + filter.cat + '\"]');\n                        if (cur_cat.length > 0) {\n                            $('.js-onmap-cat-cur').text(cur_cat.text());\n                            $('.js-onmap-cat-cur').data('value', cur_cat.data('value'));\n                        }\n                        // price data filter fill\n                        if (filter.pricefrom) {\n                            price_slider.noUiSlider.set([filter.pricefrom, null]);\n                        }\n                        if (filter.priceup) {\n                            price_slider.noUiSlider.set([null, filter.priceup]);\n                        }\n                    });\n\n                    // default objects action\n                    $('.js-map-open').on('click', function() {\n                        $object_manager.removeAll();\n                        toggle_map();\n                        load_objects();\n                        load_prices();\n                    });\n\n                    // default close action\n                    $('.js-map-close').on('click', function() {\n                        $object_manager.removeAll();\n                        toggle_map();\n                    });\n\n                    // on map filter\n                    $('.js-onmap-cat-var').on('click', function() {\n                        // labels\n                        var wrap = $(this).parents('.js-onmap-cat');\n                        var current = wrap.find('.js-onmap-cat-cur');\n                        var current_label = current.text();\n                        var current_value = current.data('value');\n                        var select =  $(this);\n                        var select_label =  select.text();\n                        var select_value =  select.data('value');\n\n                        current.text(select_label);\n                        current.data('value', select_value);\n                        select.text(current_label);\n                        select.data('value', current_value);\n\n                        // data\n                        $object_manager.removeAll();\n                        var filter = {\n                            cat: select_value\n                        };\n                        load_objects(filter);\n                        load_prices(select_value);\n                    });\n\n                    // price range slider\n                    var price_slider = document.getElementById('price_slider');\n                    var price_min = $(price_slider).data('min');\n                    var price_max = $(price_slider).data('max');\n\n                    noUiSlider.create(price_slider, {\n                        start: [price_min, price_max],\n                        connect: true,\n                        range: {\n                            'min': price_min,\n                            'max': price_max\n                        },\n                        format: wNumb({\n                            decimals: 0\n                        })\n                    });\n\n                    price_slider.noUiSlider.on('slide', function () {\n                        var values = price_slider.noUiSlider.get();\n\n                        $('#price_slider_data_1').text(values[0]);\n                        $('#price_slider_data_2').text(values[1]);\n\n                        moneyMaskRefresh($('#price_slider_data_1'));\n                        moneyMaskRefresh($('#price_slider_data_2'));\n                    });\n\n                    // apply price filter\n                    price_slider.noUiSlider.on('change', function () {\n                        var values = price_slider.noUiSlider.get();\n                        var cat =  $('.js-onmap-cat-cur').data('value');\n                        $object_manager.removeAll();\n                        var filter = {\n                            cat: cat,\n                            pricefrom: values[0],\n                            priceup: values[1]\n                        };\n                        load_objects(filter);\n                    });\n                    \n                    // load prices method\n                    function load_prices(cat) {\n                        if (!cat) cat = '';\n                        $.get({\n                            url: yandex_locale.ajax_url,\n                            data: {\n                                action: 'ymap_get_prices',\n                                nonce_code: yandex_locale.nonce,\n                                data: {\n                                    cat: cat\n                                }\n                            }\n                        })\n                        .done(function(response) {\n                            var price = $.parseJSON(response);\n                            price_slider.noUiSlider.set([price.min, price.max]);\n                            $('#price_slider_data_1').text(price.min);\n                            $('#price_slider_data_2').text(price.max);\n                            moneyMaskRefresh($('#price_slider_data_1'));\n                            moneyMaskRefresh($('#price_slider_data_2'));\n                        });\n                    };\n\n                    // special offers check\n                    $('.js-onmap-special').on('change', function() {\n                        var cat = $('.js-onmap-cat-cur').data('value');\n                        if (!cat) cat = 'all';\n                        var filter = {\n                            cat: cat,\n                            special: ''\n                        };\n                        if ($(this).prop(\"checked\")) {\n                            filter.special = 'EXISTS';\n                        };\n                        $object_manager.removeAll();\n                        load_objects(filter);\n                    });\n\n                    // ballon methods\n                    function compile_baloon_data(object_json) {\n\n                        if (!object_json) return 'Ошибка!';\n\n                        var object = $.parseJSON(object_json);\n\n                        var baloon_data = \n                            '<div class=\"module--header\">' +\n                                '<div class=\"module--title\">' +\n                                    '<div class=\"module--offer\">' + \n                                        '<div class=\"module--suptitle\">' + object.offer_type + '</div>' +\n                                        '<div class=\"module--status status status-' + object.status_slug + '\">' + \n                                            object.status_name + \n                                        '</div>' +\n                                    '</div>' + \n                                    object.title +\n                                '</div>' +\n                            '</div>' +\n                            '<div class=\"module--body\">' +\n                                '<div class=\"module--item icb\">' +\n                                    '<i class=\"icb--icon icon icon-location\"></i>' +\n                                    '<div class=\"icb--title\">' + object.location + '</div>' +\n                                '</div>' +\n                                '<div class=\"module--item module--item-50\">' +\n                                    '<img src=\"' + object.thumb_url + '\" alt=\"Фото участка\" class=\"module--pic\">' +\n                                '</div>' +\n                                '<div class=\"module--item module--item-50\">' +\n                                    '<div class=\"common_item\">' +\n                                        '<div class=\"common_item--title\"><em>Площадь</em></div>' +\n                                        '<div class=\"common_item--value\">' + object.square + '</div>' +\n                                    '</div>' +\n                                    '<div class=\"common_item\">' +\n                                        '<div class=\"common_item--title\"><em>Стоимость</em></div>' +\n                                        '<div class=\"common_item--value\">' + object.price + ' ₽</div>' +\n                                    '</div>' +\n                                '</div>' +\n                            '</div>';\n\n                        if (object.edit_link) {\n                            baloon_data += '<div class=\"module--footer\">' +\n                                '<a href=\"' + object.edit_link + '\" class=\"module--more\">Редактировать участок</a>' + \n                                '<a href=\"' + object.link + '\" class=\"module--but but but-green\">Подробнее</a>' +\n                            '</div>'\n                        } else {\n                            baloon_data += '<div class=\"module--footer module--footer-center\">' +\n                                '<a href=\"' + object.link + '\" class=\"module--but but but-green\">Подробнее</a>' +\n                            '</div>';\n                        }\n                        \n                        return baloon_data;\n                    }\n\n                    function load_balloon_data(object_id, post_id) {\n\n                        var deferred = ymaps.vow.defer();\n\n                        $.get({\n                            url: yandex_locale.ajax_url,\n                            data: {\n                                action: 'ymap_object_load',\n                                nonce_code: yandex_locale.nonce,\n                                post_id: post_id,\n                            }\n                        })\n                        .done(function(data) {\n                            console.log(\"Object data loaded\");\n                            var baloon_data = compile_baloon_data(data);\n                            deferred.resolve(baloon_data);\n                        })\n                        .fail(function() {\n                            console.error('Object data error');\n                            deferred.resolve('Ошибка!');\n                        });\n                            \n                        return deferred.promise();\n                    }\n\n                    function has_balloon_data(object_id) {\n                        return $object_manager.objects.getById(object_id).properties.balloonContent;\n                    }\n                }\n            }\n        });\n    });\n})(jQuery);"]}