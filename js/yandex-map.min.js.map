{"version":3,"sources":["yandex-map.js"],"names":["$","plugin_url","yandex_locale","mark_style_house_green","iconLayout","iconImageHref","iconImageSize","iconImageOffset","mark_style_house_orange","mark_style_house_yellow","mark_style_house_red","polygon_style_green","fillColor","strokeColor","strokeWidth","opacity","polygon_style_orange","polygon_style_yellow","polygon_style_red","ymaps","ready","each","index","value","id","attr","undefined","window","$params","parseJSON","$map","Map","zoom","center","center_lat","center_lng","controls","remove","options","set","width","hide","on","label","this","data","text","toggle","marks","mark","place_mark","type","Placemark","coords","Polygon","geoObjects","add","load_objects","filter","delay","fadeIn","show","cat","post","url","ajax_url","action","nonce_code","nonce","done","response","features","length","objects","val","status","slug","object","geometry","coordinates","special","push","$object_manager","console","log","setBounds","getBounds","checkZoomRange","fadeOut","error","toggle_map","toggleClass","container","fitToViewport","ObjectManager","geoObjectOpenBalloonOnClick","events","e","object_id","get","obj","getById","postId","properties","balloonContent","has_balloon_data","balloon","open","post_id","deferred","vow","defer","baloon_data","object_json","offer_type","status_slug","status_name","title","location","thumb_url","square","price","edit_link","link","compile_baloon_data","resolve","fail","promise","load_balloon_data","then","setData","removeAll","removeAttr","form","parents","serializeArray","name","cur_cat","pricefrom","price_slider","noUiSlider","priceup","min","max","moneyMaskRefresh","load_prices","current","find","current_label","current_value","select","select_label","select_value","prop","document","getElementById","price_min","price_max","create","start","connect","range","format","wNumb","decimals","values","jQuery"],"mappings":"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","file":"yandex-map.min.js","sourcesContent":["(function ($) {\n\n    /**\n     * Plugin url\n     */\n    var plugin_url = yandex_locale.plugin_url;\n\n    /**\n     * Include common vars\n     */\n    // Common vars\n    \n    var mark_style_house_green = {\n        iconLayout: 'default#image',\n        iconImageHref: plugin_url + 'svg/mark-house-green.svg',\n        iconImageSize: [36, 36],\n        iconImageOffset: [-18, -36]\n    };\n    \n    var mark_style_house_orange = {\n        iconLayout: 'default#image',\n        iconImageHref: plugin_url + 'svg/mark-house-orange.svg',\n        iconImageSize: [36, 36],\n        iconImageOffset: [-18, -36]\n    };\n    \n    var mark_style_house_yellow = {\n        iconLayout: 'default#image',\n        iconImageHref: plugin_url + 'svg/mark-house-yellow.svg',\n        iconImageSize: [36, 36],\n        iconImageOffset: [-18, -36]\n    };\n    \n    var mark_style_house_red = {\n        iconLayout: 'default#image',\n        iconImageHref: plugin_url + 'svg/mark-house-red.svg',\n        iconImageSize: [36, 36],\n        iconImageOffset: [-18, -36]\n    };\n    \n    var mark_style_house_gray = {\n        iconLayout: 'default#image',\n        iconImageHref: plugin_url + 'svg/mark-house-gray.svg',\n        iconImageSize: [36, 36],\n        iconImageOffset: [-18, -36]\n    };\n    \n    var polygon_style_green = {\n        fillColor: '#44A147',\n        strokeColor: '#18803F',\n        strokeWidth: 2,\n        opacity: 0.7\n    };\n    \n    var polygon_style_orange = {\n        // fillColor: 'rgba(0,0,0,0.00)',\n        fillColor: '#E3D5B1',\n        strokeColor: '#EC6B23',\n        strokeWidth: 2,\n        opacity: 0.7\n    };\n    \n    var polygon_style_yellow = {\n        fillColor: '#FFEE8B',\n        strokeColor: '#FFDE17',\n        strokeWidth: 2,\n        opacity: 0.7\n    };\n    \n    var polygon_style_red = {\n        fillColor: '#F7A09A',\n        strokeColor: '#ED1C25',\n        strokeWidth: 2,\n        opacity: 0.7\n    };\n    \n    var polygon_style_gray = {\n        fillColor: '#A3ACB2',\n        strokeColor: '#88959E',\n        strokeWidth: 2,\n        opacity: 0.7\n    };\n\n    ymaps.ready(function () {\n\n        var $maps = $('.yandex-map');\n\n        $maps.each(function (index, value) {\n            var $mapElement = $(value),\n                id = $mapElement.attr('id');\n\n            if (id !== undefined && window[id] !== undefined) {\n\n                var $params = $.parseJSON(window[id]['params']);\n\n                var $map = new ymaps.Map(id, {\n                    zoom: $params.zoom,\n                    center: [$params.center_lat, $params.center_lng],\n                    // type: 'yandex#' + $params.type,\n                    // behaviors: ['dblClickZoom', 'multiTouch', 'drag']\n                }, {\n                    // minZoom: 10\n                });\n\n                $map.controls.remove('trafficControl');\n                $map.controls.remove('searchControl');\n                $map.controls.remove('geolocationControl');\n                $map.controls.remove('fullscreenControl');\n                $map.controls.remove('rulerControl');\n                $map.options.set('balloonMaxWidth', 290);\n\n                // Adaptive misc\n                if ($(window).width() < 768) {\n                    $map.controls.remove('typeSelector');\n                    $('.js-onmap-collapse-element').hide();\n                    $('.js-onmap-collapse-trigger').on('click', function() {\n                        var label = $(this).data('label');\n                        $(this).data('label', $(this).text()).text(label);\n                        $('.js-onmap-collapse-element').toggle();\n                    });\n                } else {\n                    $('.js-onmap-collapse-trigger').hide();\n                }\n\n\n                // Object map\n                if ($params.marks != undefined) {\n                    $($params.marks).each(function (index, mark) {\n                        var place_mark = null;\n                        if (mark.type == 'Point') { // create placemark\n                            place_mark = new ymaps.Placemark(\n                                mark.coords,\n                                {},\n                                mark_style_house_green\n                            );\n                        } else if (mark.type == 'Polygon') { // if mark is polygon\n                            place_mark = new ymaps.Polygon(\n                                mark.coords, \n                                {}, \n                                polygon_style_green \n                            );\n                        }\n                        $map.geoObjects.add(place_mark);\n                    });\n                };\n\n                // Main map\n                if (id === 'ymap_full' || id === 'ymap_project' ) {\n\n                    // object manager instance\n                    $object_manager = new ymaps.ObjectManager({\n                        // doesn't works with polygon\n                        // clusterize: true,\n                        // gridSize: 32,\n\n                        // disable default baloon\n                        geoObjectOpenBalloonOnClick: false,\n                    });\n\n                    // object manager event\n                    $object_manager.objects.events.add('click', function (e) {\n                        var object_id = e.get('objectId'),\n                            obj = $object_manager.objects.getById(object_id),\n                            postId = obj.id;\n                        if (has_balloon_data(object_id)) {\n                            $object_manager.objects.balloon.open(object_id);\n                        } else {\n                            obj.properties.balloonContent = \"Идет загрузка данных...\";\n                            $object_manager.objects.balloon.open(object_id);\n\n                            load_balloon_data(object_id, postId).then(function (data) {\n                                obj.properties.balloonContent = data;\n                                $object_manager.objects.balloon.setData(obj);\n                            });\n\n                        }\n                    });\n                    \n                    // load objects method\n                    function load_objects(filter) {\n                        // loader\n                        $(\".js-loader\").delay(500).fadeIn('fast');\n                        $(\".js-loader-inner\").fadeIn();\n                        $(\".js-loader-icon\").show();\n                        $(\".js-loader-error\").hide();\n                        // data\n                        if ( !filter ) filter = {\n                            cat: 'all' // load all objects\n                        };\n                        $.post({\n                            url: yandex_locale.ajax_url,\n                            data: {\n                                action: 'ymaps_json_post',\n                                nonce_code: yandex_locale.nonce,\n                                data: filter\n                            }\n                        })\n                        .done(function(response) {\n                            var data = $.parseJSON(response);\n                            if ( data.features.length > 0 ) {\n                                var objects = [];\n                                $.each(data.features, function(index, val) {\n                                    var status = (val.status) ? val.status.slug : false;\n                                    var object = {};\n                                    if (val.geometry.type === 'Point') {\n                                        var object = {\n                                            type: 'Feature',\n                                            id: val.id,\n                                            geometry: {\n                                                type: 'Point',\n                                                coordinates: val.geometry.coordinates\n                                            }\n                                        }\n                                        switch(status) {\n                                            case 'vacant':\n                                                object.options = (val.special) \n                                                    ? mark_style_house_orange\n                                                    : mark_style_house_green;\n                                                break;\n                                            case 'reserved':\n                                                object.options = mark_style_house_yellow;\n                                                break;\n                                            case 'booked':\n                                                object.options = mark_style_house_red;\n                                                break;\n                                            default :\n                                                object.options = (val.special) \n                                                    ? mark_style_house_orange\n                                                    : mark_style_house_green;\n                                                break;\n                                        }\n                                    } else if (val.geometry.type === 'Polygon') {\n                                        var object = {\n                                            type: 'Feature',\n                                            id: val.id,\n                                            geometry: {\n                                                type: 'Polygon',\n                                                coordinates: val.geometry.coordinates\n                                            }\n                                        }\n                                        if (val.special) object.options = polygon_style_orange;\n                                        switch(status) {\n                                            case 'vacant':\n                                                object.options = polygon_style_green;\n                                                break;\n                                            case 'reserved':\n                                                object.options = polygon_style_yellow;\n                                                break;\n                                            case 'booked':\n                                                object.options = polygon_style_red;\n                                                break;\n                                            default :\n                                                object.options = (val.special) \n                                                    ? polygon_style_orange\n                                                    : polygon_style_green;\n                                                break;\n                                        }\n                                    }\n                                    objects.push(object);\n                                });\n\n                                $object_manager.add(objects);\n                                $map.geoObjects.add($object_manager);\n                                console.log('Map data loaded');\n                                $map.setBounds($map.geoObjects.getBounds(), {\n                                    checkZoomRange: true\n                                });\n                                // loader\n                                $(\".js-loader-inner\").fadeOut(); \n                                $(\".js-loader\").delay(500).fadeOut('fast');\n                            } else {\n                                // loader error\n                                $(\".js-loader-error\").show();\n                                $(\".js-loader-icon\").hide();\n                                console.error(\"Map data error\");\n                            };\n                        });\n                    }\n\n                    // toggle map method\n                    function toggle_map() {\n                        $('.js-wrapper').toggleClass('wrapper-map_show');\n                        $('.js-supheader').toggleClass('supheader-hidden');\n                        $('.js-header').toggleClass('header-map_show');\n                        $('.js-content').toggleClass('content-hidden');\n                        $('.js-footer').toggleClass('footer-hidden');\n\n                        $('.js-big-map').toggle();\n                        $('.yandex-map').toggle();\n\n                        $map.container.fitToViewport();\n                    };\n\n                    // project objects action\n                    var filter = yandex_locale.filter;\n                    if (filter) {\n                        $object_manager.removeAll()\n                        load_objects(filter);\n                    };\n\n                    // filter active\n                    $('.js-filter-map').removeAttr('disabled');\n\n                    // filter objects action\n                    $('.js-filter-map').on('click', function() {\n                        var filter = {};\n                        // get form params\n                        var form = $(this).parents('.js-filter-form').serializeArray();\n                        $(form).each(function(index, val){\n                            filter[val.name] = val.value;\n                        });\n                        // apply\n                        $object_manager.removeAll();\n                        load_objects(filter);\n                        toggle_map();\n                        // cat data filter fill\n                        var cur_cat = $('.js-onmap-cat-var[data-value=\"' + filter.cat + '\"]');\n                        if (cur_cat.length > 0) {\n                            $('.js-onmap-cat-cur').text(cur_cat.text());\n                            $('.js-onmap-cat-cur').data('value', cur_cat.data('value'));\n                        }\n                        // price data filter fill\n                        if (filter.pricefrom) {\n                            price_slider.noUiSlider.set([filter.pricefrom, null]);\n                        }\n                        if (filter.priceup) {\n                            price_slider.noUiSlider.set([null, filter.priceup]);\n                        }\n                    });\n\n                    // common link active\n                    $('.js-map-open').removeAttr('disabled');\n\n                    // common open action\n                    $('.js-map-open').on('click', function() {\n                        $object_manager.removeAll();\n                        toggle_map();\n                        load_objects();\n                        load_prices();\n                    });\n\n                    // common close action\n                    $('.js-map-close').on('click', function() {\n                        $object_manager.removeAll();\n                        toggle_map();\n                    });\n\n                    // on map filter\n                    $('.js-onmap-cat-var').on('click', function() {\n                        // labels\n                        var wrap = $(this).parents('.js-onmap-cat');\n                        var current = wrap.find('.js-onmap-cat-cur');\n                        var current_label = current.text();\n                        var current_value = current.data('value');\n                        var select =  $(this);\n                        var select_label =  select.text();\n                        var select_value =  select.data('value');\n\n                        var price = price_slider.noUiSlider.get();\n                        console.log(price);\n                        var special = $('.js-onmap-special');\n\n                        current.text(select_label);\n                        current.data('value', select_value);\n                        select.text(current_label);\n                        select.data('value', current_value);\n\n                        // data\n                        $object_manager.removeAll();\n                        var filter = {\n                            cat: select_value,\n                            pricefrom: price[0],\n                            priceup: price[1],\n                            special: (special.prop(\"checked\")) ? 'EXISTS' : ''\n                        };\n                        load_objects(filter);\n                        // load_prices(select_value);\n                    });\n\n                    // price range slider\n                    var price_slider = document.getElementById('price_slider');\n                    var price_min = $(price_slider).data('min');\n                    var price_max = $(price_slider).data('max');\n\n                    noUiSlider.create(price_slider, {\n                        start: [price_min, price_max],\n                        connect: true,\n                        range: {\n                            'min': price_min,\n                            'max': price_max\n                        },\n                        format: wNumb({\n                            decimals: 0\n                        })\n                    });\n\n                    price_slider.noUiSlider.on('slide', function () {\n                        var values = price_slider.noUiSlider.get();\n\n                        $('#price_slider_data_1').text(values[0]);\n                        $('#price_slider_data_2').text(values[1]);\n\n                        moneyMaskRefresh($('#price_slider_data_1'));\n                        moneyMaskRefresh($('#price_slider_data_2'));\n                    });\n\n                    // apply price filter\n                    price_slider.noUiSlider.on('change', function () {\n                        var cat =  $('.js-onmap-cat-cur').data('value');\n                        var price = price_slider.noUiSlider.get();\n                        var special = $('.js-onmap-special');\n                        $object_manager.removeAll();\n                        var filter = {\n                            cat: cat,\n                            pricefrom: price[0],\n                            priceup: price[1],\n                            special: (special.prop(\"checked\")) ? 'EXISTS' : ''\n                        };\n                        load_objects(filter);\n                    });\n                    \n                    // load prices method\n                    function load_prices(cat) {\n                        if (!cat) cat = '';\n                        $.get({\n                            url: yandex_locale.ajax_url,\n                            data: {\n                                action: 'ymap_get_prices',\n                                nonce_code: yandex_locale.nonce,\n                                data: {\n                                    cat: cat\n                                }\n                            }\n                        })\n                        .done(function(response) {\n                            var price = $.parseJSON(response);\n                            price_slider.noUiSlider.set([price.min, price.max]);\n                            $('#price_slider_data_1').text(price.min);\n                            $('#price_slider_data_2').text(price.max);\n                            moneyMaskRefresh($('#price_slider_data_1'));\n                            moneyMaskRefresh($('#price_slider_data_2'));\n                        });\n                    };\n\n                    // special offers check\n                    $('.js-onmap-special').on('change', function() {\n                        var cat = $('.js-onmap-cat-cur').data('value');\n                        var price = price_slider.noUiSlider.get();\n                        if (!cat) cat = 'all';\n                        var filter = {\n                            cat: cat,\n                            pricefrom: price[0],\n                            priceup: price[1],\n                            special: ($(this).prop(\"checked\")) ? 'EXISTS' : ''\n                        };\n                        if ($(this).prop(\"checked\")) {\n                            filter.special = 'EXISTS';\n                        };\n                        $object_manager.removeAll();\n                        load_objects(filter);\n                    });\n\n                    // ballon methods\n                    function compile_baloon_data(object_json) {\n\n                        if (!object_json) return 'Ошибка!';\n\n                        var object = $.parseJSON(object_json);\n\n                        var baloon_data = \n                            '<div class=\"module--header\">' +\n                                '<div class=\"module--title\">' +\n                                    '<div class=\"module--offer\">' + \n                                        '<div class=\"module--suptitle\">' + object.offer_type + '</div>' +\n                                        '<div class=\"module--status status status-' + object.status_slug + '\">' + \n                                            object.status_name + \n                                        '</div>' +\n                                    '</div>' + \n                                    object.title +\n                                '</div>' +\n                            '</div>' +\n                            '<div class=\"module--body\">' +\n                                '<div class=\"module--item icb\">' +\n                                    '<i class=\"icb--icon icon icon-location\"></i>' +\n                                    '<div class=\"icb--title\">' + object.location + '</div>' +\n                                '</div>' +\n                                '<div class=\"module--item module--item-50\">' +\n                                    '<img src=\"' + object.thumb_url + '\" alt=\"Фото участка\" class=\"module--pic\">' +\n                                '</div>' +\n                                '<div class=\"module--item module--item-50\">' +\n                                    '<div class=\"common_item\">' +\n                                        '<div class=\"common_item--title\"><em>Площадь</em></div>' +\n                                        '<div class=\"common_item--value\">' + object.square + '</div>' +\n                                    '</div>' +\n                                    '<div class=\"common_item\">' +\n                                        '<div class=\"common_item--title\"><em>Стоимость</em></div>' +\n                                        '<div class=\"common_item--value\">' + object.price + ' ₽</div>' +\n                                    '</div>' +\n                                '</div>' +\n                            '</div>';\n\n                        if (object.edit_link) {\n                            baloon_data += '<div class=\"module--footer\">' +\n                                '<a href=\"' + object.edit_link + '\" class=\"module--more\">Редактировать участок</a>' + \n                                '<a href=\"' + object.link + '\" class=\"module--but but but-green\">Подробнее</a>' +\n                            '</div>'\n                        } else {\n                            baloon_data += '<div class=\"module--footer module--footer-center\">' +\n                                '<a href=\"' + object.link + '\" class=\"module--but but but-green\">Подробнее</a>' +\n                            '</div>';\n                        }\n                        \n                        return baloon_data;\n                    }\n\n                    function load_balloon_data(object_id, post_id) {\n\n                        var deferred = ymaps.vow.defer();\n\n                        $.get({\n                            url: yandex_locale.ajax_url,\n                            data: {\n                                action: 'ymap_object_load',\n                                nonce_code: yandex_locale.nonce,\n                                post_id: post_id,\n                            }\n                        })\n                        .done(function(data) {\n                            console.log(\"Object data loaded\");\n                            var baloon_data = compile_baloon_data(data);\n                            deferred.resolve(baloon_data);\n                        })\n                        .fail(function() {\n                            console.error('Object data error');\n                            deferred.resolve('Ошибка!');\n                        });\n                            \n                        return deferred.promise();\n                    }\n\n                    function has_balloon_data(object_id) {\n                        return $object_manager.objects.getById(object_id).properties.balloonContent;\n                    }\n                }\n            }\n        });\n    });\n})(jQuery);"]}