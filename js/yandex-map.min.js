!function(u){var e=yandex_locale.plugin_url,p={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-green.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},v={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-yellow.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},g={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-red.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},f={fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2,opacity:.7},_={fillColor:"#FFEE8B",strokeColor:"#FFDE17",strokeWidth:2,opacity:.7},b={fillColor:"#F7A09A",strokeColor:"#ED1C25",strokeWidth:2,opacity:.7};ymaps.ready(function(){u(".yandex-map").each(function(e,a){var o=u(a).attr("id");if(void 0!==o&&void 0!==window[o]){var t=u.parseJSON(window[o].params),i=new ymaps.Map(o,{zoom:t.zoom,center:[t.center_lat,t.center_lng]},{});if(i.controls.remove("trafficControl"),i.controls.remove("searchControl"),i.controls.remove("geolocationControl"),i.options.set("balloonMaxWidth",290),null!=t.marks&&u(t.marks).each(function(e,a){var o=null;"Point"==a.type?o=new ymaps.Placemark(a.coords,{},p):"Polygon"==a.type&&(o=new ymaps.Polygon(a.coords,{},f)),i.geoObjects.add(o)}),"ymap_full"===o||"ymap_project"===o){function r(e){e=e||{cat:"all"},u.post({url:yandex_locale.ajax_url,data:{action:"ymaps_json_post",nonce_code:yandex_locale.nonce,data:e}}).done(function(e){var a=u.parseJSON(e);if(0<a.features.length){var n=[];u.each(a.features,function(e,a){var o=!!a.status&&a.status.slug,t={};if("Point"===a.geometry.type){t={type:"Feature",id:a.id,geometry:{type:"Point",coordinates:a.geometry.coordinates}};switch(o){case"vacant":t.options=p;break;case"reserved":t.options=v;break;case"booked":t.options=g;break;default:t.options=p}}else if("Polygon"===a.geometry.type){t={type:"Feature",id:a.id,geometry:{type:"Polygon",coordinates:a.geometry.coordinates}};switch(o){case"vacant":t.options=f;break;case"reserved":t.options=_;break;case"booked":t.options=b;break;default:t.options=f}}n.push(t)}),$object_manager.add(n),i.geoObjects.add($object_manager),console.log("Map data loaded"),i.setBounds(i.geoObjects.getBounds(),{checkZoomRange:!0})}else console.error("Map data error")})}function n(){u(".js-wrapper").toggleClass("wrapper-map_show"),u(".js-supheader").toggleClass("supheader-hidden"),u(".js-header").toggleClass("header-map_show"),u(".js-content").toggleClass("content-hidden"),u(".js-footer").toggleClass("footer-hidden"),u(".js-big-map").toggle(),u(".yandex-map").toggle(),i.container.fitToViewport()}$object_manager=new ymaps.ObjectManager({geoObjectOpenBalloonOnClick:!1}),$object_manager.objects.events.add("click",function(e){var a=e.get("objectId"),o=$object_manager.objects.getById(a),t=o.id;!function(e){return $object_manager.objects.getById(e).properties.balloonContent}(a)?(o.properties.balloonContent="Идет загрузка данных...",$object_manager.objects.balloon.open(a),function(e,a){var o=ymaps.vow.defer();return u.get({url:yandex_locale.ajax_url,data:{action:"ymap_object_load",nonce_code:yandex_locale.nonce,post_id:a}}).done(function(e){console.log("Object data loaded");var a=function(e){if(!e)return"Ошибка!";var a=u.parseJSON(e),o='<div class="module--header"><div class="module--title"><div class="module--offer"><div class="module--suptitle">'+a.offer_type+'</div><div class="module--status status status-'+a.status_slug+'">'+a.status_name+"</div></div>"+a.title+'</div></div><div class="module--body"><div class="module--item icb"><i class="icb--icon icon icon-location"></i><div class="icb--title">'+a.location+'</div></div><div class="module--item module--item-50"><img src="'+a.thumb_url+'" alt="Фото участка" class="module--pic"></div><div class="module--item module--item-50"><div class="common_item"><div class="common_item--title"><em>Площадь</em></div><div class="common_item--value">'+a.square+'</div></div><div class="common_item"><div class="common_item--title"><em>Стоимость</em></div><div class="common_item--value">'+a.price+" ₽</div></div></div></div>";a.edit_link?o+='<div class="module--footer"><a href="'+a.edit_link+'" class="module--more">Редактировать участок</a><a href="'+a.link+'" class="module--but but but-green">Подробнее</a></div>':o+='<div class="module--footer module--footer-center"><a href="'+a.link+'" class="module--but but but-green">Подробнее</a></div>';return o}(e);o.resolve(a)}).fail(function(){console.error("Object data error"),o.resolve("Ошибка!")}),o.promise()}(0,t).then(function(e){o.properties.balloonContent=e,$object_manager.objects.balloon.setData(o)})):$object_manager.objects.balloon.open(a)});var l=yandex_locale.filter;l&&($object_manager.removeAll(),r(l)),u(".js-filter-map").removeAttr("disabled"),u(".js-filter-map").on("click",function(){var o={},e=u(this).parents(".js-filter-form").serializeArray();u(e).each(function(e,a){o[a.name]=a.value}),$object_manager.removeAll(),r(o),n();var a=u('.js-onmap-cat-var[data-value="'+o.cat+'"]');0<a.length&&(u(".js-onmap-cat-cur").text(a.text()),u(".js-onmap-cat-cur").data("value",a.data("value"))),o.pricefrom&&c.noUiSlider.set([o.pricefrom,null]),o.priceup&&c.noUiSlider.set([null,o.priceup])}),u(".js-map-open").on("click",function(){$object_manager.removeAll(),n(),r(),m()}),u(".js-map-close").on("click",function(){$object_manager.removeAll(),n()}),u(".js-onmap-cat-var").on("click",function(){var e=u(this).parents(".js-onmap-cat").find(".js-onmap-cat-cur"),a=e.text(),o=e.data("value"),t=u(this),n=t.text(),i=t.data("value");e.text(n),e.data("value",i),t.text(a),t.data("value",o),$object_manager.removeAll(),r({cat:i}),m(i)});var c=document.getElementById("price_slider"),s=u(c).data("min"),d=u(c).data("max");function m(e){e=e||"",u.get({url:yandex_locale.ajax_url,data:{action:"ymap_get_prices",nonce_code:yandex_locale.nonce,data:{cat:e}}}).done(function(e){var a=u.parseJSON(e);c.noUiSlider.set([a.min,a.max]),u("#price_slider_data_1").text(a.min),u("#price_slider_data_2").text(a.max),moneyMaskRefresh(u("#price_slider_data_1")),moneyMaskRefresh(u("#price_slider_data_2"))})}noUiSlider.create(c,{start:[s,d],connect:!0,range:{min:s,max:d},format:wNumb({decimals:0})}),c.noUiSlider.on("slide",function(){var e=c.noUiSlider.get();u("#price_slider_data_1").text(e[0]),u("#price_slider_data_2").text(e[1]),moneyMaskRefresh(u("#price_slider_data_1")),moneyMaskRefresh(u("#price_slider_data_2"))}),c.noUiSlider.on("change",function(){var e=c.noUiSlider.get(),a=u(".js-onmap-cat-cur").data("value");$object_manager.removeAll(),r({cat:a,pricefrom:e[0],priceup:e[1]})}),u(".js-onmap-special").on("change",function(){var e=u(".js-onmap-cat-cur").data("value"),a={cat:e=e||"all",special:""};u(this).prop("checked")&&(a.special="EXISTS"),$object_manager.removeAll(),r(a)})}}})})}(jQuery);
//# sourceMappingURL=yandex-map.min.js.map