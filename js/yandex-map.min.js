!function(m){var e=yandex_locale.plugin_url,p={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-green.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},u={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-orange.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},g={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-yellow.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},v={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-red.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},f={fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2,opacity:.7},_={fillColor:"#E3D5B1",strokeColor:"#EC6B23",strokeWidth:2,opacity:.7},j={fillColor:"#FFEE8B",strokeColor:"#FFDE17",strokeWidth:2,opacity:.7},b={fillColor:"#F7A09A",strokeColor:"#ED1C25",strokeWidth:2,opacity:.7};ymaps.ready(function(){m(".yandex-map").each(function(e,o){var a=m(o).attr("id");if(void 0!==a&&void 0!==window[a]){var t=m.parseJSON(window[a].params),n=new ymaps.Map(a,{zoom:t.zoom,center:[t.center_lat,t.center_lng]},{});if(n.controls.remove("trafficControl"),n.controls.remove("searchControl"),n.controls.remove("geolocationControl"),n.controls.remove("fullscreenControl"),n.controls.remove("rulerControl"),n.options.set("balloonMaxWidth",290),m(window).width()<768?(n.controls.remove("typeSelector"),m(".js-onmap-collapse-element").hide(),m(".js-onmap-collapse-trigger").on("click",function(){var e=m(this).data("label");m(this).data("label",m(this).text()).text(e),m(".js-onmap-collapse-element").toggle()})):m(".js-onmap-collapse-trigger").hide(),null!=t.marks&&m(t.marks).each(function(e,o){var a=null;"Point"==o.type?a=new ymaps.Placemark(o.coords,{},p):"Polygon"==o.type&&(a=new ymaps.Polygon(o.coords,{},f)),n.geoObjects.add(a)}),"ymap_full"===a||"ymap_project"===a){function s(e){m(".js-loader").delay(500).fadeIn("fast"),m(".js-loader-inner").fadeIn(),m(".js-loader-icon").show(),m(".js-loader-error").hide(),e=e||{cat:"all"},m.post({url:yandex_locale.ajax_url,data:{action:"ymaps_json_post",nonce_code:yandex_locale.nonce,data:e}}).done(function(e){var o=m.parseJSON(e);if(0<o.features.length){var r=[];m.each(o.features,function(e,o){var a=!!o.status&&o.status.slug,t={};if("Point"===o.geometry.type){t={type:"Feature",id:o.id,geometry:{type:"Point",coordinates:o.geometry.coordinates}};switch(a){case"vacant":t.options=o.special?u:p;break;case"reserved":t.options=g;break;case"booked":t.options=v;break;default:t.options=o.special?u:p}}else if("Polygon"===o.geometry.type){t={type:"Feature",id:o.id,geometry:{type:"Polygon",coordinates:o.geometry.coordinates}};switch(o.special&&(t.options=_),a){case"vacant":t.options=f;break;case"reserved":t.options=j;break;case"booked":t.options=b;break;default:t.options=o.special?_:f}}r.push(t)}),$object_manager.add(r),n.geoObjects.add($object_manager),console.log("Map data loaded"),n.setBounds(n.geoObjects.getBounds(),{checkZoomRange:!0}),m(".js-loader-inner").fadeOut(),m(".js-loader").delay(500).fadeOut("fast")}else m(".js-loader-error").show(),m(".js-loader-icon").hide(),console.error("Map data error")})}function r(){m(".js-wrapper").toggleClass("wrapper-map_show"),m(".js-supheader").toggleClass("supheader-hidden"),m(".js-header").toggleClass("header-map_show"),m(".js-content").toggleClass("content-hidden"),m(".js-footer").toggleClass("footer-hidden"),m(".js-big-map").toggle(),m(".yandex-map").toggle(),n.container.fitToViewport()}$object_manager=new ymaps.ObjectManager({geoObjectOpenBalloonOnClick:!1}),$object_manager.objects.events.add("click",function(e){var o=e.get("objectId"),a=$object_manager.objects.getById(o),t=a.id;!function(e){return $object_manager.objects.getById(e).properties.balloonContent}(o)?(a.properties.balloonContent="Идет загрузка данных...",$object_manager.objects.balloon.open(o),function(e,o){var a=ymaps.vow.defer();return m.get({url:yandex_locale.ajax_url,data:{action:"ymap_object_load",nonce_code:yandex_locale.nonce,post_id:o}}).done(function(e){console.log("Object data loaded");var o=function(e){if(!e)return"Ошибка!";var o=m.parseJSON(e),a='<div class="module--header"><div class="module--title"><div class="module--offer"><div class="module--suptitle">'+o.offer_type+'</div><div class="module--status status status-'+o.status_slug+'">'+o.status_name+"</div></div>"+o.title+'</div></div><div class="module--body"><div class="module--item icb"><i class="icb--icon icon icon-location"></i><div class="icb--title">'+o.location+'</div></div><div class="module--item module--item-50"><img src="'+o.thumb_url+'" alt="Фото участка" class="module--pic"></div><div class="module--item module--item-50"><div class="common_item"><div class="common_item--title"><em>Площадь</em></div><div class="common_item--value">'+o.square+'</div></div><div class="common_item"><div class="common_item--title"><em>Стоимость</em></div><div class="common_item--value">'+o.price+" ₽</div></div></div></div>";o.edit_link?a+='<div class="module--footer"><a href="'+o.edit_link+'" class="module--more">Редактировать участок</a><a href="'+o.link+'" class="module--but but but-green">Подробнее</a></div>':a+='<div class="module--footer module--footer-center"><a href="'+o.link+'" class="module--but but but-green">Подробнее</a></div>';return a}(e);a.resolve(o)}).fail(function(){console.error("Object data error"),a.resolve("Ошибка!")}),a.promise()}(0,t).then(function(e){a.properties.balloonContent=e,$object_manager.objects.balloon.setData(a)})):$object_manager.objects.balloon.open(o)});var i=yandex_locale.filter;i&&($object_manager.removeAll(),s(i)),m(".js-filter-map").removeAttr("disabled"),m(".js-filter-map").on("click",function(){var a={},e=m(this).parents(".js-filter-form").serializeArray();m(e).each(function(e,o){a[o.name]=o.value}),$object_manager.removeAll(),s(a),r();var o=m('.js-onmap-cat-var[data-value="'+a.cat+'"]');0<o.length&&(m(".js-onmap-cat-cur").text(o.text()),m(".js-onmap-cat-cur").data("value",o.data("value"))),a.pricefrom&&c.noUiSlider.set([a.pricefrom,null]),a.priceup&&c.noUiSlider.set([null,a.priceup])}),m(".js-map-open").removeAttr("disabled"),m(".js-map-open").on("click",function(){$object_manager.removeAll(),r(),s(),function(e){e=e||"";m.get({url:yandex_locale.ajax_url,data:{action:"ymap_get_prices",nonce_code:yandex_locale.nonce,data:{cat:e}}}).done(function(e){var o=m.parseJSON(e);c.noUiSlider.set([o.min,o.max]),m("#price_slider_data_1").text(o.min),m("#price_slider_data_2").text(o.max),moneyMaskRefresh(m("#price_slider_data_1")),moneyMaskRefresh(m("#price_slider_data_2"))})}()}),m(".js-map-close").on("click",function(){$object_manager.removeAll(),r()}),m(".js-onmap-cat-var").on("click",function(){var e=m(this).parents(".js-onmap-cat").find(".js-onmap-cat-cur"),o=e.text(),a=e.data("value"),t=m(this),r=t.text(),n=t.data("value"),i=c.noUiSlider.get();console.log(i);var l=m(".js-onmap-special");e.text(r),e.data("value",n),t.text(o),t.data("value",a),$object_manager.removeAll(),s({cat:n,pricefrom:i[0],priceup:i[1],special:l.prop("checked")?"EXISTS":""})});var c=document.getElementById("price_slider"),l=m(c).data("min"),d=m(c).data("max");noUiSlider.create(c,{start:[l,d],connect:!0,range:{min:l,max:d},format:wNumb({decimals:0})}),c.noUiSlider.on("slide",function(){var e=c.noUiSlider.get();m("#price_slider_data_1").text(e[0]),m("#price_slider_data_2").text(e[1]),moneyMaskRefresh(m("#price_slider_data_1")),moneyMaskRefresh(m("#price_slider_data_2"))}),c.noUiSlider.on("change",function(){var e=m(".js-onmap-cat-cur").data("value"),o=c.noUiSlider.get(),a=m(".js-onmap-special");$object_manager.removeAll(),s({cat:e,pricefrom:o[0],priceup:o[1],special:a.prop("checked")?"EXISTS":""})}),m(".js-onmap-special").on("change",function(){var e=m(".js-onmap-cat-cur").data("value"),o=c.noUiSlider.get(),a={cat:e=e||"all",pricefrom:o[0],priceup:o[1],special:m(this).prop("checked")?"EXISTS":""};m(this).prop("checked")&&(a.special="EXISTS"),$object_manager.removeAll(),s(a)})}}})})}(jQuery);
//# sourceMappingURL=yandex-map.min.js.map