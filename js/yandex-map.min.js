!function(i){var e=yandex_locale.plugin_url,s={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-green.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},d={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-yellow.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},m={iconLayout:"default#image",iconImageHref:e+"svg/mark-house-red.svg",iconImageSize:[36,36],iconImageOffset:[-18,-36]},u={fillColor:"#44A147",strokeColor:"#18803F",strokeWidth:2,opacity:.7},v={fillColor:"#FFEE8B",strokeColor:"#FFDE17",strokeWidth:2,opacity:.7},g={fillColor:"#F7A09A",strokeColor:"#ED1C25",strokeWidth:2,opacity:.7};ymaps.ready(function(){i(".yandex-map").each(function(e,o){var a=i(o).attr("id");if(void 0!==a&&void 0!==window[a]){var t=i.parseJSON(window[a].params),l=new ymaps.Map(a,{zoom:t.zoom,center:[t.center_lat,t.center_lng]},{});if(l.controls.remove("trafficControl"),l.controls.remove("searchControl"),l.controls.remove("geolocationControl"),l.options.set("balloonMaxWidth",290),null!=t.marks&&i(t.marks).each(function(e,o){var a=null;"Point"==o.type?a=new ymaps.Placemark(o.coords,{},s):"Polygon"==o.type&&(a=new ymaps.Polygon(o.coords,{},u)),l.geoObjects.add(a)}),"ymap_full"===a||"ymap_project"===a){function n(e){i.post({url:yandex_locale.ajax_url,data:{action:"ymaps_json_post",nonce_code:yandex_locale.nonce,data:e}}).done(function(e){var o=i.parseJSON(e);if(0<o.features.length){console.log(o.features),i.each(o.features,function(e,o){var a=!!o.status&&o.status.slug;!function(e,o,a,t){var l=null,n=o.toLowerCase(),c=a;window.location.origin;if("point"==n){var i;switch(t){case"vacant":i=s;break;case"reserved":i=d;break;case"booked":i=m;break;default:i=s}l=new ymaps.Placemark(e,{},i),$collection.add(l)}else if("polygon"==n){var r;switch(t){case"vacant":r=u;break;case"reserved":r=v;break;case"booked":r=g;break;default:r=u}console.log(r),l=new ymaps.Polygon(e,{},r),$collection.add(l),console.log($collection)}else console.log("Object "+a+" without coordinates")}(o.geometry.coordinates,o.geometry.type,o.id,a)}),console.log("Map data loaded"),console.log($collection)}else console.error("Map data error")})}$object_manager=new ymaps.ObjectManager({geoObjectOpenBalloonOnClick:!1}),$collection=new ymaps.GeoObjectCollection(null,{}),l.geoObjects.add($object_manager),$object_manager.add($collection),$object_manager.objects.events.add("click",function(e){var o=e.get("objectId"),a=$object_manager.objects.getById(o),t=a.id;!function(e){return $object_manager.objects.getById(e).properties.balloonContent}(o)?(a.properties.balloonContent="Идет загрузка данных...",$object_manager.objects.balloon.open(o),function(e,o){var a=ymaps.vow.defer();return i.get({url:yandex_locale.ajax_url,data:{action:"ymap_object_load",nonce_code:yandex_locale.nonce,post_id:o}}).done(function(e){console.log("Object data loaded");var o=function(e){if(!e)return"Ошибка!";var o=i.parseJSON(e);return'<div class="module--header"><div class="module--title"><div class="module--suptitle">'+o.offer_type+"</div>"+o.title+'</div></div><div class="module--body"><div class="module--item icb"><i class="icb--icon icon icon-location"></i><div class="icb--title">'+o.location+'</div></div><div class="module--item module--item-50"><img src="'+o.thumb_url+'" alt="Фото участка" class="module--pic"></div><div class="module--item module--item-50"><div class="common_item"><div class="common_item--title"><em>Площадь</em></div><div class="common_item--value">'+o.square+'</div></div><div class="common_item"><div class="common_item--title"><em>Стоимость</em></div><div class="common_item--value">'+o.price+' ₽</div></div></div></div><div class="module--footer module--footer-center"><a href="'+o.link+'" class="module--but but but-green">Подробнее</a></div>'}(e);a.resolve(o)}).fail(function(){console.error("Object data error"),a.resolve("Ошибка!")}),a.promise()}(0,t).then(function(e){a.properties.balloonContent=e,$object_manager.objects.balloon.setData(a)})):$object_manager.objects.balloon.open(o)});var c=yandex_locale.filter;c&&($object_manager.removeAll(),n(c)),i(".js-map-link").on("click",function(){$object_manager.removeAll(),n()})}}})})}(jQuery);
//# sourceMappingURL=yandex-map.min.js.map