{"version":3,"sources":["acf-yandex-map.js"],"names":["$","acf_yandex_locale","blog_url","templateURL","template_url","term_slug","post_type","term_id","console","log","polygon_style","fillColor","strokeColor","strokeWidth","opacity","initialize_field","$el","$element","$input","$params","$collection","$map","$project","find","undefined","error","map_init_fail","parseJSON","val","data","when","get","response","features","length","each","index","id","content","type","geometry","term","coords","coordinates","done","ymaps","ready","map_init","fail","empty","destroy","Map","zoom","center","center_lat","center_lng","minZoom","controls","remove","behaviors","disable","copyrights","add","events","e","create_mark","save_map","search_controll","options","set","noPlacemark","useMapBounds","noSelect","kind","width","geoObjects","removeAll","zoom_control","control","ZoomControl","event","top","left","clear_button","Button","btn_clear_all","title","btn_clear_all_hint","selectOnClick","balloon","close","right","GeoObjectCollection","preset","mark","place_mark","marker_type","toLowerCase","mark_id","marks","mark_content","Placemark","iconContent","hintContent","mark_hint","Polygon","properties","import_mark","circle_size","getCenter","setCenter","getZoom","duration","submit","name","imported","value","err","alert","import_map","this","serializeArray","focus","select","import_button","image","btn_import","open","getBounds","import_desc","import_go","export_button","btn_export","export_desc","JSON","stringify","click","currentTarget","parent","children","form","map","n","i","size","draggable","parseInt","Circle","fillOpacity","strokeOpacity","isOpen","html","mark_save","mark_remove","getCoordinates","show_mark_editor","getType","split","_type","push","getRadius","on","label","next","removeClass","addClass","acf","add_action","get_fields","document","postbox","jQuery"],"mappings":"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","file":"acf-yandex-map.min.js","sourcesContent":["(function ($) {\n\n    'use strict';\n\n    /**\n     * Get ACF data\n     */\n    var blogURL = acf_yandex_locale.blog_url;\n    var templateURL = acf_yandex_locale.template_url;\n    var postType = acf_yandex_locale.post_type;\n    var termID = acf_yandex_locale.term_id;\n    var term_slug = acf_yandex_locale.term_slug;\n\n    console.log(term_slug);\n\n    var polygon_style = {\n        fillColor: '#44A147',\n        strokeColor: '#18803F',\n        strokeWidth: 2,\n        opacity: 0.75\n    };\n\n    /**\n     * Initialize admin interface\n     *\n     * @param {element} $el\n     * @returns {boolean}\n     */\n    function initialize_field($el) {\n\n        /**\n         * Element for map init\n         * @type {element}\n         */\n        var $element;\n\n        /**\n         * Hidden data input\n         * @type {element}\n         */\n        var $input;\n\n        /**\n         * Saved data or default\n         *\n         * @param {float} $params.center_lat\n         * @param {float} $params.center_lng\n         * @param {string} $params.type\n         * @param {int} $params.zoom\n         * @param {Object[]} $params.marks\n         *\n         * @type {object}\n         */\n        var $params;\n\n        /**\n         * Yandex map object\n         *\n         * @type {Object}\n         */\n        var $map = null;\n\n        /**\n         * Project objects\n         *\n         * @type {array}\n         */\n        var $project = [];\n\n        /**\n         * Project collection\n         *\n         * @type {object}\n         */\n        var $collection;\n\n        /// Init fields\n\n        $element = $($el).find('.map');\n        $input = ($el).find('.map-input');\n\n        if ($element == undefined || $input == undefined) {\n            console.error(acf_yandex_locale.map_init_fail);\n            return false;\n        }\n\n        /// Init params\n\n        $params = $.parseJSON($($input).val());\n\n        /// Import data & map init\n\n        if ( term_slug != 'no-project' && term_slug != undefined ) {\n\n            console.log('Import start');\n\n            var data = templateURL + '/map/data-project-' + term_slug + '.json';\n\n            $.when(\n\n                $.get(data, function(response) {\n\n                    if ( response.features.length > 0 ) {\n\n                        $.each(response.features, function(index, val) {\n                            $project[index] = {\n                                \"id\": val.id,\n                                \"content\": val.id,\n                                \"type\": val.geometry.type,\n                                \"term\": val.term,\n                                \"coords\": val.geometry.coordinates\n                            };\n                        });\n\n                    } else {\n\n                        console.error('Data import error!');\n\n                    }\n\n                })\n\n            ).done(function() {\n\n                console.log('Import success & map start');\n                console.log($project);\n\n                ymaps.ready(function () {\n                    map_init();\n                });\n\n            }).fail(function() {\n\n                console.error('Data import error!');\n\n            });\n\n        } else {\n\n            console.log('Just map start');\n\n            ymaps.ready(function () {\n                map_init();\n            });\n\n        };\n\n        /// Init map\n\n        // ymaps.ready(function () {\n        //     map_init();\n        // });\n\n        /**\n         * Initialization Map\n         */\n        function map_init() {\n\n            $element.empty();\n\n            if ($map != null) {\n                $map.destroy();\n                $map = null;\n                $input.val('');\n            }\n\n            $map = new ymaps.Map($element[0], {\n                zoom: $params.zoom,\n                center: [$params.center_lat, $params.center_lng],\n                type: 'yandex#' + $params.type\n            }, {\n                minZoom: 10\n            });\n\n            $map.controls.remove('trafficControl');\n            $map.controls.remove('fullscreenControl');\n            $map.behaviors.disable('scrollZoom');\n            $map.copyrights.add('&copy; Const Lab. ');\n\n            $map.events.add('click', function (e) {\n                create_mark(e.get('coords'));\n                save_map();\n            });\n\n            $map.events.add('typechange', function (e) {\n                save_map();\n            });\n\n            $map.events.add('boundschange', function () {\n                save_map();\n            });\n\n            /// Search Control\n\n            var search_controll = $map.controls.get('searchControl');\n            search_controll.options.set({\n                noPlacemark: true,\n                useMapBounds: false,\n                noSelect: true,\n                kind: 'locality',\n                width: 250\n            });\n\n            search_controll.events.add('resultselect', function () {\n                $map.geoObjects.removeAll();\n                save_map();\n            });\n\n            /// Geo location button\n\n            var geo_control = $map.controls.get('geolocationControl');\n            geo_control.events.add('locationchange', function () {\n                $map.geoObjects.removeAll();\n                save_map();\n            });\n\n            /// Zoom Control\n\n            var zoom_control = new ymaps.control.ZoomControl();\n            zoom_control.events.add('zoomchange', function (event) {\n                save_map();\n            });\n\n            $map.controls.add(zoom_control, {top: 75, left: 5});\n\n            /// Clear all button\n\n            var clear_button = new ymaps.control.Button({\n                data: {\n                    content: acf_yandex_locale.btn_clear_all,\n                    title: acf_yandex_locale.btn_clear_all_hint\n                },\n                options: {\n                    selectOnClick: false\n                }\n            });\n\n            clear_button.events.add('click', function () {\n                $map.balloon.close();\n                $map.geoObjects.removeAll();\n                save_map();\n            });\n\n            $map.controls.add(clear_button, {top: 5, right: 5});\n\n            /// Collection\n\n            $collection = new ymaps.GeoObjectCollection(null, {\n                preset: 'islands#yellowIcon'\n            });\n\n            /// Marks import\n\n            $($project).each(function(index, mark) {\n                import_mark(mark.coords, mark.type, mark.term, mark.id, mark.content);\n            });\n\n            /// Import load\n\n            $map.geoObjects.add($collection);\n\n            /// Marks load\n\n            $($params.marks).each(function (index, mark) {\n                create_mark(mark.coords, mark.type, mark.circle_size, mark.id, mark.content);\n            });\n\n            /// Map balloon\n\n            var center = $map.getCenter();\n\n            $map.balloon.events.add('autopanbegin', function () {\n                center = $map.getCenter();\n            });\n\n            $map.balloon.events.add('close', function () {\n                $map.setCenter(center, $map.getZoom(), {\n                    duration: 500\n                });\n            });\n\n            $map.balloon.events.add('open', function () {\n                $($el).find('.ya-import form').submit(function () {\n                    import_map($(this).serializeArray());\n                    return false;\n                });\n                $($el).find('.ya-import textarea, .ya-export textarea').focus().select();\n            });\n\n            /// Import Export Controls\n\n            var import_button = new ymaps.control.Button({\n                data: {\n                    image: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik0xMi42LDRoLTEuMDIxYy0wLjI3NiwwLTAuNSwwLjIyNC0wLjUsMC41czAuMjI0LDAuNSwwLjUsMC41SDEyLjZDMTMuMzk4LDUsMTQsNS42NDUsMTQsNi41djZjMCwwLjg1NS0wLjYwMiwxLjUtMS40LDEuNWgtMTBDMS43NDgsMTQsMSwxMy4yOTksMSwxMi41di02QzEsNS43MDEsMS43NDgsNSwyLjYsNWgwLjc2OGMwLjI3NiwwLDAuNS0wLjIyNCwwLjUtMC41UzMuNjQ1LDQsMy4zNjgsNEgyLjZDMS4xOTEsNCwwLDUuMTQ1LDAsNi41djZDMCwxMy44NTUsMS4xOTEsMTUsMi42LDE1aDEwYzEuMzQ2LDAsMi40LTEuMDk4LDIuNC0yLjV2LTZDMTUsNS4wOTgsMTMuOTQ1LDQsMTIuNiw0eiIvPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik03LjEzMywxMC4wMzRjMC4xMzcsMC4zMTUsMC41NjgsMC40MTMsMC43MDMsMC4xMDFjMC4wMTItMC4wMjksMS4xNzctMi40MTksMS45MjktMy4zNzNjMC4yNjQtMC4zMzUtMC4wOTUtMC42NC0wLjQ2My0wLjUzQzguOTgsNi4zMjgsNy45NjYsNy4wNTIsNy45NjYsNy4xMDFWMC41NzZjMC0wLjI3Ni0wLjE4OC0wLjU5MS0wLjQ2NS0wLjU5MWMtMC4wMDIsMC0wLjAwMywwLjAwMS0wLjAwNSwwLjAwMXMwLjAwMS0wLjAwMS0wLjAwMS0wLjAwMWMtMC4yNzYsMC0wLjQ5NSwwLjIyNC0wLjQ5NSwwLjVWNy4wMWMwLTAuMDQ5LTEuMDE4LTAuNzc0LTEuMzM5LTAuODY5Yy0wLjM2OC0wLjExLTAuNzE4LDAuMTg3LTAuNDY2LDAuNTNDNS44Nyw3LjU4Nyw2LjY1OSw4Ljk0Myw3LjEzMywxMC4wMzR6Ii8+PC9nPjwvc3ZnPg==',\n                    title: acf_yandex_locale.btn_import\n                },\n                options: {\n                    selectOnClick: false\n                }\n            });\n\n            import_button.events.add('click', function () {\n                $map.balloon.close();\n                $map.balloon.open($map.getBounds()[0], '<div class=\"ya-import\" style=\"margin: 5px\"><p class=\"description\">' + acf_yandex_locale.import_desc + '</p><form><textarea name=\"import\" cols=\"40\" rows=\"5\" autofocus></textarea><br><input type=\"submit\" class=\"button\" name=\"submit\" value=\"' + acf_yandex_locale.import_go + '\"/></form></div>');\n\n            });\n\n            var export_button = new ymaps.control.Button({\n                data: {\n                    image: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik0xMi42LDRoLTEuMDIxYy0wLjI3NiwwLTAuNSwwLjIyNC0wLjUsMC41czAuMjI0LDAuNSwwLjUsMC41SDEyLjZDMTMuMzk4LDUsMTQsNS42NDUsMTQsNi41djZjMCwwLjg1NS0wLjYwMiwxLjUtMS40LDEuNWgtMTBDMS43NDgsMTQsMSwxMy4yOTksMSwxMi41di02QzEsNS43MDEsMS43NDgsNSwyLjYsNWgwLjc2OGMwLjI3NiwwLDAuNS0wLjIyNCwwLjUtMC41UzMuNjQ1LDQsMy4zNjgsNEgyLjZDMS4xOTEsNCwwLDUuMTQ1LDAsNi41djZDMCwxMy44NTUsMS4xOTEsMTUsMi42LDE1aDEwYzEuMzQ2LDAsMi40LTEuMDk4LDIuNC0yLjV2LTZDMTUsNS4wOTgsMTMuOTQ1LDQsMTIuNiw0eiIvPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik03Ljg2OCwwLjIyNWMtMC4xMzctMC4zMTUtMC42MDItMC4zMjItMC43MzctMC4wMUM3LjExOCwwLjI0NCw1Ljk1NCwyLjYzNCw1LjIwMiwzLjU4OGMtMC4yNjQsMC4zMzUsMC4wOTUsMC42NCwwLjQ2MywwLjUzQzUuOTg2LDQuMDIyLDcsMy4yOTgsNywzLjI0OXY2LjUyNmMwLDAuMjc2LDAuMjIzLDAuNSwwLjQ5OSwwLjVjMC4wMDIsMCwwLjAwMy0wLjAwMSwwLjAwNS0wLjAwMXMtMC4wMDEsMC4wMDEsMC4wMDEsMC4wMDFjMC4yNzYsMCwwLjQ5NS0wLjIyNCwwLjQ5NS0wLjVWMy4yNDljMCwwLjA0OSwxLjAxOCwwLjc3NCwxLjMzOSwwLjg2OWMwLjM2OCwwLjExLDAuNzE4LTAuMTg3LDAuNDY2LTAuNTNDOS4xMzEsMi42NzEsOC4zNDEsMS4zMTUsNy44NjgsMC4yMjV6Ii8+PC9nPjwvc3ZnPg==',\n                    title: acf_yandex_locale.btn_export\n                },\n                options: {\n                    selectOnClick: false\n                }\n            });\n\n            export_button.events.add('click', function () {\n                $map.balloon.close();\n\n                $map.balloon.open($map.getBounds()[0], '<div class=\"ya-export\" style=\"margin: 5px\"><p class=\"description\">' + acf_yandex_locale.export_desc + '</p><textarea cols=\"40\" rows=\"5\" readonly>'\n                + JSON.stringify($params) + '</textarea></div>');\n            });\n\n            /// Mark editor\n\n            $map.events.add('balloonopen', function () {\n                $('.ya-editor textarea').focus();\n\n                $('.ya-editor .remove').click(function (event) {\n                    var mark_id = $(event.currentTarget).parent('form').children('input[type=\"hidden\"]').val();\n                    if (mark_id == undefined) return false;\n\n                    $map.balloon.close();\n                    $map.geoObjects.each(function (mark) {\n                        if (mark.properties.get('id') == mark_id)\n                            $map.geoObjects.remove(mark);\n                    });\n\n                    return false;\n                });\n\n                $('.ya-editor form').submit(function () {\n                    var data = $(this).serializeArray();\n                    var form = {};\n                    $.map(data, function (n, i) {\n                        form[n['name']] = n['value'];\n                    });\n\n                    $map.geoObjects.each(function (mark) {\n                        if (mark.properties.get('id') == form.id) {\n                            mark.properties.set('content', form.content);\n                            save_map();\n                        }\n                    });\n\n                    $map.balloon.close();\n\n                    return false;\n                });\n\n            });\n\n            $map.controls.add(export_button, {top: 5, right: 5});\n            $map.controls.add(import_button, {top: 5, right: 5});\n        }\n\n        /**\n         * Import geo mark\n         *\n         * @param {Array} coords\n         * @param {string} type Point type, Point or Circle\n         * @param {int} term\n         * @param {int} id\n         * @param {string} content\n         */\n        function import_mark(coords, type, term, id, content) {\n\n            // console.log(type);\n\n            var place_mark = null;\n            var marker_type = (type != null) ? type.toLowerCase() : $($el).find('.marker-type').val();\n\n            var mark_id = id;\n            if (id == undefined && $params.marks.length == 0)\n                mark_id = 1;\n            else\n                mark_id = (id == undefined) ? ($params.marks[$params.marks.length - 1].id + 1) : id;\n\n            var mark_content = (content == undefined) ? '' : content;\n\n            if (marker_type == 'point') { // create placemark\n\n                place_mark = new ymaps.Placemark(\n                    coords,\n                    {\n                        iconContent: mark_id,\n                        hintContent: acf_yandex_locale.mark_hint\n                    }, {\n                        // draggable: true\n                    }\n                );\n\n            } else if (marker_type == 'polygon') {\n\n                place_mark = new ymaps.Polygon(\n                    coords,\n                    {\n                        // iconContent: mark_id,\n                        hintContent: acf_yandex_locale.mark_hint\n                    }, \n                    polygon_style\n                );\n\n            } else {\n\n                console.error('Mark import error!')\n\n            }\n\n            // console.log(place_mark);\n\n            place_mark.properties.set('id', mark_id);\n            place_mark.properties.set('content', mark_content);\n\n            $collection.add(place_mark);\n\n        }\n\n        /**\n         * Create geo mark\n         *\n         * @param {Array} coords\n         * @param {string} type Point type, Point or Circle\n         * @param {int} size Circle size in meters\n         * @param {int} id\n         * @param {string} content\n         */\n        function create_mark(coords, type, size, id, content) {\n\n            var place_mark = null;\n            var marker_type = (type != null) ? type.toLowerCase() : $($el).find('.marker-type').val();\n\n            var mark_id = id;\n            if (id == undefined && $params.marks.length == 0)\n                mark_id = 1;\n            else\n                mark_id = (id == undefined) ? ($params.marks[$params.marks.length - 1].id + 1) : id;\n\n            var mark_content = (content == undefined) ? '' : content;\n\n            if (marker_type == 'point') { // create placemark\n\n                place_mark = new ymaps.Placemark(\n                    coords,\n                    {\n                        //iconContent: mark_id,\n                        hintContent: acf_yandex_locale.mark_hint\n                    }, {\n                        draggable: true\n                    }\n                );\n\n            } else { // if mark is circle\n\n                var circle_size = (size != null) ? size : (parseInt($($el).find('.circle-size').val()) / 2);\n\n                place_mark = new ymaps.Circle([\n                    coords,\n                    circle_size\n                ], {\n                    hintContent: acf_yandex_locale.mark_hint\n                }, {\n                    draggable: true,\n                    opacity: 0.5,\n                    fillOpacity: 0.1,\n                    fillColor: \"#DB709377\",\n                    strokeColor: \"#990066\",\n                    strokeOpacity: 0.7,\n                    strokeWidth: 5\n                });\n\n            }\n\n            place_mark.events.add('contextmenu', function () {\n                $map.geoObjects.remove(this);\n                save_map();\n            }, place_mark);\n\n            place_mark.events.add('dragend', function () {\n                save_map();\n            });\n\n            place_mark.events.add('click', function () {\n                if (!this.balloon.isOpen()) {\n                    show_mark_editor(this);\n                }\n            }, place_mark);\n\n            place_mark.properties.set('id', mark_id);\n            place_mark.properties.set('content', mark_content);\n\n            $map.geoObjects.add(place_mark);\n        }\n\n        /**\n         * Write map data in hidden field\n         */\n        function save_map() {\n\n            $params.zoom = $map.getZoom();\n\n            var coords = $map.getCenter();\n            $params.center_lat = coords[0];\n            $params.center_lng = coords[1];\n\n            var type = $map.getType().split('#');\n            $params.type = (type[1]) ? type[1] : 'map';\n\n            var marks = [];\n            $map.geoObjects.each(function (mark) {\n                var _type = mark.geometry.getType();\n                marks.push({\n                    id: mark.properties.get('id'),\n                    content: mark.properties.get('content'),\n                    type: _type,\n                    coords: mark.geometry.getCoordinates(),\n                    circle_size: (_type == 'Circle') ? mark.geometry.getRadius() : 0\n                });\n            });\n            $params.marks = marks;\n\n            $($input).val(JSON.stringify($params));\n        }\n\n        /**\n         * Import map from json\n         * @param data\n         * @returns {boolean}\n         */\n        function import_map(data) {\n\n            if (data.length == 0)\n                return false;\n\n            if (data[0].name != 'import')\n                return false;\n\n            try {\n                var imported = $.parseJSON(data[0].value);\n            }\n            catch (err) {\n                console.error(err, 'Import map error');\n                alert('Import map error');\n                return false;\n            }\n\n            $params = imported;\n\n            map_init();\n\n            return false;\n        }\n\n        /**\n         * Show mark editor\n         * @param mark\n         */\n        function show_mark_editor(mark) {\n            var html = '<div class=\"ya-editor\" style=\"margin: 5px\"><form name=\"mark\"><input type=\"hidden\" name=\"id\" value=\"' +\n                mark.properties.get('id') + '\"><textarea name=\"content\" rows=\"5\" cols=\"40\">' + mark.properties.get('content') +\n                '</textarea><input type=\"submit\" class=\"button button-primary\" value=\"' + acf_yandex_locale.mark_save +\n                '\"/>&nbsp;<button class=\"button remove\">' + acf_yandex_locale.mark_remove + '</button></form></div>';\n\n            $map.balloon.open(mark.geometry.getCoordinates(), html);\n\n            //console.info(mark.properties.get('id'));\n            //console.info(mark.properties.get('content'));\n\n\n            //$('input[name=\"color\"]').wpColorPicker({});\n        }\n\n        /**\n         * Change marker type state\n         */\n        $('.marker-type').on('change', function () {\n            var label = $(this).parent().next('th').children(0);\n            var select = $(this).parent().next('th').next('td').children(0);\n            if (this.value == 'circle') {\n                label.removeClass('hidden');\n                select.removeClass('hidden');\n            } else {\n                label.addClass('hidden');\n                select.addClass('hidden');\n            }\n        });\n\n    }\n\n\n    if (typeof acf.add_action !== 'undefined') {\n\n        /*\n         *  ready append (ACF5)\n         *\n         *  These are 2 events which are fired during the page load\n         *  ready = on page load similar to $(document).ready()\n         *  append = on new DOM elements appended via repeater field\n         *\n         *  @type\tevent\n         *  @date\t20/07/13\n         *\n         *  @param\t$el (jQuery selection) the jQuery element which contains the ACF fields\n         *  @return\tn/a\n         */\n\n        acf.add_action('ready append', function ($el) {\n\n            // search $el for fields of type 'FIELD_NAME'\n            acf.get_fields({type: 'yandex-map'}, $el).each(function () {\n\n                initialize_field($(this));\n\n            });\n\n        });\n\n\n    } else {\n\n\n        /*\n         *  acf/setup_fields (ACF4)\n         *\n         *  This event is triggered when ACF adds any new elements to the DOM.\n         *\n         *  @type\tfunction\n         *  @since\t1.0.0\n         *  @date\t01/01/12\n         *\n         *  @param\tevent\t\te: an event object. This can be ignored\n         *  @param\tElement\t\tpostbox: An element which contains the new HTML\n         *\n         *  @return\tn/a\n         */\n\n        $(document).on('acf/setup_fields', function (e, postbox) {\n\n            $(postbox).find('.field[data-field_type=\"yandex-map\"]').each(function () {\n\n                initialize_field($(this));\n\n            });\n\n        });\n\n\n    }\n\n\n})(jQuery);"]}