{"version":3,"sources":["acf-yandex-map.js"],"names":["$","$location","val","text","blogURL","acf_yandex_locale","blog_url","templateURL","template_url","projectName","term_slug","termID","post_type","term_id","polygonStyle","fillColor","strokeColor","strokeWidth","opacity","initialize_field","$el","$element","$input","$params","$map","find","undefined","console","error","map_init_fail","create_mark","coords","type","size","id","content","place_mark","marker_type","toLowerCase","mark_id","marks","length","mark_content","ymaps","Placemark","hintContent","mark_hint","preset","draggable","events","add","geoObjects","remove","this","save_map","properties","set","Polygon","editorDrawingCursor","editorMaxPoints","editor","startDrawing","zoom","getZoom","getCenter","center_lat","center_lng","getType","split","each","mark","_type","geometry","push","get","getCoordinates","JSON","stringify","parseJSON","ready","empty","destroy","Map","center","minZoom","controls","behaviors","disable","e","log","geocode","then","res","object","bounds","setBounds","checkZoomRange","err","search_controll","options","noPlacemark","useMapBounds","noSelect","kind","width","zoom_control","control","ZoomControl","event","top","left","clear_button","Button","data","btn_clear_all","title","btn_clear_all_hint","selectOnClick","balloon","close","removeAll","right","index","setCenter","duration","submit","import_map","serializeArray","focus","select","import_button","image","btn_import","open","getBounds","import_desc","import_go","export_button","btn_export","export_desc","click","currentTarget","parent","children","form","map","n","i","map_init","response","features","coordinates","on","label","next","value","removeClass","addClass","dataType","url","success","post","address","acf","square","slope","status","name","ymap","json","geometryType","dataItem","postType","link","balloonContentHeader","balloonContentBody","price","mountain","balloonContentFooter","when","toUpperCase","postData","add_action","get_fields","document","postbox","jQuery"],"mappings":"CAAA,SAAWA,GAOP,IAGIC,EAHYD,EAAE,yCAAyCE,MAG/B,KAFhBF,EAAE,kEAAkEG,OAErC,KAD5BH,EAAE,wCAAwCE,MAGrDE,EAAUC,kBAAkBC,SAC5BC,EAAcF,kBAAkBG,aAChCC,EAAcJ,kBAAkBK,UAEhCC,GADWN,kBAAkBO,UACpBP,kBAAkBQ,SAE3BC,EAAe,CACfC,UAAW,UACXC,YAAa,UACbC,YAAa,EACbC,QAAS,KA2Lb,SAASC,EAAiBC,GAMtB,IAAIC,EAMAC,EAaAC,EAOAC,EAAO,KAoBX,GAHAH,EAAWrB,EAAEoB,GAAKK,KAAK,QACvBH,EAAS,EAAMG,KAAK,cAEJC,MAAZL,GAAmCK,MAAVJ,EAEzB,OADAK,QAAQC,MAAMvB,kBAAkBwB,gBACzB,EAwPX,SAASC,EAAYC,EAAQC,EAAMC,EAAMC,EAAIC,GAEzC,IAAIC,EAAa,KAEbC,EAAuB,MAARL,EAAgBA,EAAKM,cAAgBtC,EAAEoB,GAAKK,KAAK,gBAAgBvB,MAEhFqC,EAAUL,EAEVK,EADMb,MAANQ,GAA2C,GAAxBX,EAAQiB,MAAMC,OACvB,EAEOf,MAANQ,EAAoBX,EAAQiB,MAAMjB,EAAQiB,MAAMC,OAAS,GAAGP,GAAK,EAAKA,EAErF,IAAIQ,EAA2BhB,MAAXS,EAAwB,GAAKA,EAE9B,SAAfE,IAKAD,EAAa,IAAIO,MAAMC,UACnBb,EACA,CAEIc,YAAaxC,kBAAkByC,WAChC,CACCC,OAAQ,wBACRC,WAAW,KAIRC,OAAOC,IAAI,cAAe,WACjC1B,EAAK2B,WAAWC,OAAOC,MACvBC,KACDlB,GAKHA,EAAWmB,WAAWC,IAAI,KAAMjB,GAChCH,EAAWmB,WAAWC,IAAI,UAAWd,GAErClB,EAAK2B,WAAWD,IAAId,KAQG,IAAlBL,EAAOU,SACRV,EAAS,KAIbK,EAAa,IAAIO,MAAMc,QAAQ1B,EAAQ,GAAI,CACvCiB,WAAW,EAEXU,oBAAqB,YAErBC,gBAAiB,EAEjB5C,UAAW,UAEXC,YAAa,UAEbC,YAAa,KAGNsC,WAAWC,IAAI,KAAMjB,GAChCH,EAAWmB,WAAWC,IAAI,UAAWd,GAGrClB,EAAK2B,WAAWD,IAAId,GAapBA,EAAWwB,OAAOC,gBAKtBzB,EAAWa,OAAOC,IAAI,UAAW,WAC7BI,MAEJlB,EAAWa,OAAOC,IAAI,oBAAqB,WACvCI,MAEJlB,EAAWa,OAAOC,IAAI,iBAAkB,WACpCI,MAwBR,SAASA,IAEL/B,EAAQuC,KAAOtC,EAAKuC,UAEpB,IAAIhC,EAASP,EAAKwC,YAClBzC,EAAQ0C,WAAalC,EAAO,GAC5BR,EAAQ2C,WAAanC,EAAO,GAE5B,IAAIC,EAAOR,EAAK2C,UAAUC,MAAM,KAChC7C,EAAQS,KAAQA,EAAK,GAAMA,EAAK,GAAK,MAErC,IAAIQ,EAAQ,GACZhB,EAAK2B,WAAWkB,KAAK,SAAUC,GAC3B,IAAIC,EAAQD,EAAKE,SAASL,UAC1B3B,EAAMiC,KAAK,CACPvC,GAAIoC,EAAKf,WAAWmB,IAAI,MACxBvC,QAASmC,EAAKf,WAAWmB,IAAI,WAC7B1C,KAAMuC,EACNxC,OAAQuC,EAAKE,SAASG,qBAI9BpD,EAAQiB,MAAQA,EAEhBxC,EAAEsB,GAAQpB,IAAI0E,KAAKC,UAAUtD,IApYjCA,EAAUvB,EAAE8E,UAAU9E,EAAEsB,GAAQpB,OAIhCyC,MAAMoC,MAAM,YAOZ,WAEI1D,EAAS2D,QAEG,MAARxD,IACAA,EAAKyD,UACLzD,EAAO,KACPF,EAAOpB,IAAI,MAGfsB,EAAO,IAAImB,MAAMuC,IAAI7D,EAAS,GAAI,CAC9ByC,KAAMvC,EAAQuC,KACdqB,OAAQ,CAAC5D,EAAQ0C,WAAY1C,EAAQ2C,YACrClC,KAAM,UAAYT,EAAQS,MAC3B,CACCoD,QAAS,MAGRC,SAASjC,OAAO,kBACrB5B,EAAK6D,SAASjC,OAAO,qBACrB5B,EAAK8D,UAAUC,QAAQ,cAGvB/D,EAAKyB,OAAOC,IAAI,QAAS,SAAUsC,GAC/B1D,EAAY0D,EAAEd,IAAI,WAClBpB,MAGJ9B,EAAKyB,OAAOC,IAAI,aAAc,SAAUsC,GACpClC,MAGJ9B,EAAKyB,OAAOC,IAAI,eAAgB,WAC5BI,MAK0B,IAAzB/B,EAAQiB,MAAMC,SAEfd,QAAQ8D,IAAI,uBAEA9C,MAAM+C,QAASzF,GAEjB0F,KAAK,SAAUC,GAErB,IAAIC,EAASD,EAAIzC,WAAWuB,IAAI,GAC5B3C,EAAS8D,EAAOrB,SAASG,iBACzBmB,EAASD,EAAOtC,WAAWmB,IAAI,aAEnC5C,EAAYC,EAAQ,QAAS,EAAG,EAAG,IAEnCP,EAAKuE,UAAUD,EAAQ,CAAEE,gBAAgB,IAEzC1C,KAED,SAAU2C,GACTtE,QAAQ8D,IAAI,iCAOpB,IAAIS,EAAkB1E,EAAK6D,SAASX,IAAI,iBACxCwB,EAAgBC,QAAQ3C,IAAI,CACxB4C,aAAa,EACbC,cAAc,EACdC,UAAU,EACVC,KAAM,WACNC,MAAO,MAGXN,EAAgBjD,OAAOC,IAAI,eAAgB,WAGvCI,MAKc9B,EAAK6D,SAASX,IAAI,sBACxBzB,OAAOC,IAAI,iBAAkB,WAErCI,MAKJ,IAAImD,EAAe,IAAI9D,MAAM+D,QAAQC,YACrCF,EAAaxD,OAAOC,IAAI,aAAc,SAAU0D,GAC5CtD,MAGJ9B,EAAK6D,SAASnC,IAAIuD,EAAc,CAACI,IAAK,GAAIC,KAAM,IAIhD,IAAIC,EAAe,IAAIpE,MAAM+D,QAAQM,OAAO,CACxCC,KAAM,CACF9E,QAAS9B,kBAAkB6G,cAC3BC,MAAO9G,kBAAkB+G,oBAE7BjB,QAAS,CACLkB,eAAe,KAIvBN,EAAa9D,OAAOC,IAAI,QAAS,WAC7B1B,EAAK8F,QAAQC,QACb/F,EAAK2B,WAAWqE,YAChBlE,MAGJ9B,EAAK6D,SAASnC,IAAI6D,EAAc,CAACF,IAAK,EAAGY,MAAO,IAIhDzH,EAAEuB,EAAQiB,OAAO6B,KAAK,SAAUqD,EAAOpD,GAEnCxC,EAAYwC,EAAKvC,OAAQuC,EAAKtC,KAAMsC,EAAKpC,GAAIoC,EAAKnC,WAKtD,IAAIgD,EAAS3D,EAAKwC,YAElBxC,EAAK8F,QAAQrE,OAAOC,IAAI,eAAgB,WACpCiC,EAAS3D,EAAKwC,cAGlBxC,EAAK8F,QAAQrE,OAAOC,IAAI,QAAS,WAC7B1B,EAAKmG,UAAUxC,EAAQ3D,EAAKuC,UAAW,CACnC6D,SAAU,QAIlBpG,EAAK8F,QAAQrE,OAAOC,IAAI,OAAQ,WAC5BlD,EAAEoB,GAAKK,KAAK,mBAAmBoG,OAAO,WAElC,OADAC,EAAW9H,EAAEqD,MAAM0E,mBACZ,IAEX/H,EAAEoB,GAAKK,KAAK,4CAA4CuG,QAAQC,WAKpE,IAAIC,EAAgB,IAAIvF,MAAM+D,QAAQM,OAAO,CACzCC,KAAM,CACFkB,MAAO,6hDACPhB,MAAO9G,kBAAkB+H,YAE7BjC,QAAS,CACLkB,eAAe,KAIvBa,EAAcjF,OAAOC,IAAI,QAAS,WAC9B1B,EAAK8F,QAAQC,QACb/F,EAAK8F,QAAQe,KAAK7G,EAAK8G,YAAY,GAAI,qEAAuEjI,kBAAkBkI,YAAc,0IAA4IlI,kBAAkBmI,UAAY,sBAI5T,IAAIC,EAAgB,IAAI9F,MAAM+D,QAAQM,OAAO,CACzCC,KAAM,CACFkB,MAAO,6gDACPhB,MAAO9G,kBAAkBqI,YAE7BvC,QAAS,CACLkB,eAAe,KAIvBoB,EAAcxF,OAAOC,IAAI,QAAS,WAC9B1B,EAAK8F,QAAQC,QAEb/F,EAAK8F,QAAQe,KAAK7G,EAAK8G,YAAY,GAAI,qEAAuEjI,kBAAkBsI,YAAc,6CAC5I/D,KAAKC,UAAUtD,GAAW,uBAKhCC,EAAKyB,OAAOC,IAAI,cAAe,WAC3BlD,EAAE,uBAAuBgI,QAEzBhI,EAAE,sBAAsB4I,MAAM,SAAUhC,GACpC,IAAIrE,EAAUvC,EAAE4G,EAAMiC,eAAeC,OAAO,QAAQC,SAAS,wBAAwB7I,MACrF,OAAewB,MAAXa,IAEJf,EAAK8F,QAAQC,QACb/F,EAAK2B,WAAWkB,KAAK,SAAUC,GACvBA,EAAKf,WAAWmB,IAAI,OAASnC,GAC7Bf,EAAK2B,WAAWC,OAAOkB,OALE,IAWrCtE,EAAE,mBAAmB6H,OAAO,WACxB,IAAIZ,EAAOjH,EAAEqD,MAAM0E,iBACfiB,EAAO,GAcX,OAbAhJ,EAAEiJ,IAAIhC,EAAM,SAAUiC,EAAGC,GACrBH,EAAKE,EAAQ,MAAKA,EAAS,QAG/B1H,EAAK2B,WAAWkB,KAAK,SAAUC,GACvBA,EAAKf,WAAWmB,IAAI,OAASsE,EAAK9G,KAClCoC,EAAKf,WAAWC,IAAI,UAAWwF,EAAK7G,SACpCmB,OAIR9B,EAAK8F,QAAQC,SAEN,MAKf/F,EAAK6D,SAASnC,IAAIuF,EAAe,CAAC5B,IAAK,EAAGY,MAAO,IACjDjG,EAAK6D,SAASnC,IAAIgF,EAAe,CAACrB,IAAK,EAAGY,MAAO,IAlOjD2B,KAicH,SAAStB,EAAWb,GAUbjH,EAAE0E,IAAIuC,EAAM,SAASoC,GAIjB,GAAgC,EAA3BA,EAASC,SAAS7G,OAyBnB,OAtBAlB,EAAQuC,KAAO,GACfvC,EAAQ0C,WAAa,kBACrB1C,EAAQ2C,WAAa,kBACrB3C,EAAQS,KAAO,MAEfhC,EAAEqE,KAAKgF,EAASC,SAAU,SAAS5B,EAAOxH,GACtCqB,EAAQiB,MAAMkF,GAAS,CACnBxF,GAAMhC,EAAIgC,GACVC,QAAWjC,EAAIgC,GACfF,KAAQ9B,EAAIsE,SAASxC,KACrBD,OAAU7B,EAAIsE,SAAS+E,eAI/B5H,QAAQ8D,IAAIlE,IAQL,IA9CvBuG,EAAYvH,EAAc,sBAAmCE,EAAc,SA+I3ET,EAAE,gBAAgBwJ,GAAG,SAAU,WAC3B,IAAIC,EAAQzJ,EAAEqD,MAAMyF,SAASY,KAAK,MAAMX,SAAS,GAC7Cd,EAASjI,EAAEqD,MAAMyF,SAASY,KAAK,MAAMA,KAAK,MAAMX,SAAS,GAC3C,UAAd1F,KAAKsG,OACLF,EAAMG,YAAY,UAClB3B,EAAO2B,YAAY,YAEnBH,EAAMI,SAAS,UACf5B,EAAO4B,SAAS,aAp0BxBlI,QAAQ8D,IAAIrF,EAAU,+BAAiCO,GAEvDX,EAAE0E,IAAI,CACFoF,SAAU,OACVC,IAAK3J,EAAU,+BAAiCO,EAChDqJ,QAAS,SAASX,GAId,IAAIpC,EAAO,CACPjF,KAAM,oBACNsH,SAAU,IAGdtJ,EAAEqE,KAAKgF,EAAU,SAAS3B,EAAOuC,GAG7B,IAAIC,EAAUD,EAAKE,IAAI,qBAAuB,KAAOF,EAAKE,IAAI,iBAAuB,KAAI,KAAOF,EAAKE,IAAI,oBAErGC,EAASH,EAAKE,IAAK,eAAkB,QAEzC,GAAwC,EAAnCF,EAAKE,IAAI,iBAAiB1H,OAC3B,IAAI4H,EAAQ,aAAe9J,EAAc,kBAAoB0J,EAAKE,IAAI,iBAAkB,+DAEpFE,EAAQ,GAGhB,GAAwB3I,MAAnBuI,EAAKE,IAAIG,OACV,IAAIA,EAASL,EAAKE,IAAIG,OAAOC,KAIjC,GAAsB7I,MAAjBuI,EAAKE,IAAIK,KACV,IAAIC,EAAOzK,EAAE8E,UAAUmF,EAAKE,IAAIK,MAGpC,GAAsB9I,MAAjBuI,EAAKE,IAAIK,MAAyC,EAApBC,EAAKjI,MAAMC,OAE1C,IAAIV,EAAS0I,EAAKjI,MAAM,GAAGT,OAEvB2I,EAAiC,IAAlB3I,EAAOU,OAAe,UAAY,QAoBzD,IAAIkI,EAAW,CACX3I,KAAM,UACN4I,SAAUX,EAAKjI,KACfE,GAAI+H,EAAK/H,GACT2I,KAAMZ,EAAKY,KACX1E,QAASrF,EACT0D,SAAU,CACNxC,KAAM0I,EACNnB,YAAaxH,GAEjBwB,WAAY,CACRuH,qBACI,2FACqEb,EAAKE,IAAI,WAAa,uEACpBG,EAAS,eAEpFS,mBACI,iLAG6CX,EAAS,oLAIcH,EAAKE,IAAIa,MAAQ,4IAIhDf,EAAKE,IAAI,aAAac,SAAW,wIAI9DZ,EACA,4DAA8DJ,EAAKE,IAAI,mBAAqB,qBAGxGe,qBACI,wCAIkBjB,EAAKY,KAAO,oLAGlChI,YAAaqH,IAIrBjD,EAAe,SAAExC,KAAMkG,KAkBvC,SAAmB1D,EAAM2D,EAAUL,GAGb,YAAbK,GAED5K,EAAEmL,KAEEnL,EAAEiK,KAAK,CACHF,IAAMxJ,EAAc,qBACpB0G,KAAO,CACH2D,SAAUA,EACVL,KAAMA,EACNE,KAAO7F,KAAKC,UAAUoC,EAAM,GAAI,IAEpC+C,QAAS,SAASX,GACd1H,QAAQ8D,IAAI,aAAemF,EAASQ,mBAG9CzF,KAAK,cAhCH0F,CAAUpE,EAAM,UAAWxG,IAG/BmB,MAAO,SAASqF,GAEZtF,QAAQ8D,IAAI,sBAstBM,IAAnB0E,IAAImB,WAgBXnB,IAAImB,WAAW,eAAgB,SAAUlK,GAGrC+I,IAAIoB,WAAW,CAACvJ,KAAM,cAAeZ,GAAKiD,KAAK,WAE3ClD,EAAiBnB,EAAEqD,WAyB3BrD,EAAEwL,UAAUhC,GAAG,mBAAoB,SAAUhE,EAAGiG,GAE5CzL,EAAEyL,GAAShK,KAAK,wCAAwC4C,KAAK,WAEzDlD,EAAiBnB,EAAEqD,WA35BnC,CAq6BGqI","file":"acf-yandex-map.min.js","sourcesContent":["(function ($) {\n\n    // 'use strict';\n\n    /**\n     * Get ACF data\n     */\n    var $district = $('[data-name=\"location-district\"] input').val();\n    var $city = $('[data-name=\"location-city\"] select option[selected=\"selected\"]').text();\n    var $address = $('[data-name=\"location-address\"] input').val();\n    var $location = $district + ', ' + $city + ', ' + $address;\n\n    var blogURL = acf_yandex_locale.blog_url;\n    var templateURL = acf_yandex_locale.template_url;\n    var projectName = acf_yandex_locale.term_slug;\n    var postType = acf_yandex_locale.post_type;\n    var termID = acf_yandex_locale.term_id;\n\n    var polygonStyle = {\n        fillColor: '#44A147',\n        strokeColor: '#18803F',\n        strokeWidth: 2,\n        opacity: 0.75\n    };\n\n    /**\n     * AJAX projects JSON\n     */\n    function getLands() {\n\n        console.log(blogURL + '/wp-json/wp/v2/land?project=' + termID);\n\n        $.get({\n            dataType: 'json',\n            url: blogURL + '/wp-json/wp/v2/land?project=' + termID,\n            success: function(response) {\n\n                // console.log(response);\n\n                var data = {\n                    type: 'FeatureCollection',\n                    features: []\n                };\n\n                $.each(response, function(index, post) {\n\n                    // Обработаем некоторые данные заранее\n                    var address = post.acf['location-district'] + ', ' + post.acf['location-city']['name'] + ', ' + post.acf['location-address'];\n\n                    var square = post.acf[ 'land-square' ] + ' сот.';\n\n                    if ( post.acf['landscape-pic'].length > 0 ) {\n                        var slope = '<img src=\"' + templateURL + '/svg/landscape/' + post.acf['landscape-pic'] +'.svg\" alt=\"Ландшафт\" class=\"slope--img slope--img-hor\">';\n                    } else {\n                        var slope = '';\n                    }\n\n                    if ( post.acf.status != undefined ) {\n                        var status = post.acf.status.name;\n                    };\n\n                    // Проверим наличие плагина, распарсим данные\n                    if ( post.acf.ymap != undefined ) {\n                        var json = $.parseJSON(post.acf.ymap);\n                    };\n\n                    if ( post.acf.ymap != undefined && json.marks.length > 0 ) { // Если установлены координаты в плагине\n                        // Получим координаты из плагина\n                        var coords = json.marks[0].coords;\n                        // Определим геометрию объекта\n                        var geometryType = coords.length === 1 ? 'Polygon' : 'Point';\n\n                    // } else { // синхрона не будет, тормозит\n\n                        // Если нет, получим координаты из Геокодера\n                        // var defaultCoords;\n\n                        // $.get({\n                        //     async: false,\n                        //     url: 'https://geocode-maps.yandex.ru/1.x/?format=json&geocode=' + address.replace( ', ', '+' ),\n                        //     success: function(data) {\n                        //         defaultCoords = data.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos;\n                        //     }\n                        // }); \n\n                        // var coords = defaultCoords.split(' ').reverse();\n                        // var geometryType = 'Point';\n\n                    }; // Координаты определены\n\n                    var dataItem = {\n                        type: 'Feature',\n                        postType: post.type, \n                        id: post.id,\n                        link: post.link,\n                        options: polygonStyle,\n                        geometry: {\n                            type: geometryType,\n                            coordinates: coords\n                        },\n                        properties: {\n                            balloonContentHeader: \n                                '<div class=\"module--header\">' +\n                                    '<div class=\"module--title module--title-available\">Участок №' + post.acf['land-id'] + '</div>' +\n                                    '<div class=\"module--status status status-nopadding js-status\">' + status + '</div>' +\n                                '</div>',\n                            balloonContentBody: \n                                '<div class=\"module--body\">' +\n                                    '<div class=\"module--item module--item-50 common_item\">' +\n                                        '<div class=\"common_item--title\"><em>Площадь участка</em></div>' +\n                                        '<div class=\"common_item--value\">' + square + '</div>' +\n                                    '</div>' +\n                                    '<div class=\"module--item module--item-50 common_item\">' +\n                                        '<div class=\"common_item--title\"><em>Стоимость</em></div>' +\n                                        '<div class=\"common_item--value\"><span class=\"js-money\">' + post.acf.price + '</span> ₽</div>' +\n                                    '</div>' +\n                                    '<div class=\"module--item icb d-none d-lg-block\">' +\n                                        '<i class=\"icb--icon icon icon-mountain\"></i>' +\n                                        '<div class=\"icb--title\">' + post.acf['spec-land'].mountain + '</div>' +\n                                    '</div>' +\n                                    '<div class=\"module--item slope slope-hor d-none d-lg-flex\">' +\n                                        '<div class=\"slope--title slope--title-hor\">Уклон участка</div>' +\n                                        slope + \n                                        '<div class=\"slope--subtitle slope--subtitle-hor js-typo\">' + post.acf['landscape-descr'] + '</div>' +\n                                    '</div>' +\n                                '</div>',\n                            balloonContentFooter:\n                                '<div class=\"module--footer\">' +\n                                    // Temporary disabled modal desktop link\n                                    // '<button type=\"button\" class=\"module--more d-none d-lg-inline-block\" data-toggle=\"modal\" data-target=\"#objectModal\">Подробнее об участке</button>' +\n                                    // '<a href=\"' + post.link + '\" class=\"module--more d-lg-none\">Подробнее об участке</a>' +\n                                    '<a href=\"' + post.link + '\" class=\"module--more\">Подробнее об участке</a>' +\n                                    '<button type=\"button\" class=\"module--but but but-green\" data-toggle=\"modal\" data-target=\"#orderModal\">Забронировать</button>' +\n                                '</div>',\n                            hintContent: address\n                        }\n                    };\n\n                    data['features'].push( dataItem );\n                     \n                }); // each end\n\n                postData( data, 'project', projectName );\n\n            }, // success end\n            error: function(data) {\n                // `data` will not be JSON\n                console.log('JSON Error');\n            }\n\n        });\n\n    };\n\n    getLands();\n\n    function postData( data, postType, name ) {\n\n        // new post\n        if ( postType === 'project' ) {\n\n            $.when(\n                // Post project\n                $.post({\n                    url : templateURL + '/ajax/ajax-map.php',\n                    data : {\n                        postType: postType,\n                        name: name,\n                        json : JSON.stringify(data, \"\", 2)\n                    },\n                    success: function(response) {\n                        console.log('AJAX POST ' + postType.toUpperCase());\n                    }\n                })\n            ).then(function() {\n                // All is ready now, so...\n            });\n            \n        // } else {\n\n        //     $.when(\n        //         // Post \"postType\"\n        //         $.post({\n        //             url : templateURL + '/ajax/ajax-map.php',\n        //             data : {\n        //                 postType: postType,\n        //                 json : JSON.stringify(data, \"\", 2)\n        //             },\n        //             success: function(response) {\n        //                 console.log('AJAX POST ' + postType.toUpperCase());\n        //             }\n        //         })\n        //     ).then(function() {\n        //         // All is ready now, so...\n        //         // initBigMap();\n        //         // ymaps.ready(initBigMap);\n        //         // отключено из-за дублирования карты\n        //     });\n\n        };\n\n    };\n\n    /**\n     * Initialize admin interface\n     *\n     * @param {element} $el\n     * @returns {boolean}\n     */\n    function initialize_field($el) {\n\n        /**\n         * Element for map init\n         * @type {element}\n         */\n        var $element;\n\n        /**\n         * Hidden data input\n         * @type {element}\n         */\n        var $input;\n\n        /**\n         * Saved data or default\n         *\n         * @param {float} $params.center_lat\n         * @param {float} $params.center_lng\n         * @param {string} $params.type\n         * @param {int} $params.zoom\n         * @param {Object[]} $params.marks\n         *\n         * @type {object}\n         */\n        var $params;\n\n        /**\n         * Yandex map object\n         *\n         * @type {Object}\n         */\n        var $map = null;\n\n        /**\n         * Yandex map geocoder\n         *\n         * @type {object}\n         */\n        var $geocoder;\n\n        /**\n         * Geocoder coordinates\n         *\n         */\n        // var $coords;\n\n        /// Init fields\n\n        $element = $($el).find('.map');\n        $input = ($el).find('.map-input');\n\n        if ($element == undefined || $input == undefined) {\n            console.error(acf_yandex_locale.map_init_fail);\n            return false;\n        }\n\n        /// Init params\n\n        $params = $.parseJSON($($input).val());\n\n        /// Init map\n\n        ymaps.ready(function () {\n            map_init();\n        });\n\n        /**\n         * Initialization Map\n         */\n        function map_init() {\n\n            $element.empty();\n\n            if ($map != null) {\n                $map.destroy();\n                $map = null;\n                $input.val('');\n            }\n\n            $map = new ymaps.Map($element[0], {\n                zoom: $params.zoom,\n                center: [$params.center_lat, $params.center_lng],\n                type: 'yandex#' + $params.type\n            }, {\n                minZoom: 10\n            });\n\n            $map.controls.remove('trafficControl');\n            $map.controls.remove('fullscreenControl');\n            $map.behaviors.disable('scrollZoom');\n            // $map.copyrights.add('&copy; Const Lab. ');\n\n            $map.events.add('click', function (e) {\n                create_mark(e.get('coords'));\n                save_map();\n            });\n\n            $map.events.add('typechange', function (e) {\n                save_map();\n            });\n\n            $map.events.add('boundschange', function () {\n                save_map();\n            });\n\n            /// Geocoder\n\n            if ( $params.marks.length === 0 ) { // if there are no marks\n                \n                console.log('Geocoder works here');\n\n                $geocoder = ymaps.geocode( $location ); // start geocoder\n\n                $geocoder.then(function (res) {\n\n                    var object = res.geoObjects.get(0); // get first object\n                    var coords = object.geometry.getCoordinates(); // get coords\n                    var bounds = object.properties.get('boundedBy'); // get bounds\n\n                    create_mark(coords, 'Point', 0, 1, ''); // create mark\n\n                    $map.setBounds(bounds, { checkZoomRange: true }); // show map with bounds\n\n                    save_map(); // save map\n\n                }, function (err) {\n                    console.log('Yandex.Maps Geocoder Error');\n                });\n\n            };\n\n            /// Search Control\n\n            var search_controll = $map.controls.get('searchControl');\n            search_controll.options.set({\n                noPlacemark: true,\n                useMapBounds: true, // was false\n                noSelect: true,\n                kind: 'locality',\n                width: 250\n            });\n\n            search_controll.events.add('resultselect', function () {\n                // $map.geoObjects.removeAll(); // remove all placemarks\n                // create_mark(e.get('coords')); // create mark\n                save_map();\n            });\n\n            /// Geo location button\n\n            var geo_control = $map.controls.get('geolocationControl');\n            geo_control.events.add('locationchange', function () {\n                // $map.geoObjects.removeAll(); // don't remove placemark\n                save_map();\n            });\n\n            /// Zoom Control\n\n            var zoom_control = new ymaps.control.ZoomControl();\n            zoom_control.events.add('zoomchange', function (event) {\n                save_map();\n            });\n\n            $map.controls.add(zoom_control, {top: 75, left: 5});\n\n            /// Clear all button\n\n            var clear_button = new ymaps.control.Button({\n                data: {\n                    content: acf_yandex_locale.btn_clear_all,\n                    title: acf_yandex_locale.btn_clear_all_hint\n                },\n                options: {\n                    selectOnClick: false\n                }\n            });\n\n            clear_button.events.add('click', function () {\n                $map.balloon.close();\n                $map.geoObjects.removeAll();\n                save_map();\n            });\n\n            $map.controls.add(clear_button, {top: 5, right: 5});\n\n            /// Marks load\n\n            $($params.marks).each(function (index, mark) {\n                // create_mark(mark.coords, mark.type, mark.circle_size, mark.id, mark.content);\n                create_mark(mark.coords, mark.type, mark.id, mark.content);\n            });\n\n            /// Map balloon\n\n            var center = $map.getCenter();\n\n            $map.balloon.events.add('autopanbegin', function () {\n                center = $map.getCenter();\n            });\n\n            $map.balloon.events.add('close', function () {\n                $map.setCenter(center, $map.getZoom(), {\n                    duration: 500\n                });\n            });\n\n            $map.balloon.events.add('open', function () {\n                $($el).find('.ya-import form').submit(function () {\n                    import_map($(this).serializeArray());\n                    return false;\n                });\n                $($el).find('.ya-import textarea, .ya-export textarea').focus().select();\n            });\n\n            /// Import Export Controls\n\n            var import_button = new ymaps.control.Button({\n                data: {\n                    image: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik0xMi42LDRoLTEuMDIxYy0wLjI3NiwwLTAuNSwwLjIyNC0wLjUsMC41czAuMjI0LDAuNSwwLjUsMC41SDEyLjZDMTMuMzk4LDUsMTQsNS42NDUsMTQsNi41djZjMCwwLjg1NS0wLjYwMiwxLjUtMS40LDEuNWgtMTBDMS43NDgsMTQsMSwxMy4yOTksMSwxMi41di02QzEsNS43MDEsMS43NDgsNSwyLjYsNWgwLjc2OGMwLjI3NiwwLDAuNS0wLjIyNCwwLjUtMC41UzMuNjQ1LDQsMy4zNjgsNEgyLjZDMS4xOTEsNCwwLDUuMTQ1LDAsNi41djZDMCwxMy44NTUsMS4xOTEsMTUsMi42LDE1aDEwYzEuMzQ2LDAsMi40LTEuMDk4LDIuNC0yLjV2LTZDMTUsNS4wOTgsMTMuOTQ1LDQsMTIuNiw0eiIvPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik03LjEzMywxMC4wMzRjMC4xMzcsMC4zMTUsMC41NjgsMC40MTMsMC43MDMsMC4xMDFjMC4wMTItMC4wMjksMS4xNzctMi40MTksMS45MjktMy4zNzNjMC4yNjQtMC4zMzUtMC4wOTUtMC42NC0wLjQ2My0wLjUzQzguOTgsNi4zMjgsNy45NjYsNy4wNTIsNy45NjYsNy4xMDFWMC41NzZjMC0wLjI3Ni0wLjE4OC0wLjU5MS0wLjQ2NS0wLjU5MWMtMC4wMDIsMC0wLjAwMywwLjAwMS0wLjAwNSwwLjAwMXMwLjAwMS0wLjAwMS0wLjAwMS0wLjAwMWMtMC4yNzYsMC0wLjQ5NSwwLjIyNC0wLjQ5NSwwLjVWNy4wMWMwLTAuMDQ5LTEuMDE4LTAuNzc0LTEuMzM5LTAuODY5Yy0wLjM2OC0wLjExLTAuNzE4LDAuMTg3LTAuNDY2LDAuNTNDNS44Nyw3LjU4Nyw2LjY1OSw4Ljk0Myw3LjEzMywxMC4wMzR6Ii8+PC9nPjwvc3ZnPg==',\n                    title: acf_yandex_locale.btn_import\n                },\n                options: {\n                    selectOnClick: false\n                }\n            });\n\n            import_button.events.add('click', function () {\n                $map.balloon.close();\n                $map.balloon.open($map.getBounds()[0], '<div class=\"ya-import\" style=\"margin: 5px\"><p class=\"description\">' + acf_yandex_locale.import_desc + '</p><form><textarea name=\"import\" cols=\"40\" rows=\"5\" autofocus></textarea><br><input type=\"submit\" class=\"button\" name=\"submit\" value=\"' + acf_yandex_locale.import_go + '\"/></form></div>');\n\n            });\n\n            var export_button = new ymaps.control.Button({\n                data: {\n                    image: 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTYgMTYiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxnPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik0xMi42LDRoLTEuMDIxYy0wLjI3NiwwLTAuNSwwLjIyNC0wLjUsMC41czAuMjI0LDAuNSwwLjUsMC41SDEyLjZDMTMuMzk4LDUsMTQsNS42NDUsMTQsNi41djZjMCwwLjg1NS0wLjYwMiwxLjUtMS40LDEuNWgtMTBDMS43NDgsMTQsMSwxMy4yOTksMSwxMi41di02QzEsNS43MDEsMS43NDgsNSwyLjYsNWgwLjc2OGMwLjI3NiwwLDAuNS0wLjIyNCwwLjUtMC41UzMuNjQ1LDQsMy4zNjgsNEgyLjZDMS4xOTEsNCwwLDUuMTQ1LDAsNi41djZDMCwxMy44NTUsMS4xOTEsMTUsMi42LDE1aDEwYzEuMzQ2LDAsMi40LTEuMDk4LDIuNC0yLjV2LTZDMTUsNS4wOTgsMTMuOTQ1LDQsMTIuNiw0eiIvPjxwYXRoIGZpbGw9IiM2NjY2NjYiIGQ9Ik03Ljg2OCwwLjIyNWMtMC4xMzctMC4zMTUtMC42MDItMC4zMjItMC43MzctMC4wMUM3LjExOCwwLjI0NCw1Ljk1NCwyLjYzNCw1LjIwMiwzLjU4OGMtMC4yNjQsMC4zMzUsMC4wOTUsMC42NCwwLjQ2MywwLjUzQzUuOTg2LDQuMDIyLDcsMy4yOTgsNywzLjI0OXY2LjUyNmMwLDAuMjc2LDAuMjIzLDAuNSwwLjQ5OSwwLjVjMC4wMDIsMCwwLjAwMy0wLjAwMSwwLjAwNS0wLjAwMXMtMC4wMDEsMC4wMDEsMC4wMDEsMC4wMDFjMC4yNzYsMCwwLjQ5NS0wLjIyNCwwLjQ5NS0wLjVWMy4yNDljMCwwLjA0OSwxLjAxOCwwLjc3NCwxLjMzOSwwLjg2OWMwLjM2OCwwLjExLDAuNzE4LTAuMTg3LDAuNDY2LTAuNTNDOS4xMzEsMi42NzEsOC4zNDEsMS4zMTUsNy44NjgsMC4yMjV6Ii8+PC9nPjwvc3ZnPg==',\n                    title: acf_yandex_locale.btn_export\n                },\n                options: {\n                    selectOnClick: false\n                }\n            });\n\n            export_button.events.add('click', function () {\n                $map.balloon.close();\n\n                $map.balloon.open($map.getBounds()[0], '<div class=\"ya-export\" style=\"margin: 5px\"><p class=\"description\">' + acf_yandex_locale.export_desc + '</p><textarea cols=\"40\" rows=\"5\" readonly>'\n                + JSON.stringify($params) + '</textarea></div>');\n            });\n\n            /// Mark editor\n\n            $map.events.add('balloonopen', function () {\n                $('.ya-editor textarea').focus();\n\n                $('.ya-editor .remove').click(function (event) {\n                    var mark_id = $(event.currentTarget).parent('form').children('input[type=\"hidden\"]').val();\n                    if (mark_id == undefined) return false;\n\n                    $map.balloon.close();\n                    $map.geoObjects.each(function (mark) {\n                        if (mark.properties.get('id') == mark_id)\n                            $map.geoObjects.remove(mark);\n                    });\n\n                    return false;\n                });\n\n                $('.ya-editor form').submit(function () {\n                    var data = $(this).serializeArray();\n                    var form = {};\n                    $.map(data, function (n, i) {\n                        form[n['name']] = n['value'];\n                    });\n\n                    $map.geoObjects.each(function (mark) {\n                        if (mark.properties.get('id') == form.id) {\n                            mark.properties.set('content', form.content);\n                            save_map();\n                        }\n                    });\n\n                    $map.balloon.close();\n\n                    return false;\n                });\n\n            });\n\n            $map.controls.add(export_button, {top: 5, right: 5});\n            $map.controls.add(import_button, {top: 5, right: 5});\n        }\n\n        /**\n         * Create geo mark\n         *\n         * @param {Array} coords\n         * @param {string} type Point type, Point or Circle\n         * @param {int} size Circle size in meters\n         * @param {int} id\n         * @param {string} content\n         */\n        function create_mark(coords, type, size, id, content) {\n\n            var place_mark = null;\n\n            var marker_type = (type != null) ? type.toLowerCase() : $($el).find('.marker-type').val();\n\n            var mark_id = id;\n            if (id == undefined && $params.marks.length == 0)\n                mark_id = 1;\n            else\n                mark_id = (id == undefined) ? ($params.marks[$params.marks.length - 1].id + 1) : id;\n\n            var mark_content = (content == undefined) ? '' : content;\n\n            if (marker_type == 'point') { // create placemark\n\n\n                // $map.geoObjects.removeAll(); // remove all placemars\n\n                place_mark = new ymaps.Placemark(\n                    coords,\n                    {\n                        //iconContent: mark_id,\n                        hintContent: acf_yandex_locale.mark_hint\n                    }, {\n                        preset: \"islands#orangeDotIcon\",\n                        draggable: true\n                    }\n                );\n\n                place_mark.events.add('contextmenu', function () {\n                    $map.geoObjects.remove(this);\n                    save_map();\n                }, place_mark);\n\n                // place_mark.events.add('dragend', function () {\n                //     save_map();\n                // });\n                place_mark.properties.set('id', mark_id);\n                place_mark.properties.set('content', mark_content);\n\n                $map.geoObjects.add(place_mark);\n\n\n            } else { // if mark is circle (polygon)\n\n                // $map.geoObjects.removeAll(); // remove all placemarks\n\n                // Если координаты всего две то сбросим их для рисования многоугольника с нуля \n                if ( coords.length === 2 ) {\n                    coords = [];\n                };\n\n                // Создаем многоугольник без вершин.\n                place_mark = new ymaps.Polygon(coords, {}, {\n                    draggable: true,\n                    // Курсор в режиме добавления новых вершин.\n                    editorDrawingCursor: \"crosshair\",\n                    // Максимально допустимое количество вершин.\n                    editorMaxPoints: 5,\n                    // Цвет заливки.\n                    fillColor: '#44A147',\n                    // Цвет обводки.\n                    strokeColor: '#18803F',\n                    // Ширина обводки.\n                    strokeWidth: 2\n                });\n\n                place_mark.properties.set('id', mark_id);\n                place_mark.properties.set('content', mark_content);\n\n                // Добавляем многоугольник на карту.\n                $map.geoObjects.add(place_mark);\n\n                // В режиме добавления новых вершин меняем цвет обводки многоугольника.\n                // var stateMonitor = new ymaps.Monitor(place_mark.editor.state);\n                // stateMonitor.add(\"drawing\", function (newValue) {\n                //     place_mark.options.set(\"strokeColor\", newValue ? '#FF0000' : '#0000FF');\n                //     console.log('test');\n                //     if ( newValue === false ) {\n                //         save_map(); // сохраняем карту при окончании редактирования\n                //     };\n                // });\n\n                // Включаем режим редактирования с возможностью добавления новых вершин.\n                place_mark.editor.startDrawing();\n\n            }\n\n            // Сохраним состояние карты после событий с меткой или полигоном\n            place_mark.events.add('dragend', function () {\n                save_map();\n            });\n            place_mark.events.add('editorstatechange', function () {\n                save_map();\n            });\n            place_mark.events.add('geometrychange', function () {\n                save_map();\n            });\n\n\n            \n\n            /// Выключили удаление метки правой кнопкой\n            // place_mark.events.add('contextmenu', function () {\n            //     $map.geoObjects.remove(this);\n            //     save_map();\n            // }, place_mark);\n            \n\n            /// Выключили балун\n            // place_mark.events.add('click', function () {\n            //     if (!this.balloon.isOpen()) {\n            //         show_mark_editor(this);\n            //     }\n            // }, place_mark);\n        }\n\n        /**\n         * Write map data in hidden field\n         */\n        function save_map() {\n\n            $params.zoom = $map.getZoom();\n\n            var coords = $map.getCenter();\n            $params.center_lat = coords[0];\n            $params.center_lng = coords[1];\n\n            var type = $map.getType().split('#');\n            $params.type = (type[1]) ? type[1] : 'map';\n\n            var marks = [];\n            $map.geoObjects.each(function (mark) {\n                var _type = mark.geometry.getType();\n                marks.push({\n                    id: mark.properties.get('id'),\n                    content: mark.properties.get('content'),\n                    type: _type,\n                    coords: mark.geometry.getCoordinates(),\n                    // circle_size: (_type == 'Circle') ? mark.geometry.getRadius() : 0\n                });\n            });\n            $params.marks = marks;\n\n            $($input).val(JSON.stringify($params));\n        }\n\n        var test_project = {\n          \"type\": \"FeatureCollection\",\n          \"features\": [\n            {\n              \"type\": \"Feature\",\n              \"postType\": \"land\",\n              \"id\": 261,\n              \"link\": \"http://vsevreestr.localhost/land/uchastok-10-2-sotki-tajtsy-leningradskaya-oblast/\",\n              \"options\": {\n                \"fillColor\": \"#44A147\",\n                \"strokeColor\": \"#18803F\",\n                \"strokeWidth\": 2,\n                \"opacity\": 0.75\n              },\n              \"geometry\": {\n                \"type\": \"Point\",\n                \"coordinates\": [\n                  59.664626,\n                  30.123961\n                ]\n              },\n              \"properties\": {\n                \"balloonContentHeader\": \"<div class=\\\"module--header\\\"><div class=\\\"module--title module--title-available\\\">Участок №312</div><div class=\\\"module--status status status-nopadding js-status\\\">Свободен</div></div>\",\n                \"balloonContentBody\": \"<div class=\\\"module--body\\\"><div class=\\\"module--item module--item-50 common_item\\\"><div class=\\\"common_item--title\\\"><em>Площадь участка</em></div><div class=\\\"common_item--value\\\">10,2 сот.</div></div><div class=\\\"module--item module--item-50 common_item\\\"><div class=\\\"common_item--title\\\"><em>Стоимость</em></div><div class=\\\"common_item--value\\\"><span class=\\\"js-money\\\">900000</span> ₽</div></div><div class=\\\"module--item icb d-none d-lg-block\\\"><i class=\\\"icb--icon icon icon-mountain\\\"></i><div class=\\\"icb--title\\\"></div></div><div class=\\\"module--item slope slope-hor d-none d-lg-flex\\\"><div class=\\\"slope--title slope--title-hor\\\">Уклон участка</div><div class=\\\"slope--subtitle slope--subtitle-hor js-typo\\\"></div></div></div>\",\n                \"balloonContentFooter\": \"<div class=\\\"module--footer\\\"><a href=\\\"http://vsevreestr.localhost/land/uchastok-10-2-sotki-tajtsy-leningradskaya-oblast/\\\" class=\\\"module--more\\\">Подробнее об участке</a><button type=\\\"button\\\" class=\\\"module--but but but-green\\\" data-toggle=\\\"modal\\\" data-target=\\\"#orderModal\\\">Забронировать</button></div>\",\n                \"hintContent\": \"Ленинградская область, пос. Тайцы, ул. Вокзальная, дом 34, корп. 1\"\n              }\n            },\n            {\n              \"type\": \"Feature\",\n              \"postType\": \"land\",\n              \"id\": 196,\n              \"link\": \"http://vsevreestr.localhost/land/uchastok-860/\",\n              \"options\": {\n                \"fillColor\": \"#44A147\",\n                \"strokeColor\": \"#18803F\",\n                \"strokeWidth\": 2,\n                \"opacity\": 0.75\n              },\n              \"geometry\": {\n                \"type\": \"Point\",\n                \"coordinates\": [\n                  59.681866995826574,\n                  30.111483041779966\n                ]\n              },\n              \"properties\": {\n                \"balloonContentHeader\": \"<div class=\\\"module--header\\\"><div class=\\\"module--title module--title-available\\\">Участок №</div><div class=\\\"module--status status status-nopadding js-status\\\">Свободен</div></div>\",\n                \"balloonContentBody\": \"<div class=\\\"module--body\\\"><div class=\\\"module--item module--item-50 common_item\\\"><div class=\\\"common_item--title\\\"><em>Площадь участка</em></div><div class=\\\"common_item--value\\\">10 сот.</div></div><div class=\\\"module--item module--item-50 common_item\\\"><div class=\\\"common_item--title\\\"><em>Стоимость</em></div><div class=\\\"common_item--value\\\"><span class=\\\"js-money\\\">650000</span> ₽</div></div><div class=\\\"module--item icb d-none d-lg-block\\\"><i class=\\\"icb--icon icon icon-mountain\\\"></i><div class=\\\"icb--title\\\"></div></div><div class=\\\"module--item slope slope-hor d-none d-lg-flex\\\"><div class=\\\"slope--title slope--title-hor\\\">Уклон участка</div><img src=\\\"http://10.0.0.38:3000/wp-content/themes/vsevreestr/svg/landscape/rovn_SN.svg\\\" alt=\\\"Ландшафт\\\" class=\\\"slope--img slope--img-hor\\\"><div class=\\\"slope--subtitle slope--subtitle-hor js-typo\\\"></div></div></div>\",\n                \"balloonContentFooter\": \"<div class=\\\"module--footer\\\"><a href=\\\"http://vsevreestr.localhost/land/uchastok-860/\\\" class=\\\"module--more\\\">Подробнее об участке</a><button type=\\\"button\\\" class=\\\"module--but but but-green\\\" data-toggle=\\\"modal\\\" data-target=\\\"#orderModal\\\">Забронировать</button></div>\",\n                \"hintContent\": \"Ленинградская область, пос. Тайцы, пгт Тайцы, ул. Балтийская\"\n              }\n            }\n          ]\n        }\n\n        import_map( templateURL + '/ajax/data-' +  'project' + '-' + projectName + '.json' );\n\n        /**\n         * Import map from json\n         * @param data\n         * @returns {boolean}\n         */\n         function import_map(data) {\n\n            // console.log(data);\n\n            // if (data.length == 0)\n                // return false;\n\n            // if (data[0].name != 'import')\n                // return false;\n\n                $.get(data, function(response) {\n                    // console.log(response.features.length);\n                    // console.log(response.features);\n\n                    if ( response.features.length > 0 ) {\n                        \n                        // set default params\n                        $params.zoom = 13;\n                        $params.center_lat = 59.99914531368303;\n                        $params.center_lng = 30.72482104954271;\n                        $params.type = \"map\"\n\n                        $.each(response.features, function(index, val) {\n                            $params.marks[index] = {\n                                \"id\": val.id,\n                                \"content\": val.id,\n                                \"type\": val.geometry.type,\n                                \"coords\": val.geometry.coordinates\n                            };\n                        });\n\n                        console.log($params);\n\n                        // map_init();\n\n                        // $($params.marks).each(function (index, mark) {\n                        //     create_mark(mark.coords, mark.type, mark.id, mark.content);\n                        // });\n\n                        return false;\n\n                    };\n\n                });\n\n            // try {\n            //     console.log(data);\n            //     // var imported = $.parseJSON(data[0].value);\n            //     var imported = $.parseJSON(data);\n            //     // var imported = data.features;\n            //     console.log(imported);\n            // }\n            // catch (err) {\n            //     console.error(err, 'Import map error');\n            //     alert('Import map error');\n            //     return false;\n            // }\n\n            // $params.marks = imported;\n\n            // set default params\n            // $params.zoom = 13;\n            // $params.center_lat = 59.99914531368303;\n            // $params.center_lng = 30.72482104954271;\n            // $params.type = \"map\"\n\n            // $.each(imported, function(index, val) {\n            //     $params.marks[index] = {\n            //         \"id\": val.id,\n            //         \"content\": val.id,\n            //         \"type\": val.geometry.type,\n            //         \"coords\": val.geometry.coordinates\n            //     }\n            // });\n\n            // console.log($params);\n\n            // map_init();\n\n            /// Marks load\n\n            // $($params.marks).each(function (index, mark) {\n            //     // create_mark(mark.coords, mark.type, mark.circle_size, mark.id, mark.content);\n            //     create_mark(mark.coords, mark.type, mark.id, mark.content);\n            // });\n\n            // return false;\n        }\n        // function import_map(data) {\n\n        //     // console.log('import');\n\n        //     if (data.length == 0)\n        //         return false;\n\n        //     if (data[0].name != 'import')\n        //         return false;\n\n        //     try {\n        //         var imported = $.parseJSON(data[0].value);\n        //     }\n        //     catch (err) {\n        //         console.error(err, 'Import map error');\n        //         alert('Import map error');\n        //         return false;\n        //     }\n\n        //     $params = imported;\n\n        //     map_init();\n\n        //     return false;\n        // }\n\n        /**\n         * Show mark editor\n         * @param mark\n         */\n        // function show_mark_editor(mark) {\n        //     var html = '<div class=\"ya-editor\" style=\"margin: 5px\"><form name=\"mark\"><input type=\"hidden\" name=\"id\" value=\"' +\n        //         mark.properties.get('id') + '\"><textarea name=\"content\" rows=\"5\" cols=\"40\">' + mark.properties.get('content') +\n        //         '</textarea><input type=\"submit\" class=\"button button-primary\" value=\"' + acf_yandex_locale.mark_save +\n        //         '\"/>&nbsp;<button class=\"button remove\">' + acf_yandex_locale.mark_remove + '</button></form></div>';\n\n        //     $map.balloon.open(mark.geometry.getCoordinates(), html);\n\n        //     //console.info(mark.properties.get('id'));\n        //     //console.info(mark.properties.get('content'));\n\n\n        //     //$('input[name=\"color\"]').wpColorPicker({});\n        // }\n\n        /**\n         * Change marker type state\n         */\n        $('.marker-type').on('change', function () {\n            var label = $(this).parent().next('th').children(0);\n            var select = $(this).parent().next('th').next('td').children(0);\n            if (this.value == 'circle') {\n                label.removeClass('hidden');\n                select.removeClass('hidden');\n            } else {\n                label.addClass('hidden');\n                select.addClass('hidden');\n            }\n        });\n\n    }\n\n\n    if (typeof acf.add_action !== 'undefined') {\n\n        /*\n         *  ready append (ACF5)\n         *\n         *  These are 2 events which are fired during the page load\n         *  ready = on page load similar to $(document).ready()\n         *  append = on new DOM elements appended via repeater field\n         *\n         *  @type\tevent\n         *  @date\t20/07/13\n         *\n         *  @param\t$el (jQuery selection) the jQuery element which contains the ACF fields\n         *  @return\tn/a\n         */\n\n        acf.add_action('ready append', function ($el) {\n\n            // search $el for fields of type 'FIELD_NAME'\n            acf.get_fields({type: 'yandex-map'}, $el).each(function () {\n\n                initialize_field($(this));\n\n            });\n\n        });\n\n\n    } else {\n\n\n        /*\n         *  acf/setup_fields (ACF4)\n         *\n         *  This event is triggered when ACF adds any new elements to the DOM.\n         *\n         *  @type\tfunction\n         *  @since\t1.0.0\n         *  @date\t01/01/12\n         *\n         *  @param\tevent\t\te: an event object. This can be ignored\n         *  @param\tElement\t\tpostbox: An element which contains the new HTML\n         *\n         *  @return\tn/a\n         */\n\n        $(document).on('acf/setup_fields', function (e, postbox) {\n\n            $(postbox).find('.field[data-field_type=\"yandex-map\"]').each(function () {\n\n                initialize_field($(this));\n\n            });\n\n        });\n\n\n    }\n\n\n})(jQuery);"]}